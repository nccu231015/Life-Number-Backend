# ğŸŒŸ ç”Ÿå‘½éˆæ•¸å¾Œç«¯ API æ–‡æª”

## ğŸ“– ç³»çµ±æ¶æ§‹

æœ¬ç³»çµ±æ˜¯ä¸€å€‹**è³‡æ–™åº«é©…å‹•**çš„ç”Ÿå‘½éˆæ•¸å¹³å°ï¼Œæ•´åˆäº†ä¸‰å¤§æ ¸å¿ƒæ¨¡çµ„ï¼š

### ğŸ¯ æ ¸å¿ƒæ¨¡çµ„
1. **ç”Ÿå‘½éˆæ•¸ (Life Number)** - å®Œæ•´çš„ç”Ÿå‘½éˆæ•¸è¨ˆç®—èˆ‡è§£è®€ç³»çµ±
2. **å¤©ä½¿æ•¸å­— (Angel Number)** - å¤©ä½¿æ•¸å­—è¨Šæ¯è§£è®€
3. **ç¥è«­å åœ (Divination)** - æ“²ç­Šå åœèˆ‡ç¥æ˜æŒ‡å¼•
4. **é»ƒé“å‰æ—¥ (Auspicious Date)** - é»ƒæ›†æŸ¥è©¢èˆ‡å‰æ—¥æ¨è–¦

### ğŸ’¾ è³‡æ–™åº«æ¶æ§‹

ç³»çµ±ä½¿ç”¨ **Supabase (PostgreSQL)** ä½œç‚ºè³‡æ–™ä¾†æºï¼Œæ‰€æœ‰éˆæ•¸å…§å®¹ã€å¤©ä½¿è¨Šæ¯ã€ç¥è«­è§£è®€éƒ½å‹•æ…‹å¾è³‡æ–™åº«è®€å–ï¼š

**å„ªå‹¢ï¼š**
- âœ… **å…§å®¹æ˜“æ›´æ–°**ï¼šç›´æ¥åœ¨è³‡æ–™åº«ä¿®æ”¹è§£è®€å…§å®¹ï¼Œç„¡éœ€é‡æ–°éƒ¨ç½²
- âœ… **ä¸€è‡´æ€§ä¿è­‰**ï¼šæ‰€æœ‰ç”¨æˆ¶ç²å¾—ç›¸åŒç‰ˆæœ¬çš„æœ€æ–°å…§å®¹
- âœ… **æ“´å……æ€§å¼·**ï¼šè¼•é¬†æ–°å¢æ›´å¤šéˆæ•¸ã€å¤©ä½¿æ•¸å­—æˆ–å åœçµ„åˆ
- âœ… **å¤šèªè¨€æ”¯æŒ**ï¼šè³‡æ–™åº«å¯è¼•é¬†æ“´å……å¤šèªè¨€å…§å®¹

**è³‡æ–™è¡¨çµæ§‹ï¼š**
- ç”Ÿå‘½éˆæ•¸ï¼š11 å€‹è³‡æ–™è¡¨ï¼ˆmain, birthday, year, grid, soul, personality, expression, maturity, challenge, karma, grid_missingï¼‰
- å¤©ä½¿æ•¸å­—ï¼š2 å€‹è³‡æ–™è¡¨ï¼ˆmeanings, basic_energyï¼‰
- å åœç³»çµ±ï¼š2 å€‹è³‡æ–™è¡¨ï¼ˆcombinations, tone_greetingsï¼‰
- é»ƒé“å‰æ—¥ï¼š1 å€‹è³‡æ–™è¡¨ï¼ˆauspicious_calendar - æœˆä»½é»ƒæ›†è³‡æ–™ï¼‰

I/O è¦æ ¼æ–‡æª”

> ğŸ“¡ **éƒ¨ç½²ç‹€æ…‹**: å¯éƒ¨ç½²è‡³ GCP Cloud Run  
> ğŸ” **å®‰å…¨æ€§**: HTTPS + Secret Manager  
> ğŸ’¾ **Session å­˜å„²**: Redis (12å°æ™‚ TTL)  
> ğŸŒ **å€åŸŸ**: Asia East 1 (å°ç£)

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ­¥é©Ÿ 1ï¼šå–å¾— API URL
éƒ¨ç½²å®Œæˆå¾Œï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤å–å¾—æœå‹™ URLï¼š
```bash
gcloud run services describe life-number-backend \
  --region=asia-east1 \
  --format='value(status.url)'
```

### æ­¥é©Ÿ 2ï¼šæ¸¬è©¦å¥åº·æª¢æŸ¥
```bash
curl https://your-service-url.a.run.app/health
```

### æ­¥é©Ÿ 3ï¼šåˆå§‹åŒ– Session
```bash
curl -X POST https://your-service-url.a.run.app/life/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'
```

### æ­¥é©Ÿ 4ï¼šé–‹å§‹å°è©±
ä½¿ç”¨è¿”å›çš„ `session_id` é€²è¡Œå¾ŒçºŒå°è©±ã€‚

---

## ğŸ“‹ ç¸½é«”è¨­è¨ˆåŸå‰‡

### çµ±ä¸€çš„ Session ç®¡ç†æ©Ÿåˆ¶
1. **å¾Œç«¯ç”Ÿæˆ `session_id`**ï¼šæ‰€æœ‰ç‰ˆæœ¬ï¼ˆå…è²»/ä»˜è²»ï¼‰éƒ½ç”±å¾Œç«¯åœ¨ `init_with_tone` æ™‚ç”Ÿæˆå”¯ä¸€çš„ `session_id`
2. **å‰ç«¯ä¿å­˜ä¸¦å‚³é**ï¼šå‰ç«¯æ”¶åˆ° `session_id` å¾Œä¿å­˜ï¼Œä¹‹å¾Œæ‰€æœ‰è«‹æ±‚éƒ½å¿…é ˆå¸¶ä¸Šé€™å€‹ `session_id`
3. **ç„¡éœ€å€åˆ†ç”¨æˆ¶é¡å‹**ï¼šä¸éœ€è¦ `user_id`ï¼Œæ‰€æœ‰ç”¨æˆ¶çµ±ä¸€ä½¿ç”¨ `session_id` æ©Ÿåˆ¶
4. **è‡ªå‹•éæœŸ**ï¼šSession åœ¨ 12 å°æ™‚å¾Œè‡ªå‹•éæœŸï¼ˆRedis TTLï¼‰

### æŠ€è¡“æ¶æ§‹
- **å¾Œç«¯æ¡†æ¶**: Flask + Gunicorn
- **AI å¼•æ“**: OpenAI GPT-4o
- **Session å­˜å„²**: Redis Cloud
- **éƒ¨ç½²å¹³å°**: GCP Cloud Run
- **å®¹å™¨åŒ–**: Docker

---

## ğŸ”Œ API ç«¯é»

### åŸºç¤ URL

#### ğŸŒ ç”Ÿç”¢ç’°å¢ƒï¼ˆGCP Cloud Runï¼‰
éƒ¨ç½²å¾Œï¼Œæ‚¨çš„ API å°‡é‹è¡Œåœ¨ GCP Cloud Run ä¸Šï¼š
```
https://life-number-backend-<hash>-<region-code>.a.run.app
```

> ğŸ“ **æ³¨æ„**ï¼šéƒ¨ç½²å®Œæˆå¾Œï¼ŒCloud Run æœƒæä¾›å®Œæ•´çš„æœå‹™ URLã€‚è«‹è¨˜éŒ„ä¸‹ä¾†ä¸¦åœ¨å‰ç«¯é…ç½®ä¸­ä½¿ç”¨ã€‚

#### ğŸ–¥ï¸ æœ¬åœ°é–‹ç™¼ç’°å¢ƒ
```
http://localhost:8080
```

### å®Œæ•´ç«¯é»åˆ—è¡¨

| ç«¯é»è·¯å¾‘ | æ–¹æ³• | èªªæ˜ |
|---------|------|------|
| `/health` | GET | å¥åº·æª¢æŸ¥ |
| **ç”Ÿå‘½éˆæ•¸ (Life Number)** |
| `/life/free/api/init_with_tone` | POST | å…è²»ç‰ˆ - åˆå§‹åŒ–å°è©± |
| `/life/free/api/chat` | POST | å…è²»ç‰ˆ - ç™¼é€è¨Šæ¯ |
| `/life/free/api/reset` | POST | å…è²»ç‰ˆ - é‡ç½®æœƒè©± |
| `/life/paid/api/init_with_tone` | POST | ä»˜è²»ç‰ˆ - åˆå§‹åŒ–å°è©± |
| `/life/paid/api/chat` | POST | ä»˜è²»ç‰ˆ - ç™¼é€è¨Šæ¯ |
| `/life/paid/api/reset` | POST | ä»˜è²»ç‰ˆ - é‡ç½®æœƒè©± |
| **å¤©ä½¿æ•¸å­— (Angel Number)** |
| `/angel/free/api/init_with_tone` | POST | å¤©ä½¿æ•¸å­— - å…è²»ç‰ˆåˆå§‹åŒ– |
| `/angel/free/api/chat` | POST | å¤©ä½¿æ•¸å­— - å…è²»ç‰ˆå°è©± |
| `/angel/free/api/reset` | POST | å¤©ä½¿æ•¸å­— - å…è²»ç‰ˆé‡ç½® |
| `/angel/paid/api/init_with_tone` | POST | å¤©ä½¿æ•¸å­— - ä»˜è²»ç‰ˆåˆå§‹åŒ– |
| `/angel/paid/api/chat` | POST | å¤©ä½¿æ•¸å­— - ä»˜è²»ç‰ˆå°è©± |
| `/angel/paid/api/reset` | POST | å¤©ä½¿æ•¸å­— - ä»˜è²»ç‰ˆé‡ç½® |
| **æ“²ç­Š (Divination)** |
| `/divination/free/api/init_with_tone` | POST | æ“²ç­Š - å…è²»ç‰ˆåˆå§‹åŒ– |
| `/divination/free/api/chat` | POST | æ“²ç­Š - å…è²»ç‰ˆå°è©± |
| `/divination/free/api/reset` | POST | æ“²ç­Š - å…è²»ç‰ˆé‡ç½® |
| `/divination/paid/api/init_with_tone` | POST | æ“²ç­Š - ä»˜è²»ç‰ˆåˆå§‹åŒ– |
| `/divination/paid/api/chat` | POST | æ“²ç­Š - ä»˜è²»ç‰ˆå°è©± |
| `/divination/paid/api/reset` | POST | æ“²ç­Š - ä»˜è²»ç‰ˆé‡ç½® |
| **é»ƒé“å‰æ—¥ (Auspicious Date)** |
| `/auspicious/free/api/init_with_tone` | POST | é»ƒé“å‰æ—¥ - å…è²»ç‰ˆåˆå§‹åŒ– |
| `/auspicious/free/api/chat` | POST | é»ƒé“å‰æ—¥ - å…è²»ç‰ˆå°è©± |
| `/auspicious/free/api/reset` | POST | é»ƒé“å‰æ—¥ - å…è²»ç‰ˆé‡ç½® |
| `/auspicious/paid/api/init_with_tone` | POST | é»ƒé“å‰æ—¥ - ä»˜è²»ç‰ˆåˆå§‹åŒ– |
| `/auspicious/paid/api/chat` | POST | é»ƒé“å‰æ—¥ - ä»˜è²»ç‰ˆå°è©± |
| `/auspicious/paid/api/reset` | POST | é»ƒé“å‰æ—¥ - ä»˜è²»ç‰ˆé‡ç½® |

---

## 4ï¸âƒ£ å¤©ä½¿æ•¸å­— API (Angel Number)

å¤©ä½¿æ•¸å­—æ¨¡çµ„æä¾›å…è²»ç‰ˆå’Œä»˜è²»ç‰ˆå…©ç¨®é«”é©—ã€‚

### ğŸŒŸ ç‰ˆæœ¬å·®ç•°

| åŠŸèƒ½ | å…è²»ç‰ˆ | ä»˜è²»ç‰ˆ |
|------|--------|--------|
| **èªæ°£é¸æ“‡** | 3 ç¨® (friendly, caring, ritual) | 10 ç¨® (åŒ…å«é—œè–å¸å›ã€å¤§å¤©ä½¿ç­‰) |
| **æ•¸å­—æ”¯æ´** | åƒ…é™ 4 ä½é‡è¤‡æ•¸ (å¦‚ 1111, 2222) | æ”¯æ´ä»»æ„æ•¸å­— (å¦‚ 123, 1212, 888) |
| **æ™ºèƒ½åˆ†æ** | å›ºå®šå«ç¾© | æ™ºèƒ½æ¨¡å¼è­˜åˆ¥ (é‡è¤‡ã€éšæ¢¯ã€é¡åƒç­‰ 8 ç¨®æ¨¡å¼) |
| **å°è©±æ·±åº¦** | å–®æ¬¡è§£è®€å³çµæŸ | æ”¯æ´æ·±åº¦å°è©± (æå• -> å›ç­” -> ç¹¼çºŒ) |
| **è¼¸å…¥æ–¹å¼** | é¸æ“‡å™¨ (UI) | æ–‡å­—è¼¸å…¥ |

### ğŸ“¡ ç«¯é»èªªæ˜

#### åˆå§‹åŒ–å°è©±
`POST /angel/{version}/api/init_with_tone`

**Request:**
```jsonc
{
  "tone": "string" // friendly, caring, ritual, guan_yu, michael...
}
```

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "å•å€™èª",
  "state": "waiting_basic_info"
}
```

#### å°è©±äº’å‹•
`POST /angel/{version}/api/chat`

**Request:**
```jsonc
{
  "session_id": "uuid",
  "message": "string"
}
```

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "AIå›æ‡‰",
  "state": "waiting_angel_number | asking_for_question | conversation | completed",
  "angel_number": "123", // åƒ…åœ¨è§£è®€å®Œæˆæ™‚è¿”å›
  "pattern": "ascending" // åƒ…ä»˜è²»ç‰ˆè¿”å›
}
```

### ğŸ”„ å°è©±æµç¨‹

#### å…è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡èªæ°£
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥
3. **é¸æ“‡æ•¸å­—**ï¼šå¾åˆ—è¡¨ä¸­é¸æ“‡ (å¦‚ 1111)
4. **è§£è®€**ï¼šç²å¾—è§£è®€çµæœï¼Œå°è©±çµæŸ

#### ä»˜è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡èªæ°£ (é è¨­ guan_yu)
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥
3. **è¼¸å…¥æ•¸å­—**ï¼šè¼¸å…¥ä»»æ„æ•¸å­— (å¦‚ 123)
4. **æ™ºèƒ½è§£è®€**ï¼šAI åˆ†ææ•¸å­—æ¨¡å¼ä¸¦è§£è®€
5. **æ·±åº¦æå•**ï¼šç³»çµ±è©¢å•æ˜¯å¦æœ‰å•é¡Œ
   - **æœ‰å•é¡Œ**ï¼šé€²å…¥å°è©±æ¨¡å¼ï¼Œé‡å°è©²æ•¸å­—é€²è¡Œæ·±å…¥å•ç­”
   - **æ²’å•é¡Œ**ï¼šå°è©±çµæŸ
6. **æŒçºŒå°è©±**ï¼šå¯å¤šè¼ªæå•ï¼Œç›´åˆ°ç”¨æˆ¶èªªè¬è¬/çµæŸ

---

## 5ï¸âƒ£ æ“²ç­Š API (Divination)

æ“²ç­Šæ¨¡çµ„æä¾›å…è²»ç‰ˆå’Œä»˜è²»ç‰ˆå…©ç¨®é«”é©—ã€‚

### ğŸŒŸ ç‰ˆæœ¬å·®ç•°

| åŠŸèƒ½ | å…è²»ç‰ˆ | ä»˜è²»ç‰ˆ |
|------|--------|--------|
| **èªæ°£é¸æ“‡** | 3 ç¨® (friendly, caring, ritual) | 9 ç¨® (é—œè–å¸å›ã€åª½ç¥–ã€æœˆè€ç­‰) |
| **æ“²ç­Šæ¬¡æ•¸** | å–®æ¬¡æ“²ç­Š | **ä¸‰æ¬¡æ“²ç­Š** |
| **è§£è®€æ–¹å¼** | å›ºå®šæ¨¡æ¿ | **AI æ™ºèƒ½è§£è®€** (æ ¹æ“šç¥æ˜æ€§æ ¼ + 10 ç¨®çµ„åˆ) |
| **å°è©±æ·±åº¦** | å–®æ¬¡æ“²ç­Šå³çµæŸ | æ”¯æ´æ·±åº¦å°è©± (æå• -> æ“²ç­Š -> è§£è®€ -> è¿½å•) |
| **çµæœç”Ÿæˆ** | éš¨æ©Ÿ (è–/ç¬‘/é™°) | **ä¸‰æ¬¡éš¨æ©Ÿ** + çµ„åˆåˆ†æ + AI è§£è®€ |

### ğŸ“¡ ç«¯é»èªªæ˜

#### åˆå§‹åŒ–å°è©±
`POST /divination/{version}/api/init_with_tone`

**Request:**
```jsonc
{
  "tone": "string" // friendly, caring, ritual, guan_gong, mazu...
}
```

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "å•å€™èª",
  "state": "waiting_basic_info"
}
```

#### å°è©±äº’å‹•
`POST /divination/{version}/api/chat`

**Request:**
```jsonc
{
  "session_id": "uuid",
  "message": "string" // ç”¨æˆ¶å•é¡Œï¼Œæˆ–åœ¨ divining ç‹€æ…‹ä¸‹å‚³é€ "cast" æˆ–ä»»æ„å­—ä¸²è§¸ç™¼æ“²ç­Š
}
```

**ç‹€æ…‹æµè½‰èªªæ˜ï¼š**
1. `waiting_basic_info`: ç­‰å¾…ç”¨æˆ¶è¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥
2. `waiting_question`: ç­‰å¾…ç”¨æˆ¶è¼¸å…¥å•é¡Œ
3. `divining`: ç”¨æˆ¶è¼¸å…¥å•é¡Œå¾Œï¼Œç³»çµ±å›å‚³å¼•å°æ–‡æ¡ˆï¼Œé€²å…¥æ­¤ç‹€æ…‹ã€‚ç”¨æˆ¶éœ€ç™¼é€è«‹æ±‚ï¼ˆå¦‚ message="cast"ï¼‰ä¾†è§¸ç™¼æ“²ç­Šã€‚
4. `completed` (å…è²»ç‰ˆ) / `asking_for_question` (ä»˜è²»ç‰ˆ): æ“²ç­Šå®Œæˆï¼Œå›å‚³çµæœè§£è®€ã€‚

**å…è²»ç‰ˆ Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "AIå›æ‡‰",
  "state": "waiting_question | divining | completed",
  "question": "ç”¨æˆ¶å•é¡Œ",
  "divination_result": "holy"  // åƒ…åœ¨ completed ç‹€æ…‹å›å‚³ï¼šholy(è–ç­Š), laughing(ç¬‘ç­Š), negative(é™°ç­Š)
}
```

**å…è²»ç‰ˆ Divining ç‹€æ…‹ Response ç¯„ä¾‹ï¼š**
```jsonc
{
  "session_id": "uuid",
  "response": "æ”¶åˆ°ä½ çš„å•é¡Œã€‚è«‹èª å¿ƒé»˜å¿µï¼Œç„¶å¾ŒæŒ‰ä¸‹æŒ‰éˆ•æ“²ç­Šã€‚",
  "state": "divining"
}
```

**ä»˜è²»ç‰ˆ Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "AIå›æ‡‰",
  "state": "waiting_question | divining | asking_for_question | completed",
  "question": "ç”¨æˆ¶å•é¡Œ",
  "divination_results": ["holy", "laughing", "negative"],  // åƒ…åœ¨ asking_for_question/completed ç‹€æ…‹å›å‚³
  "combination_type": "holy_holy_laughing",
  "divination_result": "holy_holy_laughing"
}
```

**ä»˜è²»ç‰ˆ Divining ç‹€æ…‹ Response ç¯„ä¾‹ï¼š**
```jsonc
{
  "session_id": "uuid",
  "response": "æ”¶åˆ°ï¼Œç‹å°æ˜ã€‚è«‹èª å¿ƒé»˜å¿µå•é¡Œä¸‰æ¬¡ï¼Œæº–å‚™å¥½å¾Œé»æ“Šæ“²ç­Šã€‚",
  "state": "divining"
}
```

**ä»˜è²»ç‰ˆçµ„åˆé¡å‹ï¼š**
- `holy_holy_holy` - ä¸‰æ¬¡è–ç­Šï¼ˆå…¨ç„¶æ”¯æŒï¼‰
- `negative_negative_negative` - ä¸‰æ¬¡é™°ç­Šï¼ˆæ™‚é‹ä¸åˆï¼‰
- `laughing_laughing_laughing` - ä¸‰æ¬¡ç¬‘ç­Šï¼ˆç„¡éœ€åŸ·è‘—ï¼‰
- `holy_holy_negative` - å…©å…ä¸€æ­¢ï¼ˆéœ€è£œä¸è¶³ï¼‰
- `holy_holy_laughing` - å…©å…ä¸€ç¬‘ï¼ˆæ”¾è¼•å¿ƒæ…‹ï¼‰
- `negative_negative_holy` - å…©æ­¢ä¸€å…ï¼ˆè½‰æ©Ÿå·²ç¾ï¼‰
- `negative_negative_laughing` - å…©æ­¢ä¸€ç¬‘ï¼ˆä¸å®œå¼·æ±‚ï¼‰
- `laughing_laughing_holy` - å…©ç¬‘ä¸€å…ï¼ˆå°ˆæ³¨æ ¸å¿ƒï¼‰
- `laughing_laughing_negative` - å…©ç¬‘ä¸€æ­¢ï¼ˆé †å…¶è‡ªç„¶ï¼‰
- `mixed_all_three` - è–é™°ç¬‘é½Šèšï¼ˆå½ˆæ€§é¢å°ï¼‰

### ğŸ”„ å°è©±æµç¨‹

#### å…è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡èªæ°£
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥
3. **æäº¤å•é¡Œ**ï¼šè¼¸å…¥æƒ³å•çš„å•é¡Œ
4. **æ“²ç­Š**ï¼šç³»çµ±éš¨æ©Ÿæ“²ç­Šï¼ˆå–®æ¬¡ï¼‰ä¸¦ä½¿ç”¨æ¨¡æ¿è§£è®€ï¼Œå°è©±çµæŸ

#### ä»˜è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡èªæ°£ (å¦‚é—œè–å¸å›)
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥
3. **æäº¤å•é¡Œ**ï¼šè¼¸å…¥æƒ³å•çš„å•é¡Œ
4. **æ“²ç­Šä¸‰æ¬¡**ï¼šç³»çµ±é€²è¡Œä¸‰æ¬¡æ“²ç­Š
5. **AI ç¶œåˆè§£è®€**ï¼šæ ¹æ“šä¸‰æ¬¡çµæœçš„çµ„åˆé¡å‹ï¼ˆ10 ç¨®ï¼‰+ ç¥æ˜æ€§æ ¼ + ç”¨æˆ¶å•é¡Œï¼Œç”Ÿæˆå€‹æ€§åŒ–è§£è®€
6. **æŒçºŒå°è©±**ï¼šç³»çµ±è©¢å•æ˜¯å¦æœ‰å…¶ä»–ç–‘å•
   - **æœ‰å•é¡Œ**ï¼šç”¨æˆ¶è¿½å•ï¼ŒAI ç¹¼çºŒä»¥ç¥æ˜å£å»å›ç­”
   - **æ²’å•é¡Œ**ï¼šå°è©±çµæŸ

---

## 6ï¸âƒ£ é»ƒé“å‰æ—¥ API (Auspicious Date)

é»ƒé“å‰æ—¥æ¨¡çµ„æä¾›åŸºæ–¼å‚³çµ±é»ƒæ›†çš„å‰æ—¥æŸ¥è©¢æœå‹™ã€‚

### ğŸŒŸ ç‰ˆæœ¬å·®ç•°

| åŠŸèƒ½ | å…è²»ç‰ˆ | ä»˜è²»ç‰ˆ |
|------|--------|--------|
| **èªæ°£é¸æ“‡** | 3 ç¨® (friendly, caring, ritual) | 9 ç¨®ç¥æ˜èªæ°£ï¼ˆé—œè–å¸å›ã€äº”è·¯è²¡ç¥ã€æ–‡æ˜Œå¸å›ã€æœˆè€ã€è§€éŸ³ã€åª½ç¥–ã€ä¹å¤©å¨˜å¨˜ã€è§€éŸ³å¥åº·ç‰ˆã€ç¦å¾·æ­£ç¥ï¼‰ |
| **åˆ†é¡æŸ¥è©¢** | 5 ç¨®åˆ†é¡ï¼ˆç”Ÿæ´»æ—¥å¸¸ã€å®¶åº­å±…æ‰€ã€æ„Ÿæƒ…äººéš›ã€å–œæ…¶å¤§äº‹ã€å·¥ä½œäº‹æ¥­ï¼‰ | ç›¸åŒ |
| **è¼¸å…¥æ–¹å¼** | æŒ‰éˆ•é¸æ“‡ + æ–‡å­—è¼¸å…¥ | ç›¸åŒ |
| **è§£è®€æ–¹å¼** | åŸºæ–¼é»ƒæ›†ã€Œå®œã€ã€Œå¿Œã€æ¬„ä½çš„ AI åˆ†æ | ä»¥ç¥æ˜æ€§æ ¼é€²è¡Œæ·±åº¦è§£è®€ |
| **å°è©±æ·±åº¦** | å–®æ¬¡æŸ¥è©¢å³çµæŸ | **æŒçºŒå°è©±**ï¼šå¯è¿½å•æ›´å¤šç´°ç¯€ï¼ŒAI ä»¥ç¥æ˜å£å»å›ç­” |

### ğŸ“‹ å°è©±æµç¨‹

#### å…è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡èªæ°£ï¼ˆfriendly/caring/ritualï¼‰
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥ã€ç”Ÿè‚–
3. **é¸æ“‡åˆ†é¡å’Œæ—¥æœŸ**ï¼šé¸æ“‡åˆ†é¡ï¼ˆå¦‚ã€Œæ„Ÿæƒ…äººéš›ã€ï¼‰+ æ—¥æœŸ
4. **æè¿°äº‹é …**ï¼šå…·é«”èªªæ˜è¦åšçš„äº‹ï¼ˆå¦‚ã€Œçµå©šã€ï¼‰
5. **æŸ¥è©¢çµæœ**ï¼šAI åˆ†æé»ƒæ›†ä¸¦çµ¦å‡ºå»ºè­°ï¼Œå°è©±çµæŸ

#### ä»˜è²»ç‰ˆæµç¨‹
1. **åˆå§‹åŒ–**ï¼šé¸æ“‡ç¥æ˜èªæ°£ï¼ˆå¦‚æœˆè€æ˜Ÿå›ï¼‰
2. **åŸºæœ¬è³‡è¨Š**ï¼šè¼¸å…¥å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥ã€ç”Ÿè‚–
3. **é¸æ“‡åˆ†é¡å’Œæ—¥æœŸ**ï¼šé¸æ“‡åˆ†é¡ + æ—¥æœŸ
4. **æè¿°äº‹é …**ï¼šå…·é«”èªªæ˜è¦åšçš„äº‹
5. **æŸ¥è©¢çµæœ**ï¼šç¥æ˜ä»¥å…¶æ€§æ ¼é€²è¡Œæ·±åº¦è§£è®€
6. **æŒçºŒå°è©±**ï¼šç³»çµ±è©¢å•æ˜¯å¦æœ‰å…¶ä»–ç–‘å•
   - **æœ‰å•é¡Œ**ï¼šç”¨æˆ¶è¿½å•ï¼ŒAI ä»¥ç¥æ˜å£å»ç¹¼çºŒå›ç­”
   - **æ²’å•é¡Œ**ï¼šç”¨æˆ¶èªªã€Œè¬è¬ã€æˆ–ã€Œæ²’æœ‰ã€ï¼Œç¥æ˜çµ¦å‡ºçµæŸèªï¼Œå°è©±çµæŸ

### ğŸ“¡ ç«¯é»èªªæ˜

#### åˆå§‹åŒ–å°è©±
`POST /auspicious/{version}/api/init_with_tone`

**Request:**
```jsonc
{
  "tone": "string" // å…è²»ç‰ˆ: friendly, caring, ritual | ä»˜è²»ç‰ˆ: yue_lao, guan_gong, wealth_god, ç­‰
}
```

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "å•å€™èª",
  "state": "waiting_basic_info"
}
```

#### å°è©±äº’å‹•
`POST /auspicious/{version}/api/chat`

**Request - éšæ®µ 1ï¼ˆæäº¤åŸºæœ¬è³‡è¨Šï¼‰:**
```jsonc
{
  "session_id": "uuid",
  "message": "ç‹å°æ˜ ç”· 1990/07/12 å±¬é¦¬"
}
```

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "å¥½çš„ï¼æ¥ä¸‹ä¾†è«‹é¸æ“‡ä½ æƒ³æŸ¥è©¢çš„åˆ†é¡ï¼Œä¸¦é¸æ“‡ä¸€å€‹æ—¥æœŸ...",
  "state": "waiting_category_and_date",
  "categories": {
    "daily_life": { "name": "ç”Ÿæ´»æ—¥å¸¸", "examples": "..." },
    "family_home": { "name": "å®¶åº­å±…æ‰€", "examples": "..." },
    "relationship": { "name": "æ„Ÿæƒ…äººéš›", "examples": "..." },
    "celebration": { "name": "å–œæ…¶å¤§äº‹", "examples": "..." },
    "work_career": { "name": "å·¥ä½œäº‹æ¥­", "examples": "..." }
  }
}
```

**Request - éšæ®µ 2ï¼ˆé¸æ“‡åˆ†é¡å’Œæ—¥æœŸï¼‰:**

æ–¹å¼ä¸€ï¼šå‰ç«¯æŒ‰éˆ•ç›´æ¥å‚³é
```jsonc
{
  "session_id": "uuid",
  "category": "family_home",
  "selected_date": "2025-12-15"
}
```

æ–¹å¼äºŒï¼šæ–‡å­—è¼¸å…¥
```jsonc
{
  "session_id": "uuid",
  "message": "å®¶åº­å±…æ‰€ï¼Œ2025-12-15"
}
```

**åˆ†é¡å°æ‡‰ï¼š**
| Key | ä¸­æ–‡åç¨± | é»ƒæ›†å°æ‡‰ |
|-----|---------|---------|
| `daily_life` | ç”Ÿæ´»æ—¥å¸¸ | å‡ºè¡Œã€å‡ºç«ã€æ•æ‰ã€ç•‹çµã€å–é­šã€çµç¶²ã€æ²æµ´ã€æœƒè¦ªå‹ç­‰ |
| `family_home` | å®¶åº­å±…æ‰€` | å…¥å®…ã€å®‰åºŠã€ä½œç¶ã€å‹•åœŸã€ä¸Šæ¨‘ã€è£è¡£ã€ç ´å±‹å£å£ |
| `relationship` | æ„Ÿæƒ…äººéš› | ç´é‡‡ã€å«å¨¶ã€å† ç¬„ |
| `celebration` | å–œæ…¶å¤§äº‹ | ç¥­ç¥€ã€ç¥ˆç¦ã€é–‹å…‰ã€è¨­é†®ã€é½‹é†®ã€å®‰é¦™ |
| `work_career` | å·¥ä½œäº‹æ¥­ | é–‹å¸‚ã€äº¤è»Š |

**Response:**
```jsonc
{
  "session_id": "uuid",
  "response": "å¥½çš„ï¼ä½ é¸æ“‡äº†ã€Œå®¶åº­å±…æ‰€ã€ï¼Œæ—¥æœŸæ˜¯ã€Œ2025-12-15ã€...",
  "state": "waiting_specific_question",
  "category": "family_home",
  "selected_date": "2025-12-15"
}
```

**Request - éšæ®µ 3ï¼ˆæè¿°å…·é«”äº‹é …ï¼‰:**
```jsonc
{
  "session_id": "uuid",
  "message": "æˆ‘æƒ³æ¬å®¶åˆ°æ–°å®¶"
}
```

**Response (å…è²»ç‰ˆ):**
```jsonc
{
  "session_id": "uuid",
  "response": "æ ¹æ“šé»ƒæ›†åˆ†æ...[AI è§£è®€å…§å®¹]...",
  "state": "completed",
  "specific_question": "æˆ‘æƒ³æ¬å®¶åˆ°æ–°å®¶"
}
```

**Response (ä»˜è²»ç‰ˆ):**
```jsonc
{
  "session_id": "uuid",
  "response": "[ç¥æ˜è§£è®€]...\n\nå¦‚æœæ‚¨å°é¸æ“‡çš„æ—¥æœŸæˆ–å»ºè­°æœ‰ä»»ä½•ç–‘å•ï¼Œæ­¡è¿ç¹¼çºŒæå•ã€‚æˆ‘æœƒç‚ºæ‚¨è©³ç´°è§£ç­”ã€‚",
  "state": "asking_for_question",  // ä»˜è²»ç‰ˆé€²å…¥æŒçºŒå°è©±ç‹€æ…‹
  "specific_question": "æˆ‘æƒ³æ¬å®¶åˆ°æ–°å®¶"
}
```

**Request - éšæ®µ 4ï¼ˆåƒ…ä»˜è²»ç‰ˆï¼šè¿½å•ï¼‰:**
```jsonc
{
  "session_id": "uuid",
  "message": "é‚£æœ‰ä»€éº¼éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„å—ï¼Ÿ"
}
```

**Response (ä»˜è²»ç‰ˆæŒçºŒå°è©±):**
```jsonc
{
  "session_id": "uuid",
  "response": "[ç¥æ˜ä»¥å…¶æ€§æ ¼å›ç­”ç”¨æˆ¶çš„è¿½å•]...",
  "state": "asking_for_question"  // ä»åœ¨æŒçºŒå°è©±ä¸­
}
```

**Request - éšæ®µ 5ï¼ˆåƒ…ä»˜è²»ç‰ˆï¼šçµæŸå°è©±ï¼‰:**
```jsonc
{
  "session_id": "uuid",
  "message": "è¬è¬"  // æˆ–ã€Œæ²’æœ‰ã€ã€ã€Œä¸ç”¨äº†ã€ç­‰çµæŸé—œéµè©
}
```

**Response (ä»˜è²»ç‰ˆçµæŸ):**
```jsonc
{
  "session_id": "uuid",
  "response": "[ç¥æ˜ç‰¹è‰²çµæŸèªï¼Œå¦‚æœˆè€ï¼šã€Œæ—¢ç„¶æ²’æœ‰å…¶ä»–å•é¡Œï¼Œé‚£å°±ç¥ä½ è‰¯ç·£æ—©è‡³ï¼Œå¹¸ç¦ç¾æ»¿ã€‚ã€]",
  "state": "completed"
}
```


### ğŸ”„ é‡ç½®æœƒè©±
`POST /auspicious/{version}/api/reset`

**Request:**
```jsonc
{
  "session_id": "uuid"
}
```

**Response:**
```jsonc
{
  "success": true,
  "message": "æœƒè©±å·²é‡ç½®"
}
```

---

## 1ï¸âƒ£ åˆå§‹åŒ–å°è©±

### **POST** `/life/{version}/api/init_with_tone`

**å®Œæ•´è·¯å¾‘ï¼š**
- å…è²»ç‰ˆï¼š`/life/free/api/init_with_tone`
- ä»˜è²»ç‰ˆï¼š`/life/paid/api/init_with_tone`

#### Request Body
```jsonc
{
  "tone": "string"  // èªæ°£é¸æ“‡
}
```

**èªæ°£é¸é …ï¼š**

**1. ç”Ÿå‘½éˆæ•¸ (Life Number)**
- **å…è²»ç‰ˆ**: `friendly`, `caring`, `ritual`
- **ä»˜è²»ç‰ˆ**: `guan_yu` (é—œè–å¸å›), `michael` (å¤§å¤©ä½¿ç±³è¿¦å‹’) ç­‰ 10 ç¨®å¤§å¤©ä½¿èˆ‡ç¥æ˜

**2. å¤©ä½¿æ•¸å­— (Angel Number)**
- **å…è²»ç‰ˆ**: `friendly`, `caring`, `ritual`
- **ä»˜è²»ç‰ˆ**: 
  - `guan_yu` (é—œè–å¸å›)
  - `michael` (å¤§å¤©ä½¿ç±³è¿¦å‹’)
  - `gabriel` (å¤§å¤©ä½¿åŠ ç™¾åˆ—)
  - `raphael` (å¤§å¤©ä½¿æ‹‰æ–çˆ¾)
  - `uriel` (å¤§å¤©ä½¿çƒåˆ—çˆ¾)
  - `zadkiel` (å¤§å¤©ä½¿æ²™å¾·åŸºçˆ¾)
  - `jophiel` (å¤§å¤©ä½¿å–¬è²çˆ¾)
  - `chamuel` (å¤§å¤©ä½¿æ²™æœ¨çˆ¾)
  - `metatron` (å¤§å¤©ä½¿æ¢…å¡”ç‰¹éš†)
  - `ariel` (å¤§å¤©ä½¿é˜¿åˆ—çˆ¾)

**3. æ“²ç­Š (Divination)**
- **å…è²»ç‰ˆ**: `friendly`, `caring`, `ritual`
- **ä»˜è²»ç‰ˆ**:
  - `guan_gong` (é—œè–å¸å›)
  - `wealth_god` (äº”è·¯è²¡ç¥)
  - `wen_chang` (æ–‡æ˜Œå¸å›)
  - `yue_lao` (æœˆè€æ˜Ÿå›)
  - `guanyin` (è§€éŸ³è©è–©)
  - `mazu` (åª½ç¥–)
  - `jiutian` (ä¹å¤©å¨˜å¨˜)
  - `guanyin_health` (è§€éŸ³è©è–©-å¥åº·)
  - `fude` (ç¦å¾·æ­£ç¥)

**4. é»ƒé“å‰æ—¥ (Auspicious Date)**
- **å…è²»ç‰ˆ**: `friendly` (è¦ªåˆ‡), `caring` (è²¼å¿ƒ), `ritual` (å„€å¼)
- **ä»˜è²»ç‰ˆ**: å¾…è¦åŠƒ

#### Response
```jsonc
{
  "session_id": "uuid-string",  // â­ å¾Œç«¯ç”Ÿæˆçš„æœƒè©±IDï¼Œå‰ç«¯å¿…é ˆä¿å­˜
  "response": "å•å€™èªå…§å®¹",
  "state": "waiting_basic_info",
  "current_module": null
}
```

#### ç¯„ä¾‹

**ç”Ÿç”¢ç’°å¢ƒï¼š**
```bash
# Request
curl -X POST https://your-service-url.a.run.app/life/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'

# Response
{
  "session_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "response": "å—¨ï¼æ­¡è¿ä¾†åˆ°ç”Ÿå‘½éˆæ•¸çš„ä¸–ç•Œï½",
  "state": "waiting_basic_info",
  "current_module": null
}
```

**æœ¬åœ°é–‹ç™¼ï¼š**
```bash
# Request
curl -X POST http://localhost:8080/life/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'
```

---

## 2ï¸âƒ£ å°è©±äº’å‹•

### **POST** `/life/{version}/api/chat`

**å®Œæ•´è·¯å¾‘ï¼š**
- å…è²»ç‰ˆï¼š`/life/free/api/chat`
- ä»˜è²»ç‰ˆï¼š`/life/paid/api/chat`

#### Request Body
```jsonc
{
  "session_id": "string",  // â­ å¿…é ˆï¼šç”± init_with_tone è¿”å›çš„æœƒè©±ID
  "message": "string"      // å¿…é ˆï¼šç”¨æˆ¶è¼¸å…¥å…§å®¹
}
```

#### Response
```jsonc
{
  "session_id": "string",       // å›å‚³åŸsession_id
  "response": "AIå›æ‡‰å…§å®¹",
  "state": "ç•¶å‰ç‹€æ…‹",
  "current_module": "ç•¶å‰æ¨¡çµ„"  // å¦‚æœ‰
}
```

#### å¯èƒ½çš„ç‹€æ…‹å€¼
- `waiting_basic_info` - ç­‰å¾…åŸºæœ¬è³‡è¨Š
- `waiting_module_selection` - ç­‰å¾…æ¨¡çµ„é¸æ“‡
- `core_category_selection` - æ ¸å¿ƒæ¨¡çµ„é¡åˆ¥é¸æ“‡ï¼ˆâš ï¸ åƒ… core æ¨¡çµ„ï¼Œä»˜è²»ç‰ˆå°ˆå±¬ï¼‰
- `waiting_core_question` - ç­‰å¾…æ ¸å¿ƒæ¨¡çµ„å•é¡Œï¼ˆä»˜è²»ç‰ˆï¼‰
- `waiting_question` - ç­‰å¾…æ·±åº¦å•é¡Œï¼ˆä»˜è²»ç‰ˆï¼‰
- `continue_selection` - ç¹¼çºŒé¸é …
- `completed` - å·²å®Œæˆ

**é»ƒé“å‰æ—¥å°ˆå±¬ï¼š**
- `waiting_category_and_date` - ç­‰å¾…åˆ†é¡èˆ‡æ—¥æœŸé¸æ“‡
- `waiting_specific_question` - ç­‰å¾…å…·é«”å•é¡Œ
- `providing_dates` - æä¾›å‰æ—¥å»ºè­°

> ğŸ“ **é‡è¦**ï¼š`core_category_selection` ç‹€æ…‹åªæœƒåœ¨ä»˜è²»ç‰ˆé¸æ“‡ `core` æ¨¡çµ„æ™‚å‡ºç¾ã€‚
å…¶ä»–æ¨¡çµ„ï¼ˆbirthday, year, grid, soul, personality, expression, maturity, challenge, karmaï¼‰ä¸æœƒé€²å…¥æ­¤ç‹€æ…‹ï¼Œæœƒç›´æ¥åŸ·è¡Œæ¨¡çµ„åˆ†æã€‚

---

## ğŸ”€ å®Œæ•´å°è©±æµç¨‹èªªæ˜

### ä»˜è²»ç‰ˆå®Œæ•´æµç¨‹

```
æ­¥é©Ÿ 1: åˆå§‹åŒ–ï¼ˆinit_with_toneï¼‰
    â†“
æ­¥é©Ÿ 2: æäº¤åŸºæœ¬è³‡è¨Šï¼ˆå§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥ã€è‹±æ–‡åï¼‰
    â†“
æ­¥é©Ÿ 3: ç³»çµ±é¡¯ç¤º 10 å€‹å¯ç”¨æ¨¡çµ„
    â”œâ”€ coreï¼ˆæ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘ï¼‰
    â”œâ”€ birthdayï¼ˆå¤©ç”Ÿæ‰è¯ï¼‰
    â”œâ”€ yearï¼ˆå¹´åº¦é‹å‹¢èˆ‡é€£ç·šï¼‰
    â”œâ”€ gridï¼ˆä¹å®®æ ¼ï¼‰
    â”œâ”€ soulï¼ˆéˆé­‚æ•¸ï¼‰
    â”œâ”€ personalityï¼ˆäººæ ¼æ•¸ï¼‰
    â”œâ”€ expressionï¼ˆè¡¨é”æ•¸ï¼‰
    â”œâ”€ maturityï¼ˆæˆç†Ÿæ•¸ï¼‰
    â”œâ”€ challengeï¼ˆæŒ‘æˆ°æ•¸ï¼‰
    â””â”€ karmaï¼ˆæ¥­åŠ›æ•¸ï¼‰
    â†“
æ­¥é©Ÿ 4: ç”¨æˆ¶é¸æ“‡å…¶ä¸­ä¸€å€‹æ¨¡çµ„
    â†“
    â”œâ”€ å¦‚æœé¸æ“‡ ã€coreã€‘â†’ ç‰¹æ®Šæµç¨‹ â”€â”
    â”‚                                  â”‚
    â””â”€ å¦‚æœé¸æ“‡ ã€å…¶ä»–æ¨¡çµ„ã€‘â†’ æ¨™æº–æµç¨‹ â”‚
                                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€ã€core ç‰¹æ®Šæµç¨‹ã€‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŸ·è¡Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸è¨ˆç®— â­                â”‚
â”‚      â†“                                â”‚
â”‚  é¡¯ç¤ºå®Œæ•´åˆ†æçµæœï¼ˆå«ç”Ÿå‘½éˆæ•¸æ•¸å­—ï¼‰     â”‚
â”‚      +                                â”‚
â”‚  é¡¯ç¤ºé¡åˆ¥é¸æ“‡æŒ‰éˆ•                      â”‚
â”‚      â†“                                â”‚
â”‚  é€²å…¥ core_category_selection ç‹€æ…‹     â”‚
â”‚      â†“                                â”‚
â”‚  ç”¨æˆ¶é¸æ“‡é¡åˆ¥ï¼š                        â”‚
â”‚    â€¢ è²¡é‹äº‹æ¥­                          â”‚
â”‚    â€¢ å®¶åº­äººéš›                          â”‚
â”‚    â€¢ è‡ªæˆ‘æˆé•·                          â”‚
â”‚    â€¢ ç›®æ¨™è¦åŠƒ                          â”‚
â”‚      â†“                                â”‚
â”‚  é€²å…¥ waiting_core_question ç‹€æ…‹       â”‚
â”‚      â†“                                â”‚
â”‚  ç”¨æˆ¶æäº¤å…·é«”å•é¡Œ                      â”‚
â”‚      â†“                                â”‚
â”‚  æ ¹æ“šæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ + é¡åˆ¥ + å•é¡Œ        â”‚
â”‚  æä¾›æ·±åº¦å€‹æ€§åŒ–åˆ†æ                    â”‚
â”‚      â†“                                â”‚
â”‚  é€²å…¥ continue_selection ç‹€æ…‹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”œâ”€ã€å…¶ä»–æ¨¡çµ„æ¨™æº–æµç¨‹ã€‘â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç›´æ¥åŸ·è¡Œæ¨¡çµ„åˆ†æ                      â”‚
â”‚      â†“                                â”‚
â”‚  ç²å¾—å®Œæ•´åˆ†æçµæœ                      â”‚
â”‚      â†“                                â”‚
â”‚  é€²å…¥ continue_selection ç‹€æ…‹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æ­¥é©Ÿ 5: åœ¨ continue_selection ç‹€æ…‹ï¼Œç”¨æˆ¶å¯é¸æ“‡ï¼š
    â”œâ”€ ç¹¼çºŒå•å•é¡Œï¼ˆæ·±åº¦æå•ï¼Œä»˜è²»ç‰ˆå°ˆå±¬ï¼‰
    â”œâ”€ å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼ˆå›åˆ°æ­¥é©Ÿ 3ï¼‰
    â””â”€ é›¢é–‹ï¼ˆç”Ÿæˆå°è©±ç¸½çµï¼Œå«ç”¢å“æ¨è–¦ï¼‰
```

> âš ï¸ **é—œéµé‡é»**ï¼š
> 1. æäº¤åŸºæœ¬è³‡è¨Šå¾Œï¼Œ**ä¸€å®šæœƒå…ˆè®“ç”¨æˆ¶å¾ 10 å€‹æ¨¡çµ„ä¸­é¸æ“‡ä¸€å€‹**
> 2. é¡åˆ¥é¸æ“‡ï¼ˆè²¡é‹äº‹æ¥­ç­‰ï¼‰**ä¸æ˜¯æ¨¡çµ„é¸æ“‡**ï¼Œè€Œæ˜¯**åªåœ¨é¸æ“‡ core æ¨¡çµ„å¾Œæ‰å‡ºç¾çš„é¡å¤–æ­¥é©Ÿ**
> 3. å…¶ä»– 9 å€‹æ¨¡çµ„ï¼ˆbirthday, year, grid, soul ç­‰ï¼‰é¸æ“‡å¾Œç›´æ¥çµ¦åˆ†æï¼Œç„¡é¡åˆ¥é¸æ“‡

---

## ğŸ“ å®Œæ•´å°è©±æµç¨‹ç¯„ä¾‹

### **å…è²»ç‰ˆæµç¨‹**

#### æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–
```jsonc
POST /life/free/api/init_with_tone
Request: {"tone": "friendly"}
Response: {
  "session_id": "session-123",
  "response": "å—¨ï¼æ­¡è¿ä¾†åˆ°ç”Ÿå‘½éˆæ•¸ï½",
  "state": "waiting_basic_info"
}
```

#### æ­¥é©Ÿ 2ï¼šæäº¤åŸºæœ¬è³‡è¨Š
```jsonc
POST /life/free/api/chat
Request: {
  "session_id": "session-123",
  "message": "ç‹å°æ˜ male 1990/07/12"
}
Response: {
  "session_id": "session-123",
  "response": "ç‹å…ˆç”Ÿæ‚¨å¥½ï¼...\n\nè«‹é¸æ“‡æ‚¨æƒ³äº†è§£çš„ç”Ÿå‘½éˆæ•¸ï¼š\n1. core - æ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘\n2. birthday - å¤©ç”Ÿæ‰è¯\n3. year - å¹´åº¦é‹å‹¢èˆ‡é€£ç·š\n4. grid - ä¹å®®æ ¼",
  "state": "waiting_module_selection"
}
```
> ğŸ“Œ **å…è²»ç‰ˆæœ‰ 4 å€‹æ¨¡çµ„å¯é¸ï¼Œä¸” core æ¨¡çµ„æ²’æœ‰é¡åˆ¥é¸æ“‡**

#### æ­¥é©Ÿ 3ï¼šå¾ 4 å€‹æ¨¡çµ„ä¸­é¸æ“‡ä¸€å€‹ï¼ˆä¾‹å¦‚ï¼šcoreï¼‰
```jsonc
POST /life/free/api/chat
Request: {
  "session_id": "session-123",
  "message": "core"
}
Response: {
  "session_id": "session-123",
  "response": "æ‚¨çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸æ˜¯ 5...\n\nï¼ˆå®Œæ•´åˆ†æå…§å®¹ï¼‰",
  "state": "continue_selection",
  "current_module": "core",
  "number": 5
}
```
> ğŸ“Œ **å…è²»ç‰ˆï¼šç›´æ¥çµ¦å‡ºå®Œæ•´åˆ†æï¼Œæ²’æœ‰é¡åˆ¥é¸æ“‡**

#### æ­¥é©Ÿ 4ï¼šé¸æ“‡é›¢é–‹
```jsonc
POST /life/free/api/chat
Request: {
  "session_id": "session-123",
  "message": "é›¢é–‹"
}
Response: {
  "session_id": "session-123",
  "response": "æ„Ÿè¬ä½¿ç”¨ï¼",
  "state": "completed"
}
```

---

### **ä»˜è²»ç‰ˆæµç¨‹ï¼ˆå«ä»˜è²»åŠŸèƒ½ï¼‰**

#### æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–
```jsonc
POST /life/paid/api/init_with_tone
Request: {"tone": "guan_yu"}
Response: {
  "session_id": "session-456",
  "response": "æœ¬å›åœ¨æ­¤ï¼Œæº–å‚™ç‚ºæ±è§£æƒ‘...",
  "state": "waiting_basic_info"
}
```

#### æ­¥é©Ÿ 2ï¼šæäº¤åŸºæœ¬è³‡è¨Šï¼ˆå«è‹±æ–‡åï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "æå°è¯ female 1985/03/25 LEE XIAO HUA"
}
Response: {
  "session_id": "session-456",
  "response": "æå¥³å£«ï¼Œæœ¬å›å·²æ‚‰çŸ¥æ±ä¹‹ç”Ÿè¾°...\n\nè«‹é¸æ“‡æ‚¨æƒ³äº†è§£çš„ç”Ÿå‘½éˆæ•¸ï¼š\n1. core - æ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘\n2. birthday - å¤©ç”Ÿæ‰è¯\n3. year - å¹´åº¦é‹å‹¢èˆ‡é€£ç·š\n4. grid - ä¹å®®æ ¼\n5. soul - éˆé­‚æ•¸\n6. personality - äººæ ¼æ•¸\n7. expression - è¡¨é”æ•¸\n8. maturity - æˆç†Ÿæ•¸\n9. challenge - æŒ‘æˆ°æ•¸\n10. karma - æ¥­åŠ›æ•¸",
  "state": "waiting_module_selection"
}
```
> ğŸ“Œ **æ­¤æ™‚ç”¨æˆ¶éœ€è¦å¾ 10 å€‹æ¨¡çµ„ä¸­é¸æ“‡ä¸€å€‹**

#### æ­¥é©Ÿ 3ï¼šå¾ 10 å€‹æ¨¡çµ„ä¸­é¸æ“‡ coreï¼ˆç«‹å³è¨ˆç®—ä¸¦é¡¯ç¤ºçµæœ + é¡åˆ¥é¸æ“‡ï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "core"
}
Response: {
  "session_id": "session-456",
  "response": "æå¥³å£«ï¼Œæ‚¨å¥½ã€‚æ ¹æ“šæ‚¨çš„ç”Ÿè¾°è³‡è¨Šï¼Œæ‚¨çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸æ˜¯ 8ã€‚\n\nç”Ÿå‘½éˆæ•¸ 8 çš„äººå…·æœ‰å¼·å¤§çš„é ˜å°åŠ›å’Œå•†æ¥­é ­è…¦ï¼Œå¤©ç”Ÿæ“æœ‰æŒæ§å…¨å±€çš„èƒ½åŠ›...\n\nï¼ˆå®Œæ•´çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸åˆ†æï¼‰\n\nä»¥ä¸‹å››å¤§é¢å‘ä¾›ä½ é¸æ“‡æ¢ç´¢ã€‚é¸æ“‡ä¸€å€‹ï¼Œæˆ‘å°‡ç‚ºä½ æ·±å…¥åˆ†æã€‚\n\n1. è²¡é‹äº‹æ¥­\n2. å®¶åº­äººéš›\n3. è‡ªæˆ‘æˆé•·\n4. ç›®æ¨™è¦åŠƒ",
  "state": "core_category_selection",
  "current_module": "core",
  "number": 8,
  "show_category_buttons": true,
  "categories": ["è²¡é‹äº‹æ¥­", "å®¶åº­äººéš›", "è‡ªæˆ‘æˆé•·", "ç›®æ¨™è¦åŠƒ"]
}
```
> âœ¨ **é—œéµé‡é»**ï¼š
> 1. **ç«‹å³è¨ˆç®—ä¸¦é¡¯ç¤ºæ ¸å¿ƒç”Ÿå‘½éˆæ•¸çµæœ**ï¼ˆæ•¸å­— + å®Œæ•´åˆ†æï¼‰
> 2. **ç„¶å¾Œ**åœ¨çµæœå¾Œé¢é¡¯ç¤ºé¡åˆ¥é¸æ“‡
> 3. ç”¨æˆ¶å¯ä»¥æ ¹æ“šå·²çŸ¥çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ï¼Œé¸æ“‡æƒ³æ·±å…¥æ¢è¨çš„é¢å‘

#### æ­¥é©Ÿ 4ï¼šå¾ 4 å€‹é¡åˆ¥ä¸­é¸æ“‡ä¸€å€‹ï¼ˆä¾‹å¦‚ï¼šè²¡é‹äº‹æ¥­ï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "è²¡é‹äº‹æ¥­"
}
Response: {
  "session_id": "session-456",
  "response": "åœ¨è²¡é‹äº‹æ¥­é€™å€‹é¢å‘ï¼Œä½ æœ‰ä»€éº¼å…·é«”æƒ³äº†è§£çš„å•é¡Œå—ï¼Ÿ",
  "state": "waiting_core_question",
  "current_module": "core",
  "category": "è²¡é‹äº‹æ¥­"
}
```
> ğŸ“Œ **é¸æ“‡é¡åˆ¥å¾Œï¼Œç³»çµ±è¦æ±‚ç”¨æˆ¶æå‡ºå…·é«”å•é¡Œ**

#### æ­¥é©Ÿ 5ï¼šæäº¤å•é¡Œï¼ˆæ ¹æ“šé¡åˆ¥å’Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸æä¾›é‡å°æ€§åˆ†æï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "æˆ‘ä»Šå¹´é©åˆå‰µæ¥­å—ï¼Ÿ"
}
Response: {
  "session_id": "session-456",
  "response": "æ ¹æ“šæ‚¨çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ 8 ä»¥åŠè²¡é‹äº‹æ¥­é€™å€‹é¢å‘ï¼Œè®“æˆ‘ç‚ºæ‚¨åˆ†æ...\n\nç”Ÿå‘½éˆæ•¸ 8 åœ¨å‰µæ¥­æ–¹é¢å…·æœ‰å¤©ç”Ÿçš„å„ªå‹¢ã€‚æ‚¨çš„é ˜å°åŠ›ã€å•†æ¥­é ­è…¦å’ŒæŒæ§å…¨å±€çš„èƒ½åŠ›ï¼Œéƒ½æ˜¯å‰µæ¥­æˆåŠŸçš„é—œéµè¦ç´ ...\n\nï¼ˆé‡å°å‰µæ¥­å•é¡Œçš„æ·±åº¦åˆ†æï¼ŒåŸºæ–¼æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ 8 å’Œè²¡é‹äº‹æ¥­é¡åˆ¥ï¼‰",
  "state": "continue_selection",
  "current_module": "core",
  "number": 8
}
```
> âœ¨ **æ ¹æ“šå·²è¨ˆç®—çš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ï¼ˆ8ï¼‰ã€é¸æ“‡çš„é¡åˆ¥ï¼ˆè²¡é‹äº‹æ¥­ï¼‰å’Œç”¨æˆ¶çš„å…·é«”å•é¡Œï¼Œæä¾›æ·±åº¦å€‹æ€§åŒ–åˆ†æ**

#### æ­¥é©Ÿ 6ï¼šé¸æ“‡ç¹¼çºŒå•å•é¡Œï¼ˆä»˜è²»ç‰ˆå°ˆå±¬ï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "ç¹¼çºŒå•å•é¡Œ"
}
Response: {
  "session_id": "session-456",
  "response": "è«‹å•æ‚¨é‚„æƒ³äº†è§£ä»€éº¼ï¼Ÿ",
  "state": "waiting_question",
  "current_module": "core"
}
```

#### æ­¥é©Ÿ 7ï¼šæäº¤æ·±åº¦å•é¡Œ
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "å‰µæ¥­æ™‚æ©Ÿè©²å¦‚ä½•é¸æ“‡ï¼Ÿ"
}
Response: {
  "session_id": "session-456",
  "response": "æ ¹æ“šæ‚¨çš„æµå¹´æ•¸...",
  "state": "continue_selection",
  "current_module": "core"
}
```

#### æ­¥é©Ÿ 8ï¼šé¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "å…¶ä»–ç”Ÿå‘½éˆæ•¸"
}
Response: {
  "session_id": "session-456",
  "response": "æå¥³å£«ï¼Œæƒ³äº†è§£å…¶ä»–é¢å‘å—ï¼Ÿ",
  "state": "waiting_module_selection",
  "current_module": null
}
```

#### æ­¥é©Ÿ 9ï¼šé›¢é–‹ï¼ˆç”Ÿæˆå°è©±ç¸½çµï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-456",
  "message": "é›¢é–‹"
}
Response: {
  "session_id": "session-456",
  "response": "ä»Šå¤©ç‚ºæ‚¨è§£æäº†...ï¼ˆå«æ°´æ™¶å’Œé»ç‡ˆæ¨è–¦ï¼‰",
  "state": "completed"
}
```

---

### **ä»˜è²»ç‰ˆæµç¨‹ï¼ˆé core æ¨¡çµ„ç¤ºä¾‹ï¼‰**

> ğŸ“Œ **èªªæ˜**ï¼šç•¶å¾ 10 å€‹æ¨¡çµ„ä¸­é¸æ“‡ core ä»¥å¤–çš„æ¨¡çµ„æ™‚ï¼Œä¸æœƒæœ‰é¡åˆ¥é¸æ“‡ï¼Œç›´æ¥åŸ·è¡Œæ¨¡çµ„åˆ†æã€‚

#### æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–ï¼ˆåŒä¸Šï¼‰
ï¼ˆçœç•¥ï¼‰

#### æ­¥é©Ÿ 2ï¼šæäº¤åŸºæœ¬è³‡è¨Š
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-789",
  "message": "æå°è¯ female 1985/03/25 LEE XIAO HUA"
}
Response: {
  "session_id": "session-789",
  "response": "æå¥³å£«ï¼Œæœ¬å›å·²æ‚‰çŸ¥æ±ä¹‹ç”Ÿè¾°...\n\nè«‹é¸æ“‡æ‚¨æƒ³äº†è§£çš„ç”Ÿå‘½éˆæ•¸ï¼š\n1. core - æ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘\n2. birthday - å¤©ç”Ÿæ‰è¯\n3. year - å¹´åº¦é‹å‹¢èˆ‡é€£ç·š\n...\n10. karma - æ¥­åŠ›æ•¸",
  "state": "waiting_module_selection"
}
```
> ğŸ“Œ **ç³»çµ±é¡¯ç¤º 10 å€‹å¯é¸æ¨¡çµ„**

#### æ­¥é©Ÿ 3ï¼šå¾ 10 å€‹æ¨¡çµ„ä¸­é¸æ“‡ birthdayï¼ˆé core æ¨¡çµ„ï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-789",
  "message": "birthday"
}
Response: {
  "session_id": "session-789",
  "response": "æ‚¨çš„ç”Ÿæ—¥éˆæ•¸æ˜¯ 3ï¼Œä»£è¡¨è‘—å‰µé€ åŠ›èˆ‡è¡¨é”èƒ½åŠ›...",
  "state": "continue_selection",
  "current_module": "birthday",
  "number": 3
}
```
> âš ï¸ **æ³¨æ„**ï¼šç›´æ¥é€²å…¥ `continue_selection` ç‹€æ…‹ï¼Œæ²’æœ‰ `core_category_selection` éšæ®µ

#### æ­¥é©Ÿ 4ï¼šç¹¼çºŒå•å•é¡Œï¼ˆä»˜è²»ç‰ˆå°ˆå±¬ï¼‰
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-789",
  "message": "ç¹¼çºŒå•å•é¡Œ"
}
Response: {
  "session_id": "session-789",
  "response": "è«‹å•æ‚¨å°ç”Ÿæ—¥éˆæ•¸é‚„æœ‰ä»€éº¼æƒ³äº†è§£çš„ï¼Ÿ",
  "state": "waiting_question",
  "current_module": "birthday"
}
```

#### æ­¥é©Ÿ 5ï¼šæå•æ·±åº¦å•é¡Œ
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-789",
  "message": "ç”Ÿæ—¥éˆæ•¸ 3 åœ¨è·å ´ä¸Šè©²å¦‚ä½•ç™¼æ®å„ªå‹¢ï¼Ÿ"
}
Response: {
  "session_id": "session-789",
  "response": "ç”Ÿæ—¥éˆæ•¸ 3 çš„æ‚¨åœ¨è·å ´ä¸Š...",
  "state": "continue_selection",
  "current_module": "birthday"
}
```

#### æ­¥é©Ÿ 6ï¼šé¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸
```jsonc
POST /life/paid/api/chat
Request: {
  "session_id": "session-789",
  "message": "å…¶ä»–ç”Ÿå‘½éˆæ•¸"
}
Response: {
  "session_id": "session-789",
  "response": "æå¥³å£«ï¼Œæƒ³äº†è§£å…¶ä»–é¢å‘å—ï¼Ÿ",
  "state": "waiting_module_selection",
  "current_module": null
}
```

---

## 3ï¸âƒ£ é‡ç½®æœƒè©±

### **POST** `/life/{version}/api/reset`

**å®Œæ•´è·¯å¾‘ï¼š**
- å…è²»ç‰ˆï¼š`/life/free/api/reset`
- ä»˜è²»ç‰ˆï¼š`/life/paid/api/reset`

#### Request Body
```jsonc
{
  "session_id": "string"  // å¯é¸ï¼šè¦åˆªé™¤çš„æœƒè©±ID
}
```

#### Response
```jsonc
{
  "success": true
}
```

---

## ğŸ”‘ é—œéµç‰¹é»

### âœ… Session ID æ©Ÿåˆ¶
- **å¾Œç«¯ç”Ÿæˆ**ï¼š`init_with_tone` æ™‚ç”±å¾Œç«¯å‰µå»ºå”¯ä¸€ UUID
- **å‰ç«¯ä¿å­˜**ï¼šå‰ç«¯å¿…é ˆä¿å­˜ä¸¦åœ¨æ‰€æœ‰å¾ŒçºŒè«‹æ±‚ä¸­å‚³é
- **æœƒè©±éš”é›¢**ï¼šä¸åŒç”¨æˆ¶ä½¿ç”¨ä¸åŒçš„ `session_id`ï¼Œäº’ä¸å¹²æ“¾
- **ç„¡éœ€ç™»å…¥**ï¼šå…è²»ç”¨æˆ¶å’Œä»˜è²»ç”¨æˆ¶éƒ½ä½¿ç”¨ç›¸åŒæ©Ÿåˆ¶ï¼Œç„¡éœ€é¡å¤–çš„ `user_id`

### ğŸ†“ å…è²»ç‰ˆç‰¹é»

**å¯ç”¨æ¨¡çµ„ï¼ˆ4å€‹ï¼‰ï¼š**
- `core` - æ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘
- `birthday` - å¤©ç”Ÿæ‰è¯
- `year` - å¹´åº¦é‹å‹¢èˆ‡é€£ç·š
- `grid` - å¤©è³¦å„ªå‹¢èˆ‡åœ¨è·ç‰¹è³ªåŠç¼ºçš„ç‰¹è³ª ä¹å®®æ ¼

**å¯ç”¨èªæ°£ï¼ˆ3å€‹ï¼‰ï¼š**
- `friendly` - è¦ªåˆ‡ç‰ˆ
- `caring` - è²¼å¿ƒç‰ˆ
- `ritual` - å„€å¼ç‰ˆ

**åŠŸèƒ½é™åˆ¶ï¼š**
- âŒ ä¸éœ€è¦è‹±æ–‡å
- âŒ å–®æ¬¡å°è©±ï¼Œç„¡æ·±åº¦æå•åŠŸèƒ½
- âŒ ç„¡æ ¸å¿ƒæ¨¡çµ„é¡åˆ¥é¸æ“‡
- âŒ ç„¡å°è©±ç¸½çµèˆ‡ç”¢å“æ¨è–¦

### ğŸ’ ä»˜è²»ç‰ˆç‰¹é»

**å¯ç”¨æ¨¡çµ„ï¼ˆ10å€‹ï¼‰ï¼š**
- `core` - æ ¸å¿ƒå¤©è³¦äººç”Ÿæ–¹å‘
- `birthday` - å¤©ç”Ÿæ‰è¯
- `year` - å¹´åº¦é‹å‹¢èˆ‡é€£ç·š
- `grid` - å¤©è³¦å„ªå‹¢èˆ‡åœ¨è·ç‰¹è³ª ä¹å®®æ ¼
- `soul` - éˆé­‚æ•¸ - å…§å¿ƒçœŸæ­£çš„æ¸´æœ›
- `personality` - äººæ ¼æ•¸ - å¤–åœ¨å±•ç¾çš„å½¢è±¡
- `expression` - è¡¨é”æ•¸ - æºé€šèˆ‡è¡¨é”æ–¹å¼
- `maturity` - æˆç†Ÿæ•¸ - ä¸­å¹´å¾Œçš„ç™¼å±•
- `challenge` - æŒ‘æˆ°æ•¸ - éœ€è¦å…‹æœçš„èª²é¡Œ
- `karma` - æ¥­åŠ›æ•¸ - å‰ä¸–ä»Šç”Ÿçš„å› æœ

**å¯ç”¨èªæ°£ï¼ˆ10å€‹ï¼‰ï¼š**
- `guan_yu` - é—œè–å¸å›
- `michael` - å¤§å¤©ä½¿ç±³è¿¦å‹’
- `gabriel` - å¤§å¤©ä½¿åŠ ç™¾åˆ—
- `raphael` - å¤§å¤©ä½¿æ‹‰æ–çˆ¾
- `uriel` - å¤§å¤©ä½¿çƒåˆ—çˆ¾
- `zadkiel` - å¤§å¤©ä½¿æ²™å¾·åŸºçˆ¾
- `jophiel` - å¤§å¤©ä½¿å–¬è²çˆ¾
- `chamuel` - å¤§å¤©ä½¿æ²™æœ¨çˆ¾
- `metatron` - å¤§å¤©ä½¿æ¢…å¡”ç‰¹éš†
- `ariel` - å¤§å¤©ä½¿é˜¿åˆ—çˆ¾

**ç¨å®¶åŠŸèƒ½ï¼š**
- âœ… **å¿…é ˆæä¾›è‹±æ–‡å**ï¼ˆç”¨æ–¼éˆé­‚ã€äººæ ¼ã€è¡¨é”æ•¸è¨ˆç®—ï¼‰
- âœ… **æ ¸å¿ƒæ¨¡çµ„ï¼ˆcoreï¼‰å°ˆå±¬é¡åˆ¥é¸æ“‡**
  - åªæœ‰é¸æ“‡ `core` æ¨¡çµ„æ™‚æ‰æœƒè§¸ç™¼é¡åˆ¥é¸æ“‡
  - å››å¤§é¡åˆ¥ï¼šè²¡é‹äº‹æ¥­ã€å®¶åº­äººéš›ã€è‡ªæˆ‘æˆé•·ã€ç›®æ¨™è¦åŠƒ
  - å…¶ä»–æ¨¡çµ„ï¼ˆbirthday, year, grid, soul ç­‰ï¼‰ç„¡é¡åˆ¥é¸æ“‡
- âœ… **æ·±åº¦å°è©±åŠŸèƒ½**ï¼šæ”¯æŒã€Œç¹¼çºŒå•å•é¡Œã€
- âœ… **å°è©±ç¸½çµ**ï¼šé›¢é–‹æ™‚ç”Ÿæˆå®Œæ•´ç¸½çµï¼ŒåŒ…å«æ°´æ™¶å’Œé»ç‡ˆæ¨è–¦

---

---

## ğŸ¨ å‰ç«¯ UI é¡¯ç¤ºæŒ‡å— (Frontend UI Guide)

æœ¬ç¯€èªªæ˜åœ¨ä¸åŒç‹€æ…‹ä¸‹ï¼Œå‰ç«¯æ‡‰é¡¯ç¤ºçš„ UI å…ƒä»¶èˆ‡äº’å‹•æ–¹å¼ã€‚

### 1. ç”Ÿå‘½éˆæ•¸ (Life Number)

| ç‹€æ…‹ (`state`) | èªªæ˜ | å»ºè­° UI é¡¯ç¤º |
|---|---|---|
| `waiting_basic_info` | ç­‰å¾…åŸºæœ¬è³‡è¨Š | **è¡¨å–®è¼¸å…¥**ï¼š<br>- å§“å (Text)<br>- æ€§åˆ¥ (Select: ç”·/å¥³)<br>- ç”Ÿæ—¥ (Date Picker)<br>- è‹±æ–‡å (Text, åƒ…ä»˜è²»ç‰ˆ) |
| `waiting_module_selection` | ç­‰å¾…æ¨¡çµ„é¸æ“‡ | **æŒ‰éˆ•åˆ—è¡¨**ï¼š<br>- å…è²»ç‰ˆï¼šé¡¯ç¤º 4 å€‹æ¨¡çµ„æŒ‰éˆ• (Core, Birthday, Year, Grid)<br>- ä»˜è²»ç‰ˆï¼šé¡¯ç¤º 10 å€‹æ¨¡çµ„æŒ‰éˆ• |
| `core_category_selection` | æ ¸å¿ƒæ¨¡çµ„é¡åˆ¥é¸æ“‡<br>(åƒ…ä»˜è²»ç‰ˆ Core) | **æŒ‰éˆ•åˆ—è¡¨**ï¼š<br>- è²¡é‹äº‹æ¥­<br>- å®¶åº­äººéš›<br>- è‡ªæˆ‘æˆé•·<br>- ç›®æ¨™è¦åŠƒ |
| `waiting_core_question` | ç­‰å¾…æ ¸å¿ƒæ¨¡çµ„å•é¡Œ<br>(åƒ…ä»˜è²»ç‰ˆ Core) | **æ–‡å­—è¼¸å…¥æ¡†**ï¼š<br>- æç¤ºèªï¼šã€Œè«‹è¼¸å…¥æ‚¨æƒ³äº†è§£çš„å…·é«”å•é¡Œ...ã€<br>- ç™¼é€æŒ‰éˆ• |
| `waiting_question` | ç­‰å¾…æ·±åº¦å•é¡Œ<br>(ä»˜è²»ç‰ˆæ·±åº¦å°è©±) | **æ–‡å­—è¼¸å…¥æ¡†**ï¼š<br>- æç¤ºèªï¼šã€Œè«‹è¼¸å…¥æ‚¨çš„å•é¡Œ...ã€<br>- ç™¼é€æŒ‰éˆ• |
| `continue_selection` | ç¹¼çºŒé¸é … | **æ“ä½œæŒ‰éˆ•**ï¼š<br>- ã€Œç¹¼çºŒå•å•é¡Œã€(åƒ…ä»˜è²»ç‰ˆ)<br>- ã€Œé¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ã€<br>- ã€Œé›¢é–‹ã€ |
| `completed` | å·²å®Œæˆ | **çµæŸç•«é¢**ï¼š<br>- é¡¯ç¤ºç¸½çµèˆ‡ç¥ç¦<br>- ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ• |

### 2. å¤©ä½¿æ•¸å­— (Angel Number)

| ç‹€æ…‹ (`state`) | èªªæ˜ | å»ºè­° UI é¡¯ç¤º |
|---|---|---|
| `waiting_basic_info` | ç­‰å¾…åŸºæœ¬è³‡è¨Š | **è¡¨å–®è¼¸å…¥**ï¼š<br>- å§“å (Text)<br>- æ€§åˆ¥ (Select: ç”·/å¥³)<br>- ç”Ÿæ—¥ (Date Picker) |
| `waiting_angel_number` | ç­‰å¾…å¤©ä½¿æ•¸å­— | **å…è²»ç‰ˆ**ï¼šä¸‹æ‹‰é¸å–®æˆ–æŒ‰éˆ• (1111, 2222... 9999)<br>**ä»˜è²»ç‰ˆ**ï¼šæ•¸å­—è¼¸å…¥æ¡† (Number Input) |
| `asking_for_question` | è©¢å•æ˜¯å¦æœ‰å•é¡Œ<br>(åƒ…ä»˜è²»ç‰ˆ) | **å°è©±ä»‹é¢**ï¼š<br>- æ–‡å­—è¼¸å…¥æ¡† (è¼¸å…¥å•é¡Œ)<br>- ã€Œæ²’æœ‰å•é¡Œ/è¬è¬ã€æŒ‰éˆ• (çµæŸå°è©±) |
| `completed` | å·²å®Œæˆ | **çµæŸç•«é¢**ï¼š<br>- é¡¯ç¤ºå®Œæ•´è§£è®€<br>- ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ• |

### 3. æ“²ç­Š (Divination)

| ç‹€æ…‹ (`state`) | èªªæ˜ | å»ºè­° UI é¡¯ç¤º |
|---|---|---|
| `waiting_basic_info` | ç­‰å¾…åŸºæœ¬è³‡è¨Š | **è¡¨å–®è¼¸å…¥**ï¼š<br>- å§“å (Text)<br>- æ€§åˆ¥ (Select: ç”·/å¥³)<br>- ç”Ÿæ—¥ (Date Picker) |
| `waiting_question` | ç­‰å¾…æå• | **æ–‡å­—è¼¸å…¥æ¡†**ï¼š<br>- æç¤ºèªï¼šã€Œè«‹èª å¿ƒè¼¸å…¥æ‚¨çš„å•é¡Œ...ã€<br>- ã€Œé–‹å§‹æ“²ç­Šã€æŒ‰éˆ• |
| `divining` | æ“²ç­Šä¸­ (éæ¸¡ç‹€æ…‹) | **å‹•ç•«æ•ˆæœ**ï¼š<br>- é¡¯ç¤ºæ“²ç­Šå‹•ç•«æˆ– Loading æ•ˆæœ<br>- éš¨å¾Œè‡ªå‹•é¡¯ç¤ºçµæœ |
| `asking_for_question` | æŒçºŒæå•<br>(åƒ…ä»˜è²»ç‰ˆ) | **å°è©±ä»‹é¢**ï¼š<br>- æ–‡å­—è¼¸å…¥æ¡† (è¼¸å…¥è¿½å•)<br>- ã€Œæ²’æœ‰å•é¡Œ/è¬è¬ã€æŒ‰éˆ• (çµæŸå°è©±) |
| `completed` | å·²å®Œæˆ | **çµæŸç•«é¢**ï¼š<br>- å…è²»ç‰ˆï¼šé¡¯ç¤ºå–®æ¬¡æ“²ç­Šçµæœ (è–/ç¬‘/é™°) èˆ‡è§£è®€<br>- ä»˜è²»ç‰ˆï¼šé¡¯ç¤ºä¸‰æ¬¡æ“²ç­Šçµæœï¼ˆå¦‚ã€Œè–ç­Š â†’ ç¬‘ç­Š â†’ é™°ç­Šã€ï¼‰+ çµ„åˆé¡å‹ + AI è§£è®€<br>- ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ• |

### 4. é»ƒé“å‰æ—¥ (Auspicious Date)

| ç‹€æ…‹ (`state`) | èªªæ˜ | å»ºè­° UI é¡¯ç¤º |
|---|---|---|
| `waiting_basic_info` | ç­‰å¾…åŸºæœ¬è³‡è¨Š | **è¡¨å–®è¼¸å…¥**ï¼š<br>- å§“å (Text)<br>- æ€§åˆ¥ (Select: ç”·/å¥³)<br>- ç”Ÿæ—¥ (Date Picker)<br>- ç”Ÿè‚– (Select: é¼ /ç‰›/è™/å…”/é¾/è›‡/é¦¬/ç¾Š/çŒ´/é›/ç‹—/è±¬) |
| `waiting_category_and_date` | ç­‰å¾…åˆ†é¡èˆ‡æ—¥æœŸé¸æ“‡ | **æ–¹å¼ä¸€ï¼ˆæ¨è–¦ï¼‰**ï¼š<br>- **åˆ†é¡é¸æ“‡å™¨**ï¼š5 å€‹æŒ‰éˆ•æˆ–ä¸‹æ‹‰é¸å–®<br>  - ç”Ÿæ´»æ—¥å¸¸ (`daily_life`)<br>  - å®¶åº­å±…æ‰€ (`family_home`)<br>  - æ„Ÿæƒ…äººéš› (`relationship`)<br>  - å–œæ…¶å¤§äº‹ (`celebration`)<br>  - å·¥ä½œäº‹æ¥­ (`work_career`)<br>- **æ—¥æœŸé¸æ“‡å™¨**ï¼šæ—¥æ›†å…ƒä»¶ (Calendar Picker)<br><br>**æ–¹å¼äºŒï¼ˆå½ˆæ€§ï¼‰**ï¼š<br>- æ–‡å­—è¼¸å…¥æ¡†ï¼šå…è¨±è¼¸å…¥ã€Œå®¶åº­å±…æ‰€ï¼Œ2025-12-15ã€ |
| `waiting_specific_question` | ç­‰å¾…å…·é«”äº‹é …æè¿° | **æ–‡å­—è¼¸å…¥æ¡†**ï¼š<br>- æç¤ºèªï¼šã€Œè«‹æè¿°æ‚¨å…·é«”æƒ³åšçš„äº‹æƒ…...ã€<br>- ç¯„ä¾‹ï¼šã€Œæˆ‘è¦æ¬æ–°å®¶ã€ã€ã€Œç°½ç´„è²·æˆ¿ã€<br>- ç™¼é€æŒ‰éˆ• |
| `providing_dates` | æä¾›å‰æ—¥å»ºè­° | **çµæœé¡¯ç¤º**ï¼š<br>- é¡¯ç¤ºæ‰€é¸æ—¥æœŸçš„é»ƒæ›†è³‡è¨Š<br>- é¡¯ç¤ºã€Œå®œã€ã€Œå¿Œã€äº‹é …<br>- AI å»ºè­°èˆ‡æ³¨æ„äº‹é …<br>- æ˜¯å¦æ²–ç”Ÿè‚–æé†’ |
| `asking_for_question` | è©¢å•æ˜¯å¦æœ‰å…¶ä»–å•é¡Œ<br>(åƒ…ä»˜è²»ç‰ˆ) | **å°è©±ä»‹é¢**ï¼š<br>- é¡¯ç¤ºç¥æ˜çš„é»ƒæ›†è§£è®€çµæœ<br>- æ–‡å­—è¼¸å…¥æ¡†ï¼ˆè¼¸å…¥è¿½å•ï¼Œå¦‚ã€Œæœ‰ä»€éº¼éœ€è¦æ³¨æ„çš„ï¼Ÿã€ï¼‰<br>- ã€Œæ²’æœ‰å•é¡Œ/è¬è¬ã€æŒ‰éˆ•ï¼ˆçµæŸå°è©±ï¼‰<br>- **æç¤º**ï¼šAI æœƒä»¥ç¥æ˜å£å»ç¹¼çºŒå›ç­” |
| `completed` | å·²å®Œæˆ | **çµæŸç•«é¢**ï¼š<br>- **å…è²»ç‰ˆ**ï¼šé¡¯ç¤ºå®Œæ•´å‰æ—¥åˆ†æ<br>- **ä»˜è²»ç‰ˆ**ï¼šé¡¯ç¤ºå®Œæ•´åˆ†æ + ç¥æ˜çµæŸèª<br>- ã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ• |

---

## âš ï¸ éŒ¯èª¤è™•ç†

### ç¼ºå°‘ session_id
```jsonc
{
  "error": "ç¼ºå°‘ session_id",
  "message": "è«‹å…ˆèª¿ç”¨ init_with_tone åˆå§‹åŒ–æœƒè©±"
}
```
**HTTP Status**: 400

### æœƒè©±ä¸å­˜åœ¨æˆ–å·²éæœŸ
```jsonc
{
  "error": "æœƒè©±ä¸å­˜åœ¨æˆ–å·²éæœŸ",
  "message": "è«‹é‡æ–°èª¿ç”¨ init_with_tone åˆå§‹åŒ–æœƒè©±",
  "session_id": "åŸsession_id"
}
```
**HTTP Status**: 404

### Redis é€£ç·šéŒ¯èª¤
```jsonc
{
  "error": "Session å­˜å„²æœå‹™æš«æ™‚ä¸å¯ç”¨",
  "message": "è«‹ç¨å¾Œå†è©¦"
}
```
**HTTP Status**: 503

### OpenAI API éŒ¯èª¤
```jsonc
{
  "error": "AI æœå‹™æš«æ™‚ä¸å¯ç”¨",
  "message": "è«‹ç¨å¾Œå†è©¦"
}
```
**HTTP Status**: 503

### è«‹æ±‚è¶…æ™‚
Cloud Run é è¨­è¶…æ™‚ç‚º 120 ç§’ï¼Œè¶…éæ­¤æ™‚é–“å°‡è¿”å›ï¼š
```jsonc
{
  "error": "Request timeout",
  "message": "è«‹æ±‚è™•ç†æ™‚é–“éé•·ï¼Œè«‹é‡è©¦"
}
```
**HTTP Status**: 504

### æœå‹™å†·å•Ÿå‹•
ç•¶æœå‹™å¯¦ä¾‹å¾ 0 æ“´å±•æ™‚ï¼Œé¦–æ¬¡è«‹æ±‚å¯èƒ½éœ€è¦è¼ƒé•·æ™‚é–“ï¼ˆ5-10ç§’ï¼‰ã€‚å¾ŒçºŒè«‹æ±‚å°‡å¿«é€ŸéŸ¿æ‡‰ã€‚

---

## ğŸ§ª æ¸¬è©¦æŒ‡ä»¤

### æœ¬åœ°é–‹ç™¼æ¸¬è©¦
```bash
# å•Ÿå‹•æœ¬åœ°æœå‹™
python app.py

# é‹è¡Œå®Œæ•´æ¸¬è©¦ï¼ˆéœ€è¦æœå‹™é‹è¡Œä¸­ï¼‰
python test_complete_all.py
```

### ç”Ÿç”¢ç’°å¢ƒæ¸¬è©¦
éƒ¨ç½²å¾Œï¼Œå¯ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒ APIï¼š

```bash
# è¨­å®šæœå‹™ URL
export API_URL="https://your-service-url.a.run.app"

# æ¸¬è©¦å¥åº·æª¢æŸ¥
curl $API_URL/health

# æ¸¬è©¦å…è²»ç‰ˆåˆå§‹åŒ–
curl -X POST $API_URL/life/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'

# æ¸¬è©¦ä»˜è²»ç‰ˆåˆå§‹åŒ–
curl -X POST $API_URL/life/paid/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "guan_yu"}'
```

### æ¸¬è©¦é…ç½®
- `TRUNCATE_RESPONSE = False`ï¼šé¡¯ç¤ºå®Œæ•´APIå›æ‡‰
- `TRUNCATE_RESPONSE = True`ï¼šæˆªæ–·é•·å›æ‡‰è‡³300å­—å…ƒ

### è² è¼‰æ¸¬è©¦
ä½¿ç”¨ Apache Bench é€²è¡Œè² è¼‰æ¸¬è©¦ï¼š
```bash
# æ¸¬è©¦ 100 å€‹è«‹æ±‚ï¼Œ10 å€‹ä¸¦ç™¼
ab -n 100 -c 10 -H "Content-Type: application/json" \
  -p health_check.json \
  https://your-service-url.a.run.app/health
```

---

## ğŸš€ éƒ¨ç½²è³‡è¨Š

### GCP Cloud Run éƒ¨ç½²

#### éƒ¨ç½²å€åŸŸ
- **é è¨­å€åŸŸ**: `asia-east1` (å°ç£)
- **å¯é¸å€åŸŸ**: `asia-northeast1` (æ±äº¬)ã€`us-west1` (å¥§å‹’å²¡)

#### è³‡æºé…ç½®
- **Memory**: 512Mi
- **CPU**: 1 vCPU
- **ä¸¦ç™¼æ•¸**: 80 å€‹è«‹æ±‚
- **è¶…æ™‚æ™‚é–“**: 120 ç§’
- **æœ€å°å¯¦ä¾‹**: 0ï¼ˆæŒ‰éœ€å•Ÿå‹•ï¼‰
- **æœ€å¤§å¯¦ä¾‹**: 10

#### ç’°å¢ƒè®Šé‡ï¼ˆé€é Secret Manager ç®¡ç†ï¼‰
éƒ¨ç½²æ™‚ï¼Œä»¥ä¸‹ç’°å¢ƒè®Šé‡æœƒå¾ GCP Secret Manager è‡ªå‹•æ³¨å…¥ï¼š

| è®Šé‡åç¨± | èªªæ˜ | ç¯„ä¾‹å€¼ |
|---------|------|--------|
| `OPENAI_API_KEY` | OpenAI API é‡‘é‘° | `sk-proj-...` |
| `OPENAI_MODEL` | GPT æ¨¡å‹ç‰ˆæœ¬ | `gpt-4o` |
| `PROJECT_LOCALE` | å°ˆæ¡ˆèªè¨€ | `zh-TW` |
| `REDIS_HOST` | Redis ä¸»æ©Ÿåœ°å€ | `redis-xxxxx.cloud.redislabs.com` |
| `REDIS_PORT` | Redis ç«¯å£ | `11330` |
| `REDIS_PASSWORD` | Redis å¯†ç¢¼ | `******` |
| `REDIS_USERNAME` | Redis ç”¨æˆ¶å | `default` |
| `SESSION_TTL` | Session éæœŸæ™‚é–“ï¼ˆç§’ï¼‰ | `43200`ï¼ˆ12å°æ™‚ï¼‰ |

#### éƒ¨ç½²æŒ‡ä»¤
```bash
# åŸ·è¡Œéƒ¨ç½²è…³æœ¬
cd /path/to/Life\ Number\ Backend
./deploy.sh

# æˆ–ä½¿ç”¨ gcloud æ‰‹å‹•éƒ¨ç½²
gcloud builds submit --config cloudbuild.yaml
```

#### å–å¾—æœå‹™ URL
éƒ¨ç½²å®Œæˆå¾Œï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤å–å¾—æœå‹™ URLï¼š
```bash
gcloud run services describe life-number-backend \
  --region=asia-east1 \
  --format='value(status.url)'
```

#### å¥åº·æª¢æŸ¥ç«¯é»
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
curl https://your-service-url.a.run.app/health

# é æœŸå›æ‡‰
{
  "status": "healthy",
  "timestamp": "2025-11-24T12:00:00.000Z"
}
```

### CORS é…ç½®
API å·²å•Ÿç”¨ CORSï¼Œå…è¨±è·¨åŸŸè«‹æ±‚ï¼š
- âœ… æ‰€æœ‰ä¾†æº (`*`)
- âœ… æ”¯æ´ POSTã€GETã€OPTIONS æ–¹æ³•
- âœ… æ”¯æ´ Content-Typeã€Authorization æ¨™é ­

### å®‰å…¨æ€§
- ğŸ” æ•æ„Ÿè³‡æ–™ï¼ˆAPI é‡‘é‘°ã€å¯†ç¢¼ï¼‰å­˜æ”¾æ–¼ GCP Secret Manager
- ğŸ” ç”Ÿç”¢æ¨¡å¼é‹è¡Œï¼ˆ`debug=False`ï¼‰
- ğŸ” HTTPS åŠ å¯†å‚³è¼¸ï¼ˆè‡ªå‹•ç”± Cloud Run æä¾›ï¼‰
- ğŸ” Session è³‡æ–™åŠ å¯†å­˜å„²æ–¼ Redisï¼ˆ12 å°æ™‚ TTLï¼‰

### å‰ç«¯æ•´åˆç¯„ä¾‹

#### JavaScript/Fetch API
```javascript
// è¨­å®š API åŸºç¤ URL
const API_BASE_URL = 'https://your-service-url.a.run.app';

// å…è²»ç‰ˆåˆå§‹åŒ–
async function initFreeSession(tone) {
  const response = await fetch(`${API_BASE_URL}/life/free/api/init_with_tone`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ tone })
  });
  const data = await response.json();
  // ä¿å­˜ session_id
  localStorage.setItem('session_id', data.session_id);
  return data;
}

// ç™¼é€å°è©±è¨Šæ¯
async function sendMessage(message, version = 'free') {
  const sessionId = localStorage.getItem('session_id');
  const response = await fetch(`${API_BASE_URL}/life/${version}/api/chat`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ session_id: sessionId, message })
  });
  return await response.json();
}
```

#### Python/Requests
```python
import requests

API_BASE_URL = 'https://your-service-url.a.run.app'

# ä»˜è²»ç‰ˆåˆå§‹åŒ–
def init_paid_session(tone):
    response = requests.post(
        f'{API_BASE_URL}/life/paid/api/init_with_tone',
        json={'tone': tone}
    )
    data = response.json()
    session_id = data['session_id']  # ä¿å­˜æ­¤ ID
    return data

# ç™¼é€å°è©±è¨Šæ¯
def send_message(session_id, message):
    response = requests.post(
        f'{API_BASE_URL}/life/paid/api/chat',
        json={'session_id': session_id, 'message': message}
    )
    return response.json()
```

### ç›£æ§èˆ‡æ—¥èªŒ

#### æŸ¥çœ‹å³æ™‚æ—¥èªŒ
```bash
# æŸ¥çœ‹æœ€æ–°æ—¥èªŒ
gcloud run services logs read life-number-backend \
  --region=asia-east1 \
  --limit=50

# å³æ™‚è¿½è¹¤æ—¥èªŒ
gcloud run services logs tail life-number-backend \
  --region=asia-east1
```

#### ç›£æ§æŒ‡æ¨™
åœ¨ GCP Console å¯æŸ¥çœ‹ï¼š
- è«‹æ±‚æ•¸é‡èˆ‡å»¶é²
- éŒ¯èª¤ç‡
- å¯¦ä¾‹æ•¸é‡
- CPU èˆ‡è¨˜æ†¶é«”ä½¿ç”¨ç‡


---

## ğŸ”® å¤©ä½¿æ•¸å­— API (Angel Number)

### åŠŸèƒ½èªªæ˜

å¤©ä½¿æ•¸å­— API æä¾›å¤©ä½¿æ•¸å­—è§£è®€æœå‹™ã€‚ç•¶ä½¿ç”¨è€…åè¦†çœ‹åˆ°ç›¸åŒçš„æ•¸å­—(å¦‚ 1111ã€2222 ç­‰),ç³»çµ±æœƒé€é AI è§£è®€å…¶èƒŒå¾Œçš„éˆæ€§æ„ç¾©ã€‚

**ç‰¹è‰²ï¼š**
- æ”¯æ´ 9 ç¨®å¤©ä½¿æ•¸å­—(1111-9999)
- 3 ç¨®èªæ°£é¸é …(friendly, caring, ritual)
- ç°¡åŒ–çš„å°è©±æµç¨‹
- ä½¿ç”¨ AI è‡ªå‹•æå–åŸºæœ¬è³‡è¨Š
- å®Œæ•´çš„éˆæ€§è§£è®€èˆ‡æŒ‡å¼•

---

### å¤©ä½¿æ•¸å­—ç«¯é»

#### **POST** `/angel/free/api/init_with_tone`

åˆå§‹åŒ–å¤©ä½¿æ•¸å­—å°è©±ä¸¦é¸æ“‡èªæ°£ã€‚

**Request Body:**
```jsonc
{
  "tone": "string"  // èªæ°£é¸æ“‡: friendly, caring, ritual
}
```

**Response:**
```jsonc
{
  "session_id": "uuid-string",  // æœƒè©±ID,å‰ç«¯å¿…é ˆä¿å­˜
  "response": "å•å€™èªå…§å®¹",
  "state": "waiting_basic_info",
  "requires_input": true
}
```

**ç¯„ä¾‹:**
```bash
curl -X POST http://localhost:8080/angel/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'
```

---

#### **POST** `/angel/free/api/chat`

å¤©ä½¿æ•¸å­—å°è©±äº’å‹•ã€‚

**Request Body:**
```jsonc
{
  "session_id": "string",  // å¿…é ˆï¼šç”± init_with_tone è¿”å›çš„æœƒè©±ID
  "message": "string"      // å¿…é ˆï¼šç”¨æˆ¶è¼¸å…¥å…§å®¹
}
```

**Response:**
```jsonc
{
  "session_id": "string",
  "response": "AIå›æ‡‰å…§å®¹",
  "state": "ç•¶å‰ç‹€æ…‹",
  "angel_number": "1111",  // å¦‚æœ‰
  "show_angel_number_selector": true,  // å¦‚éœ€é¡¯ç¤ºé¸å–®
  "requires_input": true/false
}
```

**å¯èƒ½çš„ç‹€æ…‹å€¼:**
- `waiting_basic_info` - ç­‰å¾…åŸºæœ¬è³‡è¨Š(å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥)
- `waiting_angel_number` - ç­‰å¾…å¤©ä½¿æ•¸å­—é¸æ“‡
- `completed` - å·²å®Œæˆ

---

#### **POST** `/angel/free/api/reset`

é‡ç½®å¤©ä½¿æ•¸å­—æœƒè©±ã€‚

**Request Body:**
```jsonc
{
  "session_id": "string"  // å¯é¸ï¼šè¦åˆªé™¤çš„æœƒè©±ID
}
```

**Response:**
```jsonc
{
  "success": true
}
```

---

### å¤©ä½¿æ•¸å­—å°è©±æµç¨‹

```
æ­¥é©Ÿ 1: åˆå§‹åŒ–ï¼ˆinit_with_toneï¼‰
    â†“
æ­¥é©Ÿ 2: æäº¤åŸºæœ¬è³‡è¨Šï¼ˆå§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥ï¼‰
    â†“ (AI è‡ªå‹•è§£æ)
æ­¥é©Ÿ 3: é¸æ“‡å¤©ä½¿æ•¸å­—ï¼ˆ1111-9999ï¼‰
    â†“
æ­¥é©Ÿ 4: ç²å¾—å®Œæ•´è§£è®€
    â†“
æ­¥é©Ÿ 5: å®Œæˆï¼ˆå¯é‡æ–°é–‹å§‹ï¼‰
```

---

### å®Œæ•´å°è©±ç¯„ä¾‹

#### æ­¥é©Ÿ 1ï¼šåˆå§‹åŒ–
```bash
curl -X POST http://localhost:8080/angel/free/api/init_with_tone \
  -H "Content-Type: application/json" \
  -d '{"tone": "friendly"}'
```

**Response:**
```json
{
  "session_id": "abc-123",
  "response": "å—¨ï½æ­¡è¿ä¾†åˆ° å¤©ä½¿æ•¸å­— AI å°è©±ç©ºé–“ ğŸ’«\n\nä½ æ˜¯ä¸æ˜¯æœ€è¿‘ä¹Ÿå¸¸å¸¸çœ‹åˆ°æŸå€‹æ•¸å­—ä¸€ç›´å‡ºç¾å‘¢ï¼Ÿ...",
  "state": "waiting_basic_info",
  "requires_input": true
}
```

#### æ­¥é©Ÿ 2ï¼šæäº¤åŸºæœ¬è³‡è¨Š
```bash
curl -X POST http://localhost:8080/angel/free/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "abc-123",
    "message": "ç‹å°æ˜ ç”· 1990/07/12"
  }'
```

**Response:**
```json
{
  "session_id": "abc-123",
  "response": "ç‹å°æ˜,ä½ å¥½å‘€ï½æˆ‘é€™é‚Šå·²ç¶“æ”¶åˆ°ä½ çš„è³‡æ–™å›‰ âœ¨\n\næ¥ä¸‹ä¾†æƒ³è«‹ä½ å‘Šè¨´æˆ‘...",
  "state": "waiting_angel_number",
  "show_angel_number_selector": true,
  "requires_input": false
}
```

#### æ­¥é©Ÿ 3ï¼šé¸æ“‡å¤©ä½¿æ•¸å­—
```bash
curl -X POST http://localhost:8080/angel/free/api/chat \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "abc-123",
    "message": "1111"
  }'
```

**Response:**
```json
{
  "session_id": "abc-123",
  "response": "ç‹å°æ˜,æˆ‘çœ‹åˆ°äº†ä½ çš„å¤©ä½¿æ•¸å­— 1111ï¼âœ¨\n\nï¼ˆå®Œæ•´çš„å¤©ä½¿æ•¸å­—è§£è®€å…§å®¹...ï¼‰",
  "state": "completed",
  "angel_number": "1111",
  "requires_input": false
}
```

---

### æ”¯æ´çš„å¤©ä½¿æ•¸å­—

| æ•¸å­— | æ¨™é¡Œ | æ ¸å¿ƒæ„ç¾© |
|------|------|----------|
| 1111 | æ–°é–‹å§‹èˆ‡ç²¾ç¥è¦ºé†’ | æ–°é–‹å§‹ã€æ€ç¶­å…·åŒ–ã€é ˜å°åŠ›çˆ†ç™¼ |
| 2222 | å’Œè«§èˆ‡å¹³è¡¡ | å’Œè«§å¹³è¡¡ã€æŒçºŒé€²å±•ã€äººéš›é€£çµ |
| 3333 | æˆé•·èˆ‡å‰µæ„ | æˆé•·æ“´å±•ã€å‰µæ„è¡¨é”ã€éˆæ€§å¼•å° |
| 4444 | ç©©å®šèˆ‡å®ˆè­· | ç©©å®šåŸºç¤ã€æ„Ÿæ©ã€ç¥è–å®ˆè­· |
| 5555 | é‡å¤§è½‰è®Š | é‡å¤§è½‰è®Šã€ç©æ¥µè®Šé©ã€éˆæ€§è¦ºé†’ |
| 6666 | æ„›èˆ‡å’Œè«§ | æ„›èˆ‡å®¶åº­ã€æ”¯æŒã€å¹³è¡¡ç‰©è³ªèˆ‡éˆæ€§ |
| 7777 | éˆæ€§è¦ºé†’ | éˆæ€§è¦ºé†’ã€æ™ºæ…§ã€ç™‚ç™’èˆ‡çªç ´ |
| 8888 | è±ç››èˆ‡è²¡å¯Œ | è±ç››è²¡å¯Œã€ç„¡é™èƒ½é‡ã€è‡ªæˆ‘æˆé•· |
| 9999 | å®Œæˆèˆ‡æ–°æ—…ç¨‹ | å®Œæˆã€æ–°æ—…ç¨‹ã€å¿ƒéˆè½‰åŒ– |

---

### èªæ°£é¸é …èªªæ˜

**friendly (è¦ªåˆ‡ç‰ˆ):**
- è¼•é¬†å‹å–„,åƒæœ‹å‹èŠå¤©
- ä½¿ç”¨ã€Œä½ ã€ç¨±å‘¼
- èªèª¿æ´»æ½‘è‡ªç„¶

**caring (è²¼å¿ƒç‰ˆ):**
- æº«æš–é—œæ‡·,åƒéˆæ€§å°å¸«
- ä½¿ç”¨ã€Œä½ ã€æˆ–ã€Œæ‚¨ã€ç¨±å‘¼
- å……æ»¿åŒç†å¿ƒèˆ‡æº«æŸ”

**ritual (å„€å¼ç‰ˆ):**
- èŠé‡ç¥è–,å……æ»¿å„€å¼æ„Ÿ
- ä½¿ç”¨ã€Œæ‚¨ã€ç¨±å‘¼
- å¸¶æœ‰ç¥æ€§èˆ‡éˆæ€§æ°›åœ

---

## ğŸ“Œ ç‰ˆæœ¬è³‡è¨Š
- **API Version**: 1.0.0
- **Last Updated**: 2025-12-09
- **éƒ¨ç½²å¹³å°**: GCP Cloud Run
- **æ–‡æª”ç¶­è­·**: æ¯æ¬¡ API è®Šæ›´æ™‚åŒæ­¥æ›´æ–°

