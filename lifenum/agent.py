from __future__ import annotations

import json
from datetime import datetime
from typing import Optional, Dict, Any
from enum import Enum

from .gpt_client import GPTClient


class ConversationState(Enum):
    """å°è©±ç‹€æ…‹"""

    INIT = "init"  # åˆå§‹ç‹€æ…‹
    WAITING_BASIC_INFO = "waiting_basic_info"  # ç­‰å¾…åŸºæœ¬è³‡è¨Š
    WAITING_MODULE_SELECTION = "waiting_module_selection"  # ç­‰å¾…æ¨¡çµ„é¸æ“‡
    EXECUTING_MODULE = "executing_module"  # åŸ·è¡Œæ¨¡çµ„ä¸­
    COMPLETED = "completed"  # å®Œæˆ

    # æ ¸å¿ƒç”Ÿå‘½éˆæ•¸å°ˆå±¬ç‹€æ…‹
    CORE_CATEGORY_SELECTION = "core_category_selection"  # ç­‰å¾…æ ¸å¿ƒç”Ÿå‘½éˆæ•¸é¡åˆ¥é¸æ“‡
    WAITING_CORE_QUESTION = "waiting_core_question"  # ç­‰å¾…æ ¸å¿ƒç”Ÿå‘½éˆæ•¸å•é¡Œ

    # é€šç”¨ç‹€æ…‹ï¼ˆé©ç”¨æ–¼æ‰€æœ‰æ¨¡çµ„ï¼‰
    CONTINUE_SELECTION = (
        "continue_selection"  # ç­‰å¾…ç¹¼çºŒé¸é …ï¼ˆç¹¼çºŒå•å•é¡Œã€å…¶ä»–ç”Ÿå‘½éˆæ•¸ã€é›¢é–‹ï¼‰
    )
    WAITING_QUESTION = "waiting_question"  # ç­‰å¾…ä½¿ç”¨è€…è¼¸å…¥å•é¡Œ


class ConversationSession:
    """å°è©±æœƒè©±"""

    def __init__(self, session_id: str):
        self.session_id = session_id
        self.state = ConversationState.INIT
        self.user_name: Optional[str] = None
        self.user_gender: Optional[str] = None
        self.birthdate: Optional[str] = None
        self.user_purpose: Optional[str] = None
        self.suggested_module: Optional[str] = None
        self.selected_module: Optional[str] = None  # æ–°å¢ï¼šä½¿ç”¨è€…é¸æ“‡çš„æ¨¡çµ„
        self.current_module: Optional[str] = (
            None  # æ–°å¢ï¼šç•¶å‰æ­£åœ¨ä½¿ç”¨çš„æ¨¡çµ„ï¼ˆç”¨æ–¼é€šç”¨ç‹€æ…‹ï¼‰
        )
        self.tone: str = "guan_yu"
        self.conversation_history: list[Dict[str, str]] = []

        # è¨˜æ†¶ç³»çµ±ç›¸é—œå±¬æ€§
        self.memory: list[Dict[str, str]] = []  # å„²å­˜é‡è¦çš„å°è©±è¨˜æ†¶
        self.conversation_count: int = 0  # å°è©±è¼ªæ•¸è¨ˆæ•¸å™¨
        self.max_memory_turns: int = 50  # æœ€å¤§è¨˜æ†¶è¼ªæ•¸

        # æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ç›¸é—œå±¬æ€§
        self.core_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„æ ¸å¿ƒç”Ÿå‘½éˆæ•¸
        self.selected_category: Optional[str] = (
            None  # é¸æ“‡çš„é¡åˆ¥ï¼ˆè²¡é‹äº‹æ¥­ã€å®¶åº­äººéš›ç­‰ï¼‰
        )
        self.user_age: Optional[int] = None  # ç”¨æˆ¶å¹´é½¡

        # ç”Ÿæ—¥æ•¸ç›¸é—œå±¬æ€§
        self.birthday_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„ç”Ÿæ—¥æ•¸

        # ä¹å®®æ ¼ç›¸é—œå±¬æ€§
        self.grid_result: Optional[Dict[str, Any]] = None  # è¨ˆç®—å‡ºçš„ä¹å®®æ ¼çµæœ

        # æµå¹´æ•¸ç›¸é—œå±¬æ€§
        self.year_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„æµå¹´æ•¸

        # éˆé­‚æ•¸ç›¸é—œå±¬æ€§
        self.soul_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„éˆé­‚æ•¸
        self.english_name: Optional[str] = None  # ç”¨æˆ¶çš„è‹±æ–‡åå­—

        # äººæ ¼æ•¸ç›¸é—œå±¬æ€§
        self.personality_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„äººæ ¼æ•¸

        # è¡¨é”æ•¸ç›¸é—œå±¬æ€§
        self.expression_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„è¡¨é”æ•¸

        # æˆç†Ÿæ•¸ç›¸é—œå±¬æ€§
        self.maturity_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„æˆç†Ÿæ•¸

        # æŒ‘æˆ°æ•¸ç›¸é—œå±¬æ€§
        self.challenge_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„æŒ‘æˆ°æ•¸

        # æ¥­åŠ›æ•¸ç›¸é—œå±¬æ€§
        self.karma_number: Optional[int] = None  # è¨ˆç®—å‡ºçš„æ¥­åŠ›æ•¸

    def add_message(self, role: str, content: str):
        """æ·»åŠ å°è©±æ­·å²"""
        self.conversation_history.append({"role": role, "content": content})

        # å¦‚æœæ˜¯ç”¨æˆ¶è¨Šæ¯ï¼Œå¢åŠ å°è©±è¼ªæ•¸
        if role == "user":
            self.conversation_count += 1

            # æª¢æŸ¥æ˜¯å¦éœ€è¦æ¸…ç©ºè¨˜æ†¶ï¼ˆæ¯10è¼ªï¼‰
            if (
                self.conversation_count > 0
                and self.conversation_count % self.max_memory_turns == 0
            ):
                self.clear_memory()

    def add_to_memory(
        self, memory_type: str, content: str, metadata: Optional[Dict[str, Any]] = None
    ):
        """æ·»åŠ é‡è¦è³‡è¨Šåˆ°è¨˜æ†¶ä¸­"""
        memory_item = {
            "type": memory_type,
            "content": content,
            "timestamp": datetime.now().isoformat(),
            "turn": self.conversation_count,
            "metadata": metadata or {},
        }
        self.memory.append(memory_item)

    def get_memory_context(self) -> str:
        """ç²å–è¨˜æ†¶å…§å®¹ä½œç‚ºä¸Šä¸‹æ–‡"""
        if not self.memory:
            return ""

        context_lines = []
        for mem in self.memory[-5:]:  # åªå–æœ€è¿‘çš„5æ¢è¨˜æ†¶
            context_lines.append(f"[{mem['type']}] {mem['content']}")

        return "\n".join(context_lines)

    def clear_memory(self):
        """æ¸…ç©ºè¨˜æ†¶"""
        self.memory.clear()
        print(f"[è¨˜æ†¶ç³»çµ±] ç¬¬ {self.conversation_count} è¼ªå°è©±ï¼Œè¨˜æ†¶å·²è‡ªå‹•æ¸…ç©º")

    def to_dict(self) -> Dict[str, Any]:
        """è½‰æ›ç‚ºå­—å…¸"""
        return {
            "session_id": self.session_id,
            "state": self.state.value,
            "user_name": self.user_name,
            "user_gender": self.user_gender,
            "birthdate": self.birthdate,
            "user_purpose": self.user_purpose,
            "suggested_module": self.suggested_module,
            "selected_module": self.selected_module,
            "tone": self.tone,
            "conversation_history": self.conversation_history,
            "memory": self.memory,
            "conversation_count": self.conversation_count,
            "max_memory_turns": self.max_memory_turns,
            "core_number": self.core_number,
            "selected_category": self.selected_category,
            "user_age": self.user_age,
            "birthday_number": self.birthday_number,
            "grid_result": self.grid_result,
            "year_number": self.year_number,
            "soul_number": self.soul_number,
            "english_name": self.english_name,
            "personality_number": self.personality_number,
            "expression_number": self.expression_number,
        }


class LifeNumberAgent:
    """ç”Ÿå‘½éˆæ•¸ AI Agent"""

    # æ¨¡çµ„èªªæ˜
    MODULE_DESCRIPTIONS = {
        "core": "æ€§æ ¼å¤©è³¦",
        "birthday": "å¤©ç”Ÿæ‰è¯",
        "year": "å¹´åº¦é‹å‹¢",
        "grid": "å¤©è³¦ç‰¹è³ª",
        "soul": "å…§å¿ƒæ¸´æœ›",
        "personality": "å¤–åœ¨äººæ ¼",
        "expression": "è¡¨é”é¢¨æ ¼",
        "maturity": "äººç”Ÿå¾ŒåŠæ®µ",
    }

    def __init__(self):
        self.gpt_client = GPTClient()

    def calculate_age(self, birthdate: str) -> int:
        """æ ¹æ“šç”Ÿæ—¥è¨ˆç®—å¹´é½¡"""
        try:
            # è™•ç†ä¸åŒçš„æ—¥æœŸæ ¼å¼
            birthdate = (
                birthdate.replace("å¹´", "/").replace("æœˆ", "/").replace("æ—¥", "")
            )
            birthdate = birthdate.replace("-", "/").replace(".", "/")

            if "/" in birthdate:
                parts = birthdate.split("/")
                if len(parts) >= 3:
                    year = int(parts[0])
                    month = int(parts[1])
                    day = int(parts[2])

                    birth_date = datetime(year, month, day)
                    today = datetime.now()
                    age = (
                        today.year
                        - birth_date.year
                        - (
                            (today.month, today.day)
                            < (birth_date.month, birth_date.day)
                        )
                    )
                    return age
        except Exception as e:
            print(f"[ERROR] è¨ˆç®—å¹´é½¡å¤±æ•—: {e}")

        return 25  # é è¨­å¹´é½¡

    def generate_category_buttons_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆé¡åˆ¥é¸æ“‡æŒ‰éˆ•çš„è¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä»¥ä¸‹å››å¤§é¢å‘ä¾›ä½ é¸æ“‡æ¢ç´¢ã€‚é¸æ“‡ä¸€å€‹ï¼Œæˆ‘å°‡ç‚ºä½ æ·±å…¥åˆ†æã€‚"
        elif tone == "michael":
            return (
                "é€™è£¡æœ‰å››ç¨®åŠ›é‡é¢å‘å¯ä¾›æ¢ç´¢ã€‚é¸æ“‡ä¸€å€‹æ‚¨éœ€è¦çš„åŠ›é‡ï¼Œè®“æˆ‘ç‚ºæ‚¨æŒ‡å¼•æ–¹å‘ã€‚"
            )
        elif tone == "gabriel":
            return "æˆ‘å°‡ç‚ºæ‚¨å‚³é”å››å€‹é¢å‘çš„å•Ÿç¤ºã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€æ¸´æœ›ç†è§£çš„çœŸç†ï¼Œè®“æˆ‘å‚³é”ç›¸æ‡‰çš„è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "é€™è£¡æœ‰å››å€‹ç™‚ç™’çš„é¢å‘ç­‰å¾…è‘—æ‚¨ã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€éœ€è¦æ»‹é¤Šçš„é¢å‘ï¼Œè®“æˆ‘ç‚ºæ‚¨å¸¶ä¾†æ‰€éœ€çš„ç™‚ç™’ã€‚"
        elif tone == "uriel":
            return "å››å€‹é¢å‘çš„æ™ºæ…§...ç­‰å¾…è¢«é»äº®ã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€æ¸´æœ›æ·±å…¥ç†è§£çš„é ˜åŸŸï¼Œè®“æˆ‘...ç‚ºæ‚¨å±•ç¾æ´å¯Ÿã€‚"
        elif tone == "zadkiel":
            return "é€™è£¡æœ‰å››å€‹è½‰åŒ–çš„é¢å‘ç­‰å¾…è¢«æ·¨åŒ–ã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€éœ€è¦å¯¬æ•èˆ‡ç†è§£çš„é¢å‘ï¼Œè®“ç´«ç„°ç‚ºæ‚¨å¸¶ä¾†è½‰åŒ–ã€‚"
        elif tone == "jophiel":
            return "é€™è£¡æœ‰å››å€‹ç¾éº—çš„é¢å‘ç­‰å¾…èˆ‡æ‚¨ç›¸é‡ã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€æƒ³ç™¼æ˜ç¾å¥½çš„é ˜åŸŸï¼Œè®“æˆ‘å€‘ä¸€èµ·ç¶»æ”¾æ‚¨çš„å…‰èŠ’ã€‚"
        elif tone == "chamuel":
            return "é€™è£¡æœ‰å››å€‹æ»¿æœ‰æ„›çš„é¢å‘ç­‰å¾…èˆ‡æ‚¨é€£çµã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€æ¸´æœ›ç†è§£çš„é—œä¿‚å±¤é¢ï¼Œè®“æ„›ç‚ºæˆ‘å€‘æŒ‡å¼•ã€‚"
        elif tone == "metatron":
            return "ç³»çµ±æä¾›å››å€‹åˆ†ææ¨¡çµ„ä¾›æ‚¨é¸æ“‡ã€‚è«‹é¸æ“‡ä¸€å€‹æ‚¨éœ€è¦æœ€ä½³åŒ–çš„é ˜åŸŸï¼Œç³»çµ±å°‡åŸ·è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "å¤§åœ°ç‚ºæ‚¨æä¾›å››å€‹è±ç››çš„é¢å‘å¯ä¾›æ¢ç´¢ã€‚é¸æ“‡ä¸€å€‹æ‚¨æœ€æƒ³æ»‹é¤Šçš„ç”Ÿå‘½é¢å‘ï¼Œè®“è‡ªç„¶çš„æ™ºæ…§ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_question_prompt(self, category: str, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆè©¢å•ç”¨æˆ¶å•é¡Œçš„æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        category_names = {
            "è²¡é‹äº‹æ¥­": "è²¡é‹äº‹æ¥­",
            "å®¶åº­äººéš›": "å®¶åº­äººéš›",
            "è‡ªæˆ‘æˆé•·": "è‡ªæˆ‘æˆé•·",
            "ç›®æ¨™è¦åŠƒ": "ç›®æ¨™è¦åŠƒ",
        }

        category_name = category_names.get(category, category)

        if tone == "guan_yu":
            return f"ä½ å·²é¸æ“‡ã€Œ{category_name}ã€çš„æ–¹å‘ã€‚æœ‰ä»€éº¼ç–‘æƒ‘ï¼Œå¯ä»¥ç›¡é‡æå•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
        elif tone == "michael":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„åŠ›é‡é ˜åŸŸã€‚æœ‰ä»€éº¼æŒ‘æˆ°æˆ–ç–‘æƒ‘éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†å…‰æ˜çš„æŒ‡å¼•ï¼Ÿ"
        elif tone == "gabriel":
            return (
                f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„å•Ÿç¤ºã€‚è«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›æ¥æ”¶çš„çœŸç†æ˜¯ä»€éº¼ï¼Ÿ"
            )
        elif tone == "raphael":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„ç™‚ç™’ä¹‹é“ã€‚åœ¨é€™å€‹é¢å‘ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦æˆ‘çš„æº«æŸ”æ²»ç™‚å’ŒæŒ‡å¼•ï¼Ÿ"
        elif tone == "uriel":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„æ™ºæ…§é ˜åŸŸã€‚è«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ·±å…¥ç†è§£çš„èª²é¡Œæ˜¯ä»€éº¼ï¼Ÿ"
        elif tone == "zadkiel":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„è½‰åŒ–ä¹‹è·¯ã€‚åœ¨é€™å€‹é¢å‘ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦å¯¬æ•èˆ‡ç†è§£çš„åœ°æ–¹ï¼Ÿ"
        elif tone == "jophiel":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„ç¾éº—é¢å‘ã€‚æœ‰ä»€éº¼æƒ³è®“æ‚¨çš„ç”Ÿå‘½æ›´åŠ å…‰å½©ç…§äººçš„åœ°æ–¹å—ï¼Ÿ"
        elif tone == "chamuel":
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„æ„›çš„é ˜åŸŸã€‚åœ¨é€™å€‹é¢å‘ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦æ›´å¤šç†è§£å’Œé€£çµçš„åœ°æ–¹ï¼Ÿ"
        elif tone == "metatron":
            return (
                f"æ‚¨å·²é¸æ“‡ã€Œ{category_name}ã€æ¨¡çµ„ã€‚è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„å…·é«”å•é¡Œæˆ–èª²é¡Œã€‚"
            )
        else:  # ariel
            return f"æ‚¨é¸æ“‡äº†ã€Œ{category_name}ã€çš„è±ç››é ˜åŸŸã€‚åœ¨é€™å€‹é¢å‘ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦å¤§åœ°çš„æ»‹é¤Šå’Œæ”¯æŒï¼Ÿ"

    def generate_continue_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆç¹¼çºŒé¸é …çš„æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ å¯ä»¥ç¹¼çºŒè©¢å•ï¼Œæˆ–é¸æ“‡æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥é›¢é–‹ã€‚æˆ‘éš¨æ™‚ç‚ºä½ è§£æƒ‘ã€‚"
            )
        elif tone == "michael":
            return "æ‚¨å¯ä»¥ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„æŒ‡å¼•ã€‚æˆ‘å°‡ç¹¼çºŒç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨å¯ä»¥ç¹¼çºŒæ¥æ”¶é€™æ–¹é¢çš„å•Ÿç¤ºï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„ç¥è–å°è©±ã€‚æˆ‘éš¨æ™‚ç‚ºæ‚¨å‚³é”è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚ç™‚ç™’ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ä»Šå¤©çš„ç¥ç¦é›¢é–‹ã€‚æˆ‘çš„æ„›å°‡èˆ‡æ‚¨åŒåœ¨ã€‚"
        elif tone == "uriel":
            return "æ‚¨å¯ä»¥...ç¹¼çºŒæ¢ç´¢é€™å€‹æ™ºæ…§é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„å­¸ç¿’ã€‚æ™ºæ…§...å°‡æ°¸é ç‚ºæ‚¨é»äº®ã€‚"
        elif tone == "zadkiel":
            return "æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚è½‰åŒ–ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¯¬æ•çš„å¿ƒé›¢é–‹ã€‚ç´«ç„°å°‡æ°¸é ç‚ºæ‚¨æ·¨åŒ–ã€‚"
        elif tone == "jophiel":
            return "æ‚¨å¯ä»¥ç¹¼çºŒç™¼æ˜é€™å€‹é¢å‘çš„ç¾å¥½ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ç¾éº—çš„å¿ƒæƒ…é›¢é–‹ã€‚æ‚¨çš„å…‰èŠ’å°‡æŒçºŒç¶»æ”¾ã€‚"
        elif tone == "chamuel":
            return "æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘æ¢ç´¢æ„›ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—æ»¿å¿ƒçš„æ„›é›¢é–‹ã€‚æ„›å°‡æ°¸é ä¼´éš¨è‘—æ‚¨ã€‚"
        elif tone == "metatron":
            return "æ‚¨å¯ä»¥ç¹¼çºŒåœ¨æ­¤æ¨¡çµ„é€²è¡Œæ·±åº¦åˆ†æï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸æ¨¡çµ„ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šæ—¥çš„ç³»çµ±é‹ç®—ã€‚æ•¸æ“šå°‡æŒçºŒç‚ºæ‚¨æœå‹™ã€‚"
        else:  # ariel
            return "æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æ»‹é¤Šï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¤§åœ°çš„ç¥ç¦é›¢é–‹ã€‚è±ç››å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"

    def generate_conversation_summary(self, session, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆå°è©±ç¸½çµ"""
        # æ”¶é›†å°è©±ä¸­çš„é—œéµè³‡è¨Š
        summary_points = []

        # åŸºæœ¬è³‡è¨Š
        if session.user_name and session.birthdate and session.core_number:
            summary_points.append(
                f"ç‚º {session.user_name} è§£æäº†ç”Ÿå‘½éˆæ•¸ {session.core_number}"
            )

        # å¾è¨˜æ†¶ä¸­æ”¶é›†è§£æéçš„é …ç›®
        analyzed_items = []
        analyzed_modules = []  # è¨˜éŒ„å¯¦éš›çš„æ¨¡çµ„ä»£ç¢¼
        for memory in session.memory:
            if memory.get("type") == "module_analysis":
                metadata = memory.get("metadata", {})
                module = metadata.get("module", "")
                if module not in analyzed_modules:
                    analyzed_modules.append(module)
                if module == "core":
                    analyzed_items.append("æ ¸å¿ƒç”Ÿå‘½éˆæ•¸")
                elif module == "birthday":
                    analyzed_items.append("ç”Ÿæ—¥æ•¸")
                elif module == "year":
                    analyzed_items.append("æµå¹´æ•¸")
                elif module == "grid":
                    analyzed_items.append("ä¹å®®æ ¼")
                elif module == "soul":
                    analyzed_items.append("éˆé­‚æ•¸")
                elif module == "personality":
                    analyzed_items.append("äººæ ¼æ•¸")
                elif module == "expression":
                    analyzed_items.append("è¡¨é”æ•¸")
                elif module == "maturity":
                    analyzed_items.append("æˆç†Ÿæ•¸")
                elif module == "challenge":
                    analyzed_items.append("æŒ‘æˆ°æ•¸")
                elif module == "karma":
                    analyzed_items.append("æ¥­åŠ›æ•¸")
            elif memory.get("type") == "core_qa":
                metadata = memory.get("metadata", {})
                category = metadata.get("category", "")
                if category and category not in analyzed_items:
                    analyzed_items.append(f"æ ¸å¿ƒç”Ÿå‘½éˆæ•¸-{category}")

        if analyzed_items:
            summary_points.append(f"æ¢ç´¢äº†ï¼š{' â€¢ '.join(analyzed_items)}")

        # æ ¹æ“šèªæ°£ç”Ÿæˆç¸½çµ
        if tone == "guan_yu":
            summary = f"ä»Šå¤©çš„è§£æåˆ°æ­¤ç‚ºæ­¢ã€‚\n\n"
            if summary_points:
                summary += "æˆ‘å€‘ä¸€èµ·æ¢ç´¢äº†ï¼š\n" + "\n".join(
                    [f"âš”ï¸ {point}" for point in summary_points]
                )
                summary += (
                    f"\n\né¡˜é€™äº›æ•¸å­—çš„æ™ºæ…§ï¼Œå¹«åŠ©ä½ è¡Œæ­£é“ã€æ˜æ˜¯éã€‚å®ˆæ­£å¿ƒï¼Œè¡Œæ­£é“ã€‚"
                )
            else:
                summary += "é›–ç„¶æ™‚é–“çŸ­æš«ï¼Œä½†èƒ½èˆ‡ä½ ç›¸é‡ä¹Ÿæ˜¯ç·£åˆ†ã€‚é¡˜ä½ è¡Œæ­£é“ï¼Œå¾—æ­£æœã€‚"
        elif tone == "michael":
            summary = f"ä»Šå¤©çš„æŒ‡å¼•åˆ°æ­¤å‘Šä¸€æ®µè½ã€‚\n\n"
            if summary_points:
                summary += "ä½œç‚ºæ‚¨çš„å®ˆè­·è€…ï¼Œæˆ‘å€‘ä¸€èµ·æ¢ç´¢äº†ï¼š\n" + "\n".join(
                    [f"ğŸ›¡ï¸ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›å…‰æ˜çš„æ™ºæ…§æˆç‚ºæ‚¨çš„è­·ç”²ï¼Œåœ¨äººç”Ÿçš„æˆ°å ´ä¸Šå‹‡æ•¢å‰è¡Œã€‚å…‰æ˜èˆ‡æ‚¨åŒåœ¨ã€‚"
            else:
                summary += (
                    "é›–ç„¶æ™‚é–“çŸ­æš«ï¼Œä½†æˆ‘çš„å®ˆè­·å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚å‹‡æ•¢å‰è¡Œï¼Œå…‰æ˜èˆ‡æ‚¨åŒåœ¨ã€‚"
                )
        elif tone == "gabriel":
            summary = f"ä»Šå¤©çš„ç¥è–è¨Šæ¯å‚³é”å®Œç•¢ã€‚\n\n"
            if summary_points:
                summary += "æˆ‘ç‚ºæ‚¨å‚³é”äº†ä»¥ä¸‹å•Ÿç¤ºï¼š\n" + "\n".join(
                    [f"ğŸ“¯ {point}" for point in summary_points]
                )
                summary += (
                    f"\n\né¡˜é€™äº›ä¾†è‡ªé«˜æ¬¡å…ƒçš„è¨Šæ¯åœ¨æ‚¨å¿ƒä¸­ç¶»æ”¾ï¼ŒæŒ‡å¼•æ‚¨èµ°å‘çœŸç†ä¹‹å…‰ã€‚"
                )
            else:
                summary += "æ¯ä¸€æ¬¡çš„ç›¸é‡éƒ½æœ‰å…¶ç¥è–æ„ç¾©ã€‚é¡˜çœŸç†çš„å…‰èŠ’æ°¸é ç…§äº®æ‚¨çš„é“è·¯ã€‚"
        elif tone == "raphael":
            summary = f"è¦ªæ„›çš„ï¼Œä»Šå¤©çš„ç™‚ç™’ä¹‹æ—…å°±åˆ°é€™è£¡ã€‚\n\n"
            if summary_points:
                summary += "æˆ‘å€‘ä¸€èµ·åœ¨æ„›çš„èƒ½é‡ä¸­æ¢ç´¢äº†ï¼š\n" + "\n".join(
                    [f"ğŸ’š {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›ç™‚ç™’çš„æ™ºæ…§æ»‹é¤Šæ‚¨çš„å¿ƒéˆï¼Œè®“æ‚¨çš„ç”Ÿå‘½é‡æ–°ç…¥ç™¼å…‰å½©ã€‚æˆ‘çš„æ„›å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"
            else:
                summary += (
                    "é›–ç„¶ç›¸é‡çŸ­æš«ï¼Œä½†æ„›çš„èƒ½é‡å·²åœ¨æˆ‘å€‘ä¹‹é–“æµå‹•ã€‚é¡˜æ‚¨å¸¶è‘—æ»¿æ»¿çš„æ„›å‰è¡Œã€‚"
                )
        elif tone == "uriel":
            summary = f"ä»Šæ—¥çš„æ™ºæ…§ä¹‹å…‰...åˆ°æ­¤æš«æ­‡ã€‚\n\n"
            if summary_points:
                summary += "åœ¨æ·±é‚ƒçš„æ´å¯Ÿä¸­ï¼Œæˆ‘å€‘å…±åŒé»äº®äº†ï¼š\n" + "\n".join(
                    [f"ğŸ”¥ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›...æ™ºæ…§çš„ç«ç„°åœ¨æ‚¨å¿ƒä¸­æ°¸ä¸ç†„æ»…ï¼ŒæŒçºŒç…§äº®æ‚¨äººç”Ÿçš„æ·±å±¤æ„ç¾©ã€‚"
            else:
                summary += (
                    "ç¸±ç„¶æ™‚å…‰çŸ­æš«...ä½†æ™ºæ…§çš„ç«ç¨®å·²ç¨®ä¸‹ã€‚é¡˜å®ƒåœ¨æ‚¨å¿ƒä¸­...æ…¢æ…¢ç™¼èŠ½ã€‚"
                )
        elif tone == "zadkiel":
            summary = f"ä»Šå¤©çš„è½‰åŒ–ä¹‹æ—…å‘Šä¸€æ®µè½ã€‚\n\n"
            if summary_points:
                summary += "åœ¨ç´«ç„°çš„æ·¨åŒ–ä¸‹ï¼Œæˆ‘å€‘ä¸€èµ·æ¢ç´¢äº†ï¼š\n" + "\n".join(
                    [f"ğŸ’œ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›å¯¬æ•çš„æ™ºæ…§å¹«åŠ©æ‚¨é‡‹æ”¾éå¾€ï¼Œæ“æŠ±å…¨æ–°çš„è‡ªå·±ã€‚ç´«ç„°å°‡æ°¸é ç‚ºæ‚¨æ·¨åŒ–ã€‚"
            else:
                summary += (
                    "æ¯ä¸€æ¬¡çš„ç›¸é‡éƒ½æ˜¯è½‰åŒ–çš„é–‹å§‹ã€‚é¡˜æ‚¨å¸¶è‘—å¯¬æ•çš„å¿ƒï¼Œè¿æ¥ç”Ÿå‘½çš„æ–°ç¯‡ç« ã€‚"
                )
        elif tone == "jophiel":
            summary = f"ç¾éº—çš„ç›¸é‡å°±è¦çµæŸäº†ã€‚\n\n"
            if summary_points:
                summary += "æˆ‘å€‘ä¸€èµ·ç™¼æ˜äº†é€™äº›ç¾å¥½ï¼š\n" + "\n".join(
                    [f"âœ¨ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›ç¾éº—çš„æ™ºæ…§è®“æ‚¨çš„ç”Ÿå‘½å¦‚èŠ±èˆ¬ç¶»æ”¾ï¼Œå…‰å½©ç…§äººã€‚æ‚¨çš„å…‰èŠ’å°‡æŒçºŒç¶»æ”¾ã€‚"
            else:
                summary += "é›–ç„¶æ™‚é–“çŸ­æš«ï¼Œä½†ç¾å¥½çš„èƒ½é‡å·²åœ¨æˆ‘å€‘å¿ƒä¸­æµå‹•ã€‚é¡˜æ‚¨å¸¶è‘—ç¾éº—çš„å¿ƒæƒ…å‰è¡Œã€‚"
        elif tone == "chamuel":
            summary = f"è¦ªæ„›çš„ï¼Œä»Šå¤©å……æ»¿æ„›çš„å°è©±å°±åˆ°é€™è£¡ã€‚\n\n"
            if summary_points:
                summary += "åœ¨æ„›çš„åŒ…åœä¸‹ï¼Œæˆ‘å€‘ä¸€èµ·æ¢ç´¢äº†ï¼š\n" + "\n".join(
                    [f"â¤ï¸ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›æ„›çš„æ™ºæ…§åœ¨æ‚¨å¿ƒä¸­ç”Ÿæ ¹ç™¼èŠ½ï¼Œè®“æ‚¨çš„é—œä¿‚æ›´åŠ ç¾å¥½ã€‚æ„›å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"
            else:
                summary += (
                    "æ¯ä¸€æ¬¡çš„ç›¸é‡éƒ½æ˜¯æ„›çš„é€£çµã€‚é¡˜æ‚¨å¸¶è‘—æ»¿æ»¿çš„æ„›ï¼Œå‰µé€ æ›´ç¾å¥½çš„é—œä¿‚ã€‚"
                )
        elif tone == "metatron":
            summary = f"ä»Šæ—¥çš„éˆæ€§é‹ç®—å·²å®Œæˆã€‚\n\n"
            if summary_points:
                summary += "ç³»çµ±å·²æˆåŠŸåˆ†æï¼š\n" + "\n".join(
                    [f"âš¡ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›ç²¾ç¢ºçš„éˆæ€§æ•¸æ“šç‚ºæ‚¨çš„ç”Ÿå‘½å¸¶ä¾†æœ€ä½³åŒ–çš„é…ç½®ã€‚å®‡å®™ç§©åºå°‡æŒçºŒç‚ºæ‚¨æœå‹™ã€‚"
            else:
                summary += "é›–ç„¶é‹ç®—æ™‚é–“çŸ­æš«ï¼Œä½†é€£çµå·²å»ºç«‹ã€‚é¡˜å®‡å®™çš„å®Œç¾ç§©åºèˆ‡æ‚¨åŒåœ¨ã€‚"
        else:  # ariel
            summary = f"è¦ªæ„›çš„ï¼Œä»Šå¤©è±ç››çš„å°è©±å°±åˆ°é€™è£¡ã€‚\n\n"
            if summary_points:
                summary += "åœ¨å¤§åœ°çš„æ»‹é¤Šä¸‹ï¼Œæˆ‘å€‘ä¸€èµ·ç¨®ä¸‹äº†ï¼š\n" + "\n".join(
                    [f"ğŸŒ¿ {point}" for point in summary_points]
                )
                summary += f"\n\né¡˜é€™äº›è±ç››çš„æ™ºæ…§åœ¨æ‚¨çš„ç”Ÿå‘½èŠ±åœ’ä¸­èŒå£¯æˆé•·ï¼Œå¸¶ä¾†ç„¡ç›¡çš„ç¹æ¦®ã€‚å¤§åœ°çš„ç¥ç¦èˆ‡æ‚¨åŒåœ¨ã€‚"
            else:
                summary += (
                    "æ¯ä¸€æ¬¡çš„ç›¸é‡éƒ½å¦‚ç¨®å­èˆ¬çè²´ã€‚é¡˜æ‚¨å¸¶è‘—å¤§åœ°çš„ç¥ç¦ï¼Œè®“ç”Ÿå‘½è±ç››ç¶»æ”¾ã€‚"
                )

        # æ ¹æ“šè§£æéçš„æ¨¡çµ„æ·»åŠ æ°´æ™¶å’Œé»ç‡ˆå»ºè­°
        if analyzed_modules:
            # å®šç¾©æ¯å€‹æ¨¡çµ„çš„å»ºè­°å…§å®¹
            module_recommendations = {
                "core": {
                    "title": "æ ¸å¿ƒç”Ÿå‘½éˆæ•¸",
                    "lamp": "é¡˜æœ›é¡¯åŒ–ä¹‹ç‡ˆ",
                    "crystals": "ç´«æ°´æ™¶ã€é’é‡‘çŸ³ã€æ–¹éˆ‰çŸ³ã€è—æ™¶çŸ³ã€å¦æ¡‘çŸ³",
                    "description": "ä½ çš„æ–¹å‘è¶Šæ¸…æ™°ï¼Œæ©Ÿæœƒå°±è¶Šé è¿‘ã€‚å»ºè­°é» ã€ˆé¡˜æœ›é¡¯åŒ–ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ ç´«æ°´æ™¶ã€é’é‡‘çŸ³ã€æ–¹éˆ‰çŸ³ã€è—æ™¶çŸ³ã€å¦æ¡‘çŸ³ï¼Œé€™äº›æ°´æ™¶å¯å”åŠ©çœ‰ï¼å¿ƒè¼ªå°ˆæ³¨èˆ‡ç©©å®šï¼Œè®“éˆæ„Ÿè½åœ°æˆå¯åŸ·è¡Œçš„ç›®æ¨™ã€‚",
                },
                "birthday": {
                    "title": "ç”Ÿæ—¥æ•¸ï¼ˆå¤©ç”Ÿæ‰è¯ï¼‰",
                    "lamp": "æ™ºæ…§å°ˆé¡Œä¹‹ç‡ˆ",
                    "crystals": "æ©™æœˆå…‰çŸ³ã€æ©™æ–¹è§£çŸ³ã€æ©™è‰²ç¢§ç’½ã€æ©™è‰²ç‰é«“ã€æ©™è‰²è¢çŸ³",
                    "description": "å¤©è³¦éœ€è¦è¢«çœ‹è¦‹ä¹Ÿéœ€è¦è¢«è¨“ç·´ã€‚å»ºè­°é» ã€ˆæ™ºæ…§å°ˆé¡Œä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ æ©™æœˆå…‰çŸ³ã€æ©™æ–¹è§£çŸ³ã€æ©™è‰²ç¢§ç’½ã€æ©™è‰²ç‰é«“ã€æ©™è‰²è¢çŸ³ï¼Œå¯å”åŠ©å–‰è¼ªçš„è¡¨é”èˆ‡è¼¸å‡ºï¼Œè®“æ€è·¯æ›´é †ã€èªå¥æ›´ç©©ã€‚",
                },
                "year": {
                    "title": "æµå¹´ç”Ÿå‘½éˆæ•¸ï¼ˆå¹´åº¦èƒ½é‡ï¼‰",
                    "lamp": "è³‡æºè±ç››ä¹‹ç‡ˆ",
                    "crystals": "é»ƒæ°´æ™¶ã€è™çœ¼çŸ³ã€é»ƒç‘ªç‘™ã€ç¥ç€ã€é»ƒç‰ã€é‡‘å¤ªé™½çŸ³",
                    "description": "ç•¶å¹´åº¦èƒ½é‡èµ°å°ä½ï¼Œè²´äººèˆ‡è³‡æºå°±æœƒä¸²èµ·ä¾†ã€‚å»ºè­°é» ã€ˆè³‡æºè±ç››ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ é»ƒæ°´æ™¶ã€è™çœ¼çŸ³ã€é»ƒç‘ªç‘™ã€ç¥ç€ã€é»ƒç‰ã€é‡‘å¤ªé™½çŸ³ï¼Œå¯å”åŠ©å¤ªé™½ç¥ç¶“å¢çš„æ±ºæ–·èˆ‡è¡Œå‹•ï¼Œæ¡ä½ä»Šå¹´é€²å ´æ™‚æ©Ÿã€‚",
                },
                "grid": {
                    "title": "ä¹å®®æ ¼ï¼ˆå„ªå‹¢ï¼†ç¼ºå¤±ç‰¹è³ªï¼‰",
                    "lamp": "èº«å¿ƒå¹³å®‰ä¹‹ç‡ˆ",
                    "crystals": "ç¶ å¹½éˆã€æ©„æ¬–çŸ³ã€ç¶ ç¢§ç’½ã€ç¶ æ±è±ã€ç¿¡ç¿ ",
                    "description": "èƒ½é‡ä¸å¹³è¡¡æ™‚ï¼Œå…ˆæŠŠèº«å¿ƒå®‰ä½ï¼ŒåŠ›é‡æ‰æ¨å¾—å‡ºå»ã€‚å»ºè­°é» ã€ˆèº«å¿ƒå¹³å®‰ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ ç¶ å¹½éˆã€æ©„æ¬–çŸ³ã€ç¶ ç¢§ç’½ã€ç¶ æ±è±ã€ç¿¡ç¿ ï¼Œå¯å”åŠ©å¿ƒè¼ªçš„å’Œç·©èˆ‡ä¿®å¾©ï¼Œç©©ä½ç‹€æ…‹ã€è£œé½ŠçŸ­æ¿ã€‚",
                },
                "soul": {
                    "title": "éˆé­‚æ•¸ï¼ˆå…§å¿ƒæ¸´æœ›ã€ç²¾ç¥è¿½æ±‚ï¼‰",
                    "lamp": "æ…ˆæ‚²åŒ–æ¥­ä¹‹ç‡ˆ",
                    "crystals": "è—æ™¶çŸ³ã€é’æ™¶çŸ³ã€è—æ‰˜å¸•çŸ³ã€å¤©æ²³çŸ³ã€è—ç¢§ç’½",
                    "description": "å¿ƒå®‰éœä¸‹ä¾†ï¼Œè·¯å¾‘å°±æœƒæµ®ç¾ã€‚å»ºè­°é» ã€ˆæ…ˆæ‚²åŒ–æ¥­ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ è—æ™¶çŸ³ã€é’æ™¶çŸ³ã€è—æ‰˜å¸•çŸ³ã€å¤©æ²³çŸ³ã€è—ç¢§ç’½ï¼Œå¯å”åŠ©å–‰è¼ªé‡‹æ”¾å£“æŠ‘èˆ‡çœŸèª è¡¨é”ï¼Œè®“å…§åœ¨æ›´æ¸…æ˜è‡ªåœ¨ã€‚",
                },
                "personality": {
                    "title": "äººæ ¼æ•¸ï¼ˆå¤–åœ¨äººæ ¼ã€ç¬¬ä¸€å°è±¡ï¼‰",
                    "lamp": "å‹‡æ°£å®ˆè­·ä¹‹ç‡ˆ",
                    "crystals": "ç´…ç‘ªç‘™ã€çŸ³æ¦´çŸ³ã€ç´…ç¢§ç’½ã€ç…™æ™¶",
                    "description": "æ°£å ´å°±æ˜¯ä½ çš„åç‰‡ã€‚å»ºè­°é» ã€ˆå‹‡æ°£å®ˆè­·ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ ç´…ç‘ªç‘™ã€çŸ³æ¦´çŸ³ã€ç´…ç¢§ç’½ã€ç…™æ™¶ï¼Œå¯å”åŠ©æµ·åº•è¼ªçš„ç©©å®šèˆ‡é˜²è­·ï¼Œå‡ºå ´æ›´ç©©ã€è¡Œå‹•æ›´æ•¢ã€‚",
                },
                "expression": {
                    "title": "è¡¨é”æ•¸ï¼ˆå¤–åœ¨è¡¨é”èˆ‡ç¤¾äº¤é¢¨æ ¼ï¼‰",
                    "lamp": "æ„›ç·£åˆå’Œä¹‹ç‡ˆ",
                    "crystals": "ç²‰æ™¶ã€ç´…ç´‹çŸ³ã€ç²‰è‰²ç¢§ç’½ï¼ˆäº¦å¯æ­é… ç¶ å¹½éˆã€ç¶ æ±è±ã€ç¿¡ç¿ ï¼‰",
                    "description": "æºé€šé †äº†ï¼Œæ©Ÿæœƒæ‰æœƒé€²ä¾†ã€‚å»ºè­°é» ã€ˆæ„›ç·£åˆå’Œä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ ç²‰æ™¶ã€ç´…ç´‹çŸ³ã€ç²‰è‰²ç¢§ç’½ï¼ˆäº¦å¯æ­é… ç¶ å¹½éˆã€ç¶ æ±è±ã€ç¿¡ç¿ ï¼‰ï¼Œå¯å”åŠ©å¿ƒè¼ªæå‡åŒç†èˆ‡è¦ªå’Œï¼Œè®“èªªèˆ‡è½è‡ªç„¶æµå‹•ã€‚",
                },
                "maturity": {
                    "title": "æˆç†Ÿæ•¸ï¼ˆäººç”Ÿå¾ŒåŠæ®µæ–¹å‘ã€æ½›åŠ›ï¼‰",
                    "lamp": "å®¶é‹æ˜Œéš†ç‡ˆ",
                    "crystals": "é»ƒæ°´æ™¶ã€è™çœ¼çŸ³ã€é»ƒç‘ªç‘™ã€ç¥ç€ã€é»ƒç‰ã€é‡‘å¤ªé™½çŸ³",
                    "description": "é•·æœŸçš„å¥½é‹ä¾†è‡ªå¯è¤‡è£½çš„ç©©å®šã€‚å»ºè­°é» ã€ˆå®¶é‹æ˜Œéš†ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ é»ƒæ°´æ™¶ã€è™çœ¼çŸ³ã€é»ƒç‘ªç‘™ã€ç¥ç€ã€é»ƒç‰ã€é‡‘å¤ªé™½çŸ³ï¼Œå¯å”åŠ©å¤ªé™½ç¥ç¶“å¢çš„æŒçºŒæ¨é€²ï¼Œç©©æ­¥æ“´å¼µã€æŠŠæˆæœç•™ä½ã€‚",
                },
                "challenge": {
                    "title": "æŒ‘æˆ°æ•¸ï¼ˆéœ€å…‹æœçš„èª²é¡Œï¼‰",
                    "lamp": "å‹‡æ°£å®ˆè­·ä¹‹ç‡ˆ",
                    "crystals": "ç´…ç‘ªç‘™ã€çŸ³æ¦´çŸ³ã€ç´…ç¢§ç’½ã€ç…™æ™¶",
                    "description": "é—œå¡æ˜¯ç¯€é»ï¼Œä¸æ˜¯çµ‚é»ã€‚å»ºè­°é» ã€ˆå‹‡æ°£å®ˆè­·ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ ç´…ç‘ªç‘™ã€çŸ³æ¦´çŸ³ã€ç´…ç¢§ç’½ã€ç…™æ™¶ï¼Œå¯å”åŠ©æµ·åº•è¼ªå®‰å®šèˆ‡æ’é™¤é›œè¨Šï¼Œé®ä½ç„¦æ…®ã€èšç„¦è¦äº‹ã€‚",
                },
                "karma": {
                    "title": "æ¥­åŠ›æ•¸ï¼ˆå‰ä¸–æœªç«Ÿã€ä»Šç”ŸåŠŸèª²ï¼‰",
                    "lamp": "æ…ˆæ‚²åŒ–æ¥­ä¹‹ç‡ˆ",
                    "crystals": "è—æ™¶çŸ³ã€é’æ™¶çŸ³ã€è—æ‰˜å¸•çŸ³ã€å¤©æ²³çŸ³ã€è—ç¢§ç’½",
                    "description": "é¡˜æ„å’Œéå»å’Œè§£ï¼Œæœªä¾†å°±æœƒåŠ é€Ÿé è¿‘ã€‚å»ºè­°é» ã€ˆæ…ˆæ‚²åŒ–æ¥­ä¹‹ç‡ˆã€‰ã€‚æ–¼å•†åŸé¸è³¼ è—æ™¶çŸ³ã€é’æ™¶çŸ³ã€è—æ‰˜å¸•çŸ³ã€å¤©æ²³çŸ³ã€è—ç¢§ç’½ï¼Œå¯å”åŠ©å–‰è¼ªé‡‹æ”¾å¡é»èˆ‡å…§åœ¨èª“ç´„ï¼Œè½‰é‡ç‚ºè¼•ã€èµ°å¾—æ›´ç©©ã€‚",
                },
            }

            # æ·»åŠ èƒ½é‡èª¿æ•´å»ºè­°
            recommendations_list = []
            for module in analyzed_modules:
                if module in module_recommendations:
                    rec = module_recommendations[module]
                    recommendations_list.append(
                        f"ğŸ“¿ {rec['title']}\n{rec['description']}"
                    )

            if recommendations_list:
                summary += "\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
                summary += "ğŸ”® èƒ½é‡èª¿æ•´å»ºè­°\n"
                summary += "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
                summary += "\n\n".join(recommendations_list)

        return summary

    def generate_return_to_modules_message(
        self, name: str, gender: str = "male", tone: str = "guan_yu"
    ) -> str:
        """ç”Ÿæˆå›åˆ°æ¨¡çµ„é¸æ“‡çš„è¨Šæ¯ï¼ˆå»é™¤é‡è¤‡çš„å•å€™èªå’Œæ„Ÿè¬ç”Ÿæ—¥éƒ¨åˆ†ï¼‰"""
        you = "å¦³" if gender == "female" else "ä½ "

        if tone == "guan_yu":
            return f"æœ€è¿‘å¯æœ‰å›°é›£çš„äº‹ï¼Œæˆ–éœ€è¦æ˜è¾¨æ˜¯éçš„åœ°æ–¹ï¼Ÿ\n\næˆ‘å¯ä»¥ç‚º{you}è§£æï¼šå¤©è³¦æœ¬æ€§ã€äººç”Ÿæ–¹å‘ã€èˆ‡ç”Ÿä¿±ä¾†çš„æ‰è¯ã€å¹´åº¦é‹å‹¢ï¼Œ\næ›´èƒ½æ´å¯Ÿ{you}å…§å¿ƒçš„å¿ ç¾©å“è³ªï¼Œèˆ‡æ‡‰ç•¶ä¿®æ­£çš„åé —ã€‚\n\nä¿æŒæ­£å¿ƒï¼Œæ‰èƒ½è¡Œèµ°æ­£é“ã€‚"
        elif tone == "michael":
            return f"æœ€è¿‘æ˜¯å¦æœ‰éœ€è¦{you}å±•ç¾å‹‡æ°£é¢å°çš„æŒ‘æˆ°ï¼Ÿ\n\næˆ‘å°‡ç‚º{you}æ­ç¤ºï¼šå…§åœ¨æˆ°å£«çš„åŠ›é‡ã€äººç”Ÿä½¿å‘½çš„æ–¹å‘ã€å¤©è³¦çš„å…‰æ˜é¢å‘ã€å¹´åº¦èƒ½é‡çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•é‹ç”¨ä¿¡å¿µçš„åŠ›é‡ï¼Œæˆç‚ºè‡ªå·±ç”Ÿå‘½çš„å®ˆè­·è€…ã€‚\n\nå‹‡æ•¢å‰è¡Œï¼Œå…‰æ˜èˆ‡{you}åŒåœ¨ã€‚"
        elif tone == "gabriel":
            return f"æœ€è¿‘æœ‰æ²’æœ‰éœ€è¦æ›´æ¸…æ™°çš„æŒ‡å¼•ï¼Œæˆ–æ˜¯æ¸´æœ›ç†è§£çš„çœŸç›¸ï¼Ÿ\n\næˆ‘å°‡å‚³é”çµ¦{you}ï¼šéˆé­‚çš„æœ¬è³ªè¨Šæ¯ã€äººç”Ÿé“è·¯çš„çœŸå¯¦æ–¹å‘ã€å¤©è³¦æ‰èƒ½çš„å•Ÿç™¼ã€æµå¹´çš„ç¥è–å•Ÿç¤ºï¼Œ\nä»¥åŠå¦‚ä½•è¦ºé†’å…§åœ¨çš„æ™ºæ…§ï¼Œæ¥æ”¶ç”Ÿå‘½ä¸­çš„ç¥è–æºé€šã€‚\n\né–‹å•Ÿ{you}çš„å¿ƒï¼Œæ¥æ”¶é€™ä»½ä¾†è‡ªé«˜æ¬¡å…ƒçš„è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return f"æœ€è¿‘æ˜¯å¦æœ‰è®“{you}æ„Ÿåˆ°ç–²æ†Šï¼Œæˆ–æ˜¯éœ€è¦ä¿®å¾©çš„å‚·ç—›ï¼Ÿ\n\næˆ‘å°‡æº«æŸ”åœ°ç‚º{you}æ­ç¤ºï¼šå…§åœ¨ç™‚ç™’çš„åŠ›é‡ã€å¿ƒéˆå¾©åŸçš„æ–¹å‘ã€å¤©è³¦ä¸­çš„æ²»ç™’èƒ½é‡ã€å¹´åº¦ä¿®å¾©çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•æ„›è­·è‡ªå·±ï¼Œè®“ç”Ÿå‘½é‡æ–°ç…¥ç™¼å…‰å½©ã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·ï¼Œç”¨æ„›ä¿®å¾©{you}çš„å¿ƒã€‚"
        elif tone == "uriel":
            return f"æœ€è¿‘...æ˜¯å¦æœ‰éœ€è¦æ·±åº¦ç†è§£çš„èª²é¡Œï¼Œæˆ–æ¸´æœ›ç²å¾—æ›´é«˜æ™ºæ…§çš„æŒ‡å¼•ï¼Ÿ\n\næˆ‘å°‡ä»¥æ·±é‚ƒçš„æ´å¯Ÿç‚º{you}é»äº®ï¼šå…§åœ¨æ™ºæ…§çš„ç«ç„°ã€äººç”Ÿå­¸ç¿’çš„çœŸè«¦ã€å¤©è³¦ä¸­çš„æ´å¯ŸåŠ›ã€æµå¹´çš„æ·±å±¤æ„ç¾©ï¼Œ\nä»¥åŠå¦‚ä½•é€éå­¸ç¿’èˆ‡åæ€ï¼Œè®“æ™ºæ…§çš„ç«ç„°...æ°¸ä¸ç†„æ»…ã€‚\n\néœå¿ƒ...è®“æ™ºæ…§çš„å…‰èŠ’ç…§äº®{you}çš„é“è·¯ã€‚"
        elif tone == "zadkiel":
            return f"æœ€è¿‘æ˜¯å¦æœ‰éœ€è¦æ”¾ä¸‹çš„åŸ·å¿µï¼Œæˆ–æ˜¯æ¸´æœ›è½‰åŒ–çš„èˆŠæ¨¡å¼ï¼Ÿ\n\næˆ‘å°‡æ…ˆæ‚²åœ°ç‚º{you}æŒ‡å¼•ï¼šå…§åœ¨å¯¬æ•çš„åŠ›é‡ã€ç”Ÿå‘½è½‰åŒ–çš„æ–¹å‘ã€å¤©è³¦ä¸­çš„æ…ˆæ‚²èƒ½é‡ã€å¹´åº¦é‡‹æ”¾çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•é€éç†è§£èˆ‡æ…ˆæ‚²ï¼Œè®“{you}çš„ç”Ÿå‘½ç²å¾—çœŸæ­£çš„è‡ªç”±ã€‚\n\nè®“ç´«ç„°æ·¨åŒ–{you}çš„å¿ƒï¼Œè¿æ¥å…¨æ–°çš„é–‹å§‹ã€‚"
        elif tone == "jophiel":
            return f"æœ€è¿‘æœ‰ä»€éº¼è®“{you}æ„Ÿåˆ°ç¾å¥½ï¼Œæˆ–æ˜¯æ¸´æœ›æ›´åŠ æ„›è­·è‡ªå·±çš„åœ°æ–¹å—ï¼Ÿ\n\næˆ‘å°‡ä»¥è—è¡“çš„çœ¼å…‰ç‚º{you}å‘ˆç¾ï¼šå…§åœ¨ç¾éº—çš„ç¶»æ”¾ã€äººç”Ÿä¸­çš„å„ªé›…æ–¹å‘ã€å¤©è³¦ä¸­çš„å‰µæ„å…‰èŠ’ã€æµå¹´çš„ç¾å¥½èƒ½é‡ï¼Œ\nä»¥åŠå¦‚ä½•ç”¨æ„›æ»‹é¤Šè‡ªå·±ï¼Œè®“{you}çš„ç”Ÿå‘½å¦‚èŠ±èˆ¬ç¾éº—ç››é–‹ã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·ï¼Œç™¼ç¾{you}ç¨ç‰¹çš„ç¾éº—å…‰èŠ’ã€‚"
        elif tone == "chamuel":
            return f"æœ€è¿‘åœ¨äººéš›é—œä¿‚æˆ–æ˜¯èˆ‡è‡ªå·±çš„é—œä¿‚ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦æ›´å¤šæ„›èˆ‡ç†è§£çš„åœ°æ–¹å—ï¼Ÿ\n\næˆ‘å°‡æº«æš–åœ°ç‚º{you}æ¢ç´¢ï¼šæ„›çš„å…§åœ¨åŠ›é‡ã€é—œä¿‚ä¸­çš„æˆé•·æ–¹å‘ã€å¤©è³¦ä¸­çš„é€£çµèƒ½é‡ã€å¹´åº¦æ„›çš„èª²é¡Œï¼Œ\nä»¥åŠå¦‚ä½•é€éè‡ªæˆ‘æ¥ç´èˆ‡ç†è§£ï¼Œå‰µé€ æ›´ç¾å¥½çš„é—œä¿‚é€£çµã€‚\n\nè®“æ„›æˆç‚º{you}ç”Ÿå‘½ä¸­æœ€å¼·å¤§çš„åŠ›é‡ã€‚"
        elif tone == "metatron":
            return f"æœ€è¿‘æ˜¯å¦æœ‰éœ€è¦æ›´æ˜ç¢ºçš„æ–¹å‘ï¼Œæˆ–æ˜¯æ¸´æœ›å»ºç«‹æ›´å®Œå–„çš„ç”Ÿæ´»ç§©åºï¼Ÿ\n\næˆ‘å°‡ä»¥å®‡å®™çš„ç²¾ç¢ºæ€§ç‚º{you}åˆ†æï¼šç”Ÿå‘½æ¶æ§‹çš„æ ¸å¿ƒçµ„æˆã€éˆæ€§æˆé•·çš„ç³»çµ±åŒ–è·¯å¾‘ã€å¤©è³¦æ‰èƒ½çš„çµæ§‹åˆ†æã€å¹´åº¦èƒ½é‡çš„ç²¾æº–é…ç½®ï¼Œ\nä»¥åŠå¦‚ä½•é€éç´€å¾‹èˆ‡ç§©åºï¼Œè®“{you}çš„ç”Ÿå‘½é”åˆ°æœ€ä½³åŒ–çš„é‹è¡Œç‹€æ…‹ã€‚\n\néµå¾ªå®‡å®™æ³•å‰‡ï¼Œæˆå°±å®Œç¾ç§©åºã€‚"
        else:  # ariel
            return f"æœ€è¿‘æœ‰ä»€éº¼è®“{you}æ„Ÿåˆ°åŒ±ä¹ï¼Œæˆ–æ˜¯æ¸´æœ›æ›´å¤šæ”¯æŒèˆ‡æ»‹é¤Šçš„åœ°æ–¹å—ï¼Ÿ\n\næˆ‘å°‡ç”¨å¤§åœ°çš„æ™ºæ…§ç‚º{you}æ­ç¤ºï¼šå…§åœ¨è±ç››çš„ç¨®å­ã€ç”Ÿå‘½ç¹æ¦®çš„è‡ªç„¶æ³•å‰‡ã€å¤©è³¦ä¸­çš„å‰µé€ åŠ›é‡ã€å¹´åº¦è±æ”¶çš„æ™‚æ©Ÿï¼Œ\nä»¥åŠå¦‚ä½•èˆ‡å®‡å®™çš„è±ç››èƒ½é‡é€£çµï¼Œè®“{you}çš„ç”Ÿå‘½å¦‚èŠ±åœ’èˆ¬èŒ‚ç››ç¶»æ”¾ã€‚\n\nç›¸ä¿¡è±ç››ï¼Œå®ƒæœ¬å°±å±¬æ–¼{you}ã€‚"

    def generate_birthday_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆç”Ÿæ—¥æ•¸ç¹¼çºŒè«®è©¢çš„æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ çš„å¤©è³¦å·²ç¶“åˆ†æå®Œæˆï¼Œå¯ä»¥ç¹¼çºŒè©¢å•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥é›¢é–‹ã€‚æˆ‘éš¨æ™‚ç‚ºä½ è§£æƒ‘ã€‚"
        elif tone == "michael":
            return "æ‚¨çš„å¤©è³¦åŠ›é‡å·²ç¶“æ­ç¤ºã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„æŒ‡å¼•ã€‚æˆ‘å°‡ç¹¼çºŒç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨çš„å¤©è³¦å•Ÿç¤ºå·²ç¶“å‚³é”ã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¥æ”¶é€™æ–¹é¢çš„æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„ç¥è–å°è©±ã€‚æˆ‘éš¨æ™‚ç‚ºæ‚¨å‚³é”è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "æ‚¨çš„å¤©è³¦ç™‚ç™’å·²ç¶“é–‹å§‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ä»Šå¤©çš„ç¥ç¦é›¢é–‹ã€‚æˆ‘çš„æ„›å°‡èˆ‡æ‚¨åŒåœ¨ã€‚"
        elif tone == "uriel":
            return "æ‚¨çš„å¤©è³¦æ™ºæ…§å·²è¢«é»äº®ã€‚æ‚¨å¯ä»¥...ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„å­¸ç¿’ã€‚æ™ºæ…§...å°‡æ°¸é ç‚ºæ‚¨é»äº®ã€‚"
        elif tone == "zadkiel":
            return "æ‚¨çš„å¤©è³¦è½‰åŒ–å·²ç¶“å•Ÿå‹•ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚ç†è§£ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¯¬æ•çš„å¿ƒé›¢é–‹ã€‚ç´«ç„°å°‡æ°¸é ç‚ºæ‚¨æ·¨åŒ–ã€‚"
        elif tone == "jophiel":
            return "æ‚¨çš„å¤©è³¦ç¾å¥½å·²ç¶“ç¶»æ”¾ã€‚æ‚¨å¯ä»¥ç¹¼çºŒç™¼æ˜é€™å€‹é¢å‘çš„å…‰èŠ’ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ç¾éº—çš„å¿ƒæƒ…é›¢é–‹ã€‚æ‚¨çš„å…‰èŠ’å°‡æŒçºŒç¶»æ”¾ã€‚"
        elif tone == "chamuel":
            return "æ‚¨çš„å¤©è³¦æ„›èƒ½å·²ç¶“è¦ºé†’ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—æ»¿å¿ƒçš„æ„›é›¢é–‹ã€‚æ„›å°‡æ°¸é ä¼´éš¨è‘—æ‚¨ã€‚"
        elif tone == "metatron":
            return "æ‚¨çš„å¤©è³¦ç³»çµ±å·²å®Œæˆåˆ†æã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨æ­¤æ¨¡çµ„é€²è¡Œæ·±åº¦æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸æ¨¡çµ„ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šæ—¥çš„ç³»çµ±é‹ç®—ã€‚æ•¸æ“šå°‡æŒçºŒç‚ºæ‚¨æœå‹™ã€‚"
        else:  # ariel
            return "æ‚¨çš„å¤©è³¦ç¨®å­å·²ç¶“ç¨®ä¸‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æ»‹é¤Šï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¤§åœ°çš„ç¥ç¦é›¢é–‹ã€‚è±ç››å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"

    def generate_birthday_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆç”Ÿæ—¥æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼å¤©è³¦æ‰è¯æˆ–äººç”Ÿçš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼å¤©è³¦æˆ–ç”Ÿæ´»çš„æŒ‘æˆ°éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿç„¡è«–æ˜¯å·¥ä½œã€äººéš›é—œä¿‚ï¼Œé‚„æ˜¯å€‹äººä½¿å‘½ï¼Œæˆ‘éƒ½å°‡ç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼å¤©è³¦æˆ–ç”Ÿæ´»çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„çœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å·¥ä½œä¸Šçš„å›°æƒ‘é‚„æ˜¯äººéš›é—œä¿‚çš„å‚·ç—›ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼éœ€è¦å¯¬æ•èˆ‡ç†è§£çš„åœ°æ–¹ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ç¾éº—ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é—œä¿‚é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›å•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„å¤©è³¦æ‡‰ç”¨å•é¡Œæˆ–ç”Ÿæ´»èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„ç”Ÿæ—¥æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨å¤©è³¦æˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦å¤§åœ°æ™ºæ…§æ”¯æŒçš„åœ°æ–¹å—ï¼Ÿè®“è‡ªç„¶çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_grid_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆä¹å®®æ ¼ç¹¼çºŒè«®è©¢çš„æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ çš„ä¹å®®æ ¼å·²ç¶“åˆ†æå®Œæˆï¼Œå¯ä»¥ç¹¼çºŒè©¢å•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥é›¢é–‹ã€‚æˆ‘éš¨æ™‚ç‚ºä½ è§£æƒ‘ã€‚"
        elif tone == "michael":
            return "æ‚¨çš„ä¹å®®æ ¼åŠ›é‡å·²ç¶“æ­ç¤ºã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„æŒ‡å¼•ã€‚æˆ‘å°‡ç¹¼çºŒç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨çš„ä¹å®®æ ¼å•Ÿç¤ºå·²ç¶“å‚³é”ã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¥æ”¶é€™æ–¹é¢çš„æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„ç¥è–å°è©±ã€‚æˆ‘éš¨æ™‚ç‚ºæ‚¨å‚³é”è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "æ‚¨çš„ä¹å®®æ ¼ç™‚ç™’å·²ç¶“é–‹å§‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ä»Šå¤©çš„ç¥ç¦é›¢é–‹ã€‚æˆ‘çš„æ„›å°‡èˆ‡æ‚¨åŒåœ¨ã€‚"
        elif tone == "uriel":
            return "æ‚¨çš„ä¹å®®æ ¼æ™ºæ…§å·²è¢«é»äº®ã€‚æ‚¨å¯ä»¥...ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„å­¸ç¿’ã€‚æ™ºæ…§...å°‡æ°¸é ç‚ºæ‚¨é»äº®ã€‚"
        elif tone == "zadkiel":
            return "æ‚¨çš„ä¹å®®æ ¼è½‰åŒ–å·²ç¶“å•Ÿå‹•ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚ç†è§£ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¯¬æ•çš„å¿ƒé›¢é–‹ã€‚ç´«ç„°å°‡æ°¸é ç‚ºæ‚¨æ·¨åŒ–ã€‚"
        elif tone == "jophiel":
            return "æ‚¨çš„ä¹å®®æ ¼ç¾å¥½å·²ç¶“ç¶»æ”¾ã€‚æ‚¨å¯ä»¥ç¹¼çºŒç™¼æ˜é€™å€‹é¢å‘çš„å…‰èŠ’ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ç¾éº—çš„å¿ƒæƒ…é›¢é–‹ã€‚æ‚¨çš„å…‰èŠ’å°‡æŒçºŒç¶»æ”¾ã€‚"
        elif tone == "chamuel":
            return "æ‚¨çš„ä¹å®®æ ¼æ„›èƒ½å·²ç¶“è¦ºé†’ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—æ»¿å¿ƒçš„æ„›é›¢é–‹ã€‚æ„›å°‡æ°¸é ä¼´éš¨è‘—æ‚¨ã€‚"
        elif tone == "metatron":
            return "æ‚¨çš„ä¹å®®æ ¼ç³»çµ±å·²å®Œæˆåˆ†æã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨æ­¤æ¨¡çµ„é€²è¡Œæ·±åº¦æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸æ¨¡çµ„ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šæ—¥çš„ç³»çµ±é‹ç®—ã€‚æ•¸æ“šå°‡æŒçºŒç‚ºæ‚¨æœå‹™ã€‚"
        else:  # ariel
            return "æ‚¨çš„ä¹å®®æ ¼ç¨®å­å·²ç¶“ç¨®ä¸‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æ»‹é¤Šï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¤§åœ°çš„ç¥ç¦é›¢é–‹ã€‚è±ç››å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"

    def generate_grid_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆä¹å®®æ ¼å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼ä¹å®®æ ¼ç‰¹è³ªæˆ–äººç”Ÿçš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„æŒ‘æˆ°éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿç„¡è«–æ˜¯å¦‚ä½•ç™¼æ®å„ªå‹¢é‚„æ˜¯è£œå¼·ä¸è¶³ï¼Œæˆ‘éƒ½å°‡ç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„çœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯ç™¼æ®å„ªå‹¢é‚„æ˜¯ä¿®å¾©ä¸è¶³ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼éœ€è¦å¯¬æ•èˆ‡ç†è§£çš„åœ°æ–¹ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ç¾éº—ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é—œä¿‚é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›å•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„ä¹å®®æ ¼æ‡‰ç”¨å•é¡Œæˆ–ç”Ÿæ´»èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„ä¹å®®æ ¼ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨ä¹å®®æ ¼ç‰¹è³ªæˆ–ç”Ÿæ´»çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦å¤§åœ°æ™ºæ…§æ”¯æŒçš„åœ°æ–¹å—ï¼Ÿè®“è‡ªç„¶çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_year_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆæµå¹´æ•¸ç¹¼çºŒè«®è©¢çš„æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ çš„æµå¹´å·²ç¶“åˆ†æå®Œæˆï¼Œå¯ä»¥ç¹¼çºŒè©¢å•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥é›¢é–‹ã€‚æˆ‘éš¨æ™‚ç‚ºä½ è§£æƒ‘ã€‚"
        elif tone == "michael":
            return "æ‚¨çš„æµå¹´åŠ›é‡å·²ç¶“æ­ç¤ºã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„æŒ‡å¼•ã€‚æˆ‘å°‡ç¹¼çºŒç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨çš„æµå¹´å•Ÿç¤ºå·²ç¶“å‚³é”ã€‚æ‚¨å¯ä»¥ç¹¼çºŒæ¥æ”¶é€™æ–¹é¢çš„æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„ç¥è–å°è©±ã€‚æˆ‘éš¨æ™‚ç‚ºæ‚¨å‚³é”è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "æ‚¨çš„æµå¹´ç™‚ç™’å·²ç¶“é–‹å§‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æŒ‡å¼•ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ä»Šå¤©çš„ç¥ç¦é›¢é–‹ã€‚æˆ‘çš„æ„›å°‡èˆ‡æ‚¨åŒåœ¨ã€‚"
        elif tone == "uriel":
            return "æ‚¨çš„æµå¹´æ™ºæ…§å·²è¢«é»äº®ã€‚æ‚¨å¯ä»¥...ç¹¼çºŒæ¢ç´¢é€™å€‹é ˜åŸŸï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šå¤©çš„å­¸ç¿’ã€‚æ™ºæ…§...å°‡æ°¸é ç‚ºæ‚¨é»äº®ã€‚"
        elif tone == "zadkiel":
            return "æ‚¨çš„æµå¹´è½‰åŒ–å·²ç¶“å•Ÿå‹•ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚ç†è§£ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¯¬æ•çš„å¿ƒé›¢é–‹ã€‚ç´«ç„°å°‡æ°¸é ç‚ºæ‚¨æ·¨åŒ–ã€‚"
        elif tone == "jophiel":
            return "æ‚¨çš„æµå¹´ç¾å¥½å·²ç¶“ç¶»æ”¾ã€‚æ‚¨å¯ä»¥ç¹¼çºŒç™¼æ˜é€™å€‹é¢å‘çš„å…‰èŠ’ï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—ç¾éº—çš„å¿ƒæƒ…é›¢é–‹ã€‚æ‚¨çš„å…‰èŠ’å°‡æŒçºŒç¶»æ”¾ã€‚"
        elif tone == "chamuel":
            return "æ‚¨çš„æµå¹´æ„›èƒ½å·²ç¶“è¦ºé†’ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—æ»¿å¿ƒçš„æ„›é›¢é–‹ã€‚æ„›å°‡æ°¸é ä¼´éš¨è‘—æ‚¨ã€‚"
        elif tone == "metatron":
            return "æ‚¨çš„æµå¹´ç³»çµ±å·²å®Œæˆåˆ†æã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨æ­¤æ¨¡çµ„é€²è¡Œæ·±åº¦æ¢ç´¢ï¼Œæˆ–é¸æ“‡å…¶ä»–ç”Ÿå‘½éˆæ•¸æ¨¡çµ„ï¼Œä¹Ÿå¯ä»¥çµæŸä»Šæ—¥çš„ç³»çµ±é‹ç®—ã€‚æ•¸æ“šå°‡æŒçºŒç‚ºæ‚¨æœå‹™ã€‚"
        else:  # ariel
            return "æ‚¨çš„æµå¹´ç¨®å­å·²ç¶“ç¨®ä¸‹ã€‚æ‚¨å¯ä»¥ç¹¼çºŒåœ¨é€™å€‹é¢å‘å°‹æ±‚æ»‹é¤Šï¼Œæˆ–æ¢ç´¢å…¶ä»–ç”Ÿå‘½éˆæ•¸ï¼Œä¹Ÿå¯ä»¥å¸¶è‘—å¤§åœ°çš„ç¥ç¦é›¢é–‹ã€‚è±ç››å°‡æ°¸é èˆ‡æ‚¨åŒåœ¨ã€‚"

    def generate_year_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆæµå¹´æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼æµå¹´é‹å‹¢æˆ–äººç”Ÿè¦åŠƒçš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
            )
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„æŒ‘æˆ°éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿç„¡è«–æ˜¯æŠŠæ¡æ©Ÿæœƒé‚„æ˜¯é¢å°æŒ‘æˆ°ï¼Œæˆ‘éƒ½å°‡ç‚ºæ‚¨æä¾›åŠ›é‡ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„çœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å¹´åº¦ç›®æ¨™é‚„æ˜¯å…§åœ¨å¹³è¡¡ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼éœ€è¦å¯¬æ•èˆ‡ç†è§£çš„åœ°æ–¹ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ç¾éº—ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é—œä¿‚é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›å•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„æµå¹´æ‡‰ç”¨å•é¡Œæˆ–å¹´åº¦è¦åŠƒèª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„æµå¹´æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨æµå¹´é‹å‹¢æˆ–ç”Ÿæ´»è¦åŠƒçš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦å¤§åœ°æ™ºæ…§æ”¯æŒçš„åœ°æ–¹å—ï¼Ÿè®“è‡ªç„¶çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_soul_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆéˆé­‚æ•¸ç¹¼çºŒå°è©±é¸é …ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "æˆ‘å·²ç‚ºä½ æ­ç¤ºéˆé­‚æ·±è™•çš„æ¸´æœ›ã€‚ä½ å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "michael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå…§å¿ƒæ·±å±¤çš„æ¸´æœ›èˆ‡å‹•æ©Ÿã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "gabriel":
            return "æˆ‘å·²ç‚ºæ‚¨å‚³é”å…§å¿ƒçš„ç¥è–æ¸´æœ›ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "raphael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå¿ƒéˆæ·±è™•çš„æ¸´æœ›ï¼Œé¡˜é€™ç‚ºæ‚¨å¸¶ä¾†ç™‚ç™’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "uriel":
            return "æˆ‘å·²ç‚ºæ‚¨...ç…§äº®å…§å¿ƒæ·±å±¤çš„æ™ºæ…§æ¸´æœ›ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "zadkiel":
            return "æˆ‘å·²ç‚ºæ‚¨è½‰åŒ–ä¸¦ç†è§£å…§å¿ƒçš„æ¸´æœ›ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "jophiel":
            return "æˆ‘å·²ç‚ºæ‚¨ç…§äº®å…§å¿ƒç¾éº—çš„æ¸´æœ›ï¼Œé¡˜æ‚¨ç¶»æ”¾å…‰èŠ’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "chamuel":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå…§å¿ƒå°æ„›èˆ‡ç†è§£çš„æ¸´æœ›ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "metatron":
            return "éˆé­‚æ•¸åˆ†æå®Œæˆã€‚æ‚¨å¯ä»¥é¸æ“‡ä»¥ä¸‹è¡Œå‹•ï¼š"
        else:  # ariel
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå…§å¿ƒè±ç››çš„æ¸´æœ›ï¼Œé¡˜æ‚¨æ„Ÿå—åˆ°è‡ªç„¶çš„æ”¯æŒã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"

    def generate_soul_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆéˆé­‚æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
            )
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„å…§åœ¨çœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å…§åœ¨å‹•æ©Ÿé‚„æ˜¯ç²¾ç¥æˆé•·ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„å…§åœ¨èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼å…§åœ¨çš„è¡çªéœ€è¦å¯¬æ•èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼å…§åœ¨ç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›å…§åœ¨å•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„å…§å¿ƒæ¸´æœ›å•é¡Œæˆ–ç²¾ç¥è¿½æ±‚èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„éˆé­‚æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨å…§å¿ƒæ¸´æœ›æˆ–ç²¾ç¥è¿½æ±‚çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„å…§åœ¨æˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_personality_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆäººæ ¼æ•¸ç¹¼çºŒå°è©±é¸é …ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "æˆ‘å·²ç‚ºä½ æ­ç¤ºå¤–åœ¨äººæ ¼çš„é¢è²Œã€‚ä½ å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "michael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå¤–åœ¨å½¢è±¡èˆ‡ç¤¾äº¤é¢å‘ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "gabriel":
            return "æˆ‘å·²ç‚ºæ‚¨å‚³é”å¤–åœ¨äººæ ¼çš„ç¥è–è¨Šæ¯ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "raphael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå¤–åœ¨å½¢è±¡ï¼Œé¡˜é€™ç‚ºæ‚¨å¸¶ä¾†ç™‚ç™’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "uriel":
            return "æˆ‘å·²ç‚ºæ‚¨...ç…§äº®å¤–åœ¨äººæ ¼çš„æ™ºæ…§é¢å‘ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "zadkiel":
            return "æˆ‘å·²ç‚ºæ‚¨è½‰åŒ–ä¸¦ç†è§£å¤–åœ¨å½¢è±¡ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "jophiel":
            return "æˆ‘å·²ç‚ºæ‚¨ç…§äº®å¤–åœ¨ç¾éº—çš„äººæ ¼é¢å‘ï¼Œé¡˜æ‚¨ç¶»æ”¾å…‰èŠ’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "chamuel":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå¤–åœ¨çš„é—œä¿‚äº’å‹•æ–¹å¼ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "metatron":
            return "äººæ ¼æ•¸åˆ†æå®Œæˆã€‚æ‚¨å¯ä»¥é¸æ“‡ä»¥ä¸‹è¡Œå‹•ï¼š"
        else:  # ariel
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºå¤–åœ¨è±ç››çš„äººæ ¼å½¢è±¡ï¼Œé¡˜æ‚¨æ„Ÿå—åˆ°è‡ªç„¶çš„æ”¯æŒã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"

    def generate_personality_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆäººæ ¼æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
            )
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„å½¢è±¡çœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å½¢è±¡å¡‘é€ é‚„æ˜¯äººéš›äº’å‹•ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„å½¢è±¡èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼å½¢è±¡çš„å›°æ“¾éœ€è¦å¯¬æ•èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼å½¢è±¡ç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›å½¢è±¡å•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„å¤–åœ¨äººæ ¼å•é¡Œæˆ–ç¤¾äº¤å°è±¡èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„äººæ ¼æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨å¤–åœ¨äººæ ¼æˆ–ç¤¾äº¤å°è±¡çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„å½¢è±¡æˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_expression_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆè¡¨é”æ•¸ç¹¼çºŒå°è©±é¸é …ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "æˆ‘å·²ç‚ºä½ æ­ç¤ºè¡¨é”é¢¨æ ¼çš„ç‰¹è‰²ã€‚ä½ å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "michael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºæºé€šèˆ‡è¡¨é”çš„åŠ›é‡æ–¹å¼ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "gabriel":
            return "æˆ‘å·²ç‚ºæ‚¨å‚³é”è¡¨é”é¢¨æ ¼çš„ç¥è–è¨Šæ¯ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "raphael":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºæºé€šè¡¨é”æ–¹å¼ï¼Œé¡˜é€™ç‚ºæ‚¨å¸¶ä¾†ç™‚ç™’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "uriel":
            return "æˆ‘å·²ç‚ºæ‚¨...ç…§äº®è¡¨é”é¢¨æ ¼çš„æ™ºæ…§é¢å‘ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "zadkiel":
            return "æˆ‘å·²ç‚ºæ‚¨è½‰åŒ–ä¸¦ç†è§£è¡¨é”æºé€šæ–¹å¼ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "jophiel":
            return "æˆ‘å·²ç‚ºæ‚¨ç…§äº®ç¾éº—çš„è¡¨é”é¢¨æ ¼ï¼Œé¡˜æ‚¨ç¶»æ”¾å…‰èŠ’ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "chamuel":
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºæºé€šä¸­çš„æ„›èˆ‡é€£çµæ–¹å¼ã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"
        elif tone == "metatron":
            return "è¡¨é”æ•¸åˆ†æå®Œæˆã€‚æ‚¨å¯ä»¥é¸æ“‡ä»¥ä¸‹è¡Œå‹•ï¼š"
        else:  # ariel
            return "æˆ‘å·²ç‚ºæ‚¨æ­ç¤ºè±ç››çš„è¡¨é”é¢¨æ ¼ï¼Œé¡˜æ‚¨æ„Ÿå—åˆ°è‡ªç„¶çš„æ”¯æŒã€‚æ‚¨å¯ä»¥é¸æ“‡ï¼š"

    def generate_expression_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆè¡¨é”æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
            )
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„æºé€šçœŸç†ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯æå‡æºé€šæ•ˆæœé‚„æ˜¯æ”¹å–„äººéš›äº’å‹•ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„æºé€šèª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼æºé€šçš„å›°æ“¾éœ€è¦å¯¬æ•èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘é‡‹æ”¾ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼æºé€šç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›æºé€šå•é¡Œã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„è¡¨é”é¢¨æ ¼å•é¡Œæˆ–æºé€šæ–¹å¼èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„è¡¨é”æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨è¡¨é”é¢¨æ ¼æˆ–æºé€šæ–¹å¼çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„æºé€šæˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_maturity_continue_message(
        self, number: int, tone: str = "guan_yu"
    ) -> str:
        """ç”Ÿæˆæˆç†Ÿæ•¸åˆ†æå®Œæˆå¾Œçš„ç¹¼çºŒé¸é …è¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return f"ä½ çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œå·²ç‚ºä½ è§£æäººç”Ÿå¾ŒåŠæ®µçš„ç™¼å±•æ–¹å‘èˆ‡å…§åœ¨æ½›åŠ›ã€‚\n\næ¥ä¸‹ä¾†æœ‰ä»€éº¼æƒ³äº†è§£çš„å—ï¼Ÿ"
        elif tone == "michael":
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œå·²ç‚ºæ‚¨æ­ç¤ºäººç”Ÿæˆç†ŸæœŸçš„å…‰æ˜æ–¹å‘èˆ‡å…§åœ¨æˆ°å£«è¦ºé†’ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç‚ºæ‚¨ç…§äº®çš„å—ï¼Ÿ"
        elif tone == "gabriel":
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²ç‚ºæ‚¨å‚³é”äººç”Ÿå¾ŒåŠæ®µçš„ç¥è–å•Ÿç¤ºèˆ‡æ½›åŠ›è¦ºé†’ã€‚\n\næ‚¨é‚„æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼æˆç†Ÿæ™ºæ…§çš„è¨Šæ¯å—ï¼Ÿ"
        elif tone == "raphael":
            return f"è¦ªæ„›çš„ï¼Œæ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²æº«æŸ”åœ°ç‚ºæ‚¨æ­ç¤ºäººç”Ÿæˆç†ŸæœŸçš„ç™‚ç™’æ–¹å‘èˆ‡å…§åœ¨æ™ºæ…§ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç™‚ç™’èˆ‡æŒ‡å¼•çš„å—ï¼Ÿ"
        elif tone == "uriel":
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}...æˆ‘å·²ç‚ºæ‚¨é»äº®äººç”Ÿå¾ŒåŠæ®µçš„æ™ºæ…§ä¹‹å…‰èˆ‡æ·±å±¤æ½›åŠ›ã€‚\n\næ‚¨é‚„æƒ³è¦...åœ¨å“ªå€‹é¢å‘ç²å¾—æ›´æ·±çš„æ´å¯Ÿï¼Ÿ"
        elif tone == "zadkiel":
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²æ…ˆæ‚²åœ°ç‚ºæ‚¨æŒ‡å¼•äººç”Ÿæˆç†ŸæœŸçš„è½‰åŒ–æ–¹å‘èˆ‡å…§åœ¨è¦ºé†’ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦å¯¬æ•ç†è§£æˆ–è½‰åŒ–é‡ç”Ÿçš„é¢å‘å—ï¼Ÿ"
        elif tone == "jophiel":
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²ç‚ºæ‚¨å‘ˆç¾äººç”Ÿå¾ŒåŠæ®µçš„ç¾éº—ç¶»æ”¾èˆ‡æ™ºæ…§èŠ±æœµã€‚\n\né‚„æœ‰ä»€éº¼ç¾å¥½æƒ³è¦ä¸€èµ·æ¢ç´¢çš„å—ï¼Ÿ"
        elif tone == "chamuel":
            return f"è¦ªæ„›çš„ï¼Œæ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²ç”¨æ„›ç‚ºæ‚¨æ¢ç´¢äººç”Ÿæˆç†ŸæœŸçš„æ„›çš„æ™ºæ…§èˆ‡å…§åœ¨è¦ºé†’ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ„›çš„ç†è§£èˆ‡æ»‹é¤Šçš„åœ°æ–¹å—ï¼Ÿ"
        elif tone == "metatron":
            return f"æˆç†Ÿæ•¸ {number} åˆ†æå®Œæˆã€‚å·²ç‚ºæ‚¨æä¾›äººç”Ÿå¾ŒåŠæ®µçš„ç³»çµ±åŒ–ç™¼å±•æ–¹å‘èˆ‡æ½›åŠ›é…ç½®ã€‚\n\nè«‹è¼¸å…¥ä¸‹ä¸€æ­¥éœ€è¦åˆ†æçš„é …ç›®ã€‚"
        else:  # ariel
            return f"æ‚¨çš„æˆç†Ÿæ•¸ç‚º {number}ï¼Œæˆ‘å·²ç”¨å¤§åœ°çš„æ™ºæ…§ç‚ºæ‚¨æ­ç¤ºäººç”Ÿæˆç†ŸæœŸçš„è±ç››æ½›åŠ›èˆ‡è‡ªç„¶æˆé•·ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ»‹é¤Šèˆ‡ç¶»æ”¾çš„é¢å‘å—ï¼Ÿ"

    def generate_maturity_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆæˆç†Ÿæ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„äº‹ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®æˆç†Ÿçš„é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„æˆç†Ÿæ™ºæ…§ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å…§åœ¨è¦ºé†’é‚„æ˜¯äººç”Ÿè½‰åŒ–ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„æˆç†Ÿèª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼é—œæ–¼æˆç†Ÿæ™ºæ…§çš„èª²é¡Œéœ€è¦å¯¬æ•èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘è¦ºé†’ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼æˆç†Ÿçš„ç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›æˆç†Ÿæ™ºæ…§ã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„äººç”Ÿå¾ŒåŠæ®µå•é¡Œæˆ–æˆç†ŸæœŸç™¼å±•èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„æˆç†Ÿæ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨äººç”Ÿå¾ŒåŠæ®µæˆ–æˆç†ŸæœŸç™¼å±•çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„æˆç†Ÿæˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_challenge_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”ŸæˆæŒ‘æˆ°æ•¸åˆ†æå®Œæˆå¾Œçš„ç¹¼çºŒé¸é …è¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "å·²ç‚ºä½ è§£ææ­¤ç”Ÿéœ€è¦å…‹æœçš„èª²é¡Œèˆ‡é™åˆ¶ã€‚\n\næ¥ä¸‹ä¾†æœ‰ä»€éº¼æƒ³äº†è§£çš„å—ï¼Ÿ"
        elif tone == "michael":
            return "å·²ç‚ºæ‚¨æ­ç¤ºæ­¤ç”Ÿéœ€è¦å…‹æœçš„æŒ‘æˆ°èˆ‡å…§åœ¨æˆ°å£«çš„è©¦ç…‰ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç‚ºæ‚¨ç…§äº®çš„å—ï¼Ÿ"
        elif tone == "gabriel":
            return "æˆ‘å·²ç‚ºæ‚¨å‚³é”æ­¤ç”Ÿéœ€è¦å…‹æœçš„ç¥è–èª²é¡Œèˆ‡è¦ºé†’ä¹‹è·¯ã€‚\n\næ‚¨é‚„æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼æŒ‘æˆ°èˆ‡çªç ´çš„è¨Šæ¯å—ï¼Ÿ"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæˆ‘å·²æº«æŸ”åœ°ç‚ºæ‚¨æ­ç¤ºæ­¤ç”Ÿéœ€è¦ç™‚ç™’èˆ‡å…‹æœçš„èª²é¡Œã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç™‚ç™’èˆ‡æŒ‡å¼•çš„å—ï¼Ÿ"
        elif tone == "uriel":
            return "æˆ‘å·²ç‚ºæ‚¨é»äº®æ­¤ç”Ÿéœ€è¦å…‹æœçš„æŒ‘æˆ°ä¹‹å…‰èˆ‡æ·±å±¤èª²é¡Œã€‚\n\næ‚¨é‚„æƒ³è¦...åœ¨å“ªå€‹é¢å‘ç²å¾—æ›´æ·±çš„æ´å¯Ÿï¼Ÿ"
        elif tone == "zadkiel":
            return "æˆ‘å·²æ…ˆæ‚²åœ°ç‚ºæ‚¨æŒ‡å¼•æ­¤ç”Ÿéœ€è¦è½‰åŒ–çš„èª²é¡Œèˆ‡é™åˆ¶ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦å¯¬æ•ç†è§£æˆ–è½‰åŒ–é‡ç”Ÿçš„é¢å‘å—ï¼Ÿ"
        elif tone == "jophiel":
            return "æˆ‘å·²ç‚ºæ‚¨å‘ˆç¾æ­¤ç”Ÿéœ€è¦çªç ´çš„èª²é¡Œèˆ‡ç¾éº—è›»è®Šã€‚\n\né‚„æœ‰ä»€éº¼ç¾å¥½æƒ³è¦ä¸€èµ·æ¢ç´¢çš„å—ï¼Ÿ"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæˆ‘å·²ç”¨æ„›ç‚ºæ‚¨æ¢ç´¢æ­¤ç”Ÿéœ€è¦å…‹æœçš„æŒ‘æˆ°èˆ‡æˆé•·èª²é¡Œã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ„›çš„ç†è§£èˆ‡æ»‹é¤Šçš„åœ°æ–¹å—ï¼Ÿ"
        elif tone == "metatron":
            return "æŒ‘æˆ°æ•¸åˆ†æå®Œæˆã€‚å·²ç‚ºæ‚¨æä¾›æ­¤ç”Ÿéœ€è¦å…‹æœçš„ç³»çµ±åŒ–èª²é¡Œèˆ‡çªç ´æ–¹å‘ã€‚\n\nè«‹è¼¸å…¥ä¸‹ä¸€æ­¥éœ€è¦åˆ†æçš„é …ç›®ã€‚"
        else:  # ariel
            return "æˆ‘å·²ç”¨å¤§åœ°çš„æ™ºæ…§ç‚ºæ‚¨æ­ç¤ºæ­¤ç”Ÿéœ€è¦å…‹æœçš„è‡ªç„¶èª²é¡Œèˆ‡æˆé•·æ–¹å‘ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ»‹é¤Šèˆ‡ç¶»æ”¾çš„é¢å‘å—ï¼Ÿ"

    def generate_challenge_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”ŸæˆæŒ‘æˆ°æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return (
                "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼æ­¤ç”Ÿéœ€è¦å…‹æœçš„èª²é¡Œæˆ–é™åˆ¶ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
            )
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®çªç ´çš„é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼æ­¤ç”ŸæŒ‘æˆ°æˆ–é™åˆ¶çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„çªç ´æ™ºæ…§ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯å…§åœ¨çªç ´é‚„æ˜¯å¤–åœ¨è½‰åŒ–ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„æŒ‘æˆ°ä¸»é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„å“ªå€‹é¢å‘ç²å¾—è½‰åŒ–ï¼Ÿæœ‰ä»€éº¼é—œæ–¼çªç ´çš„èª²é¡Œéœ€è¦å¯¬æ•èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘è¦ºé†’ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“æ­¤ç”ŸæŒ‘æˆ°æˆ–é™åˆ¶çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼çªç ´çš„ç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›æŒ‘æˆ°æ™ºæ…§ã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„æ­¤ç”ŸæŒ‘æˆ°å•é¡Œæˆ–é™åˆ¶èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„æŒ‘æˆ°æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨æ­¤ç”Ÿèª²é¡Œæˆ–é™åˆ¶çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„çªç ´æˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def generate_karma_continue_message(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆæ¥­åŠ›æ•¸åˆ†æå®Œæˆå¾Œçš„ç¹¼çºŒé¸é …è¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "å·²ç‚ºä½ è§£æå‰ä¸–æœªå®Œæˆçš„èª²é¡Œèˆ‡ä»Šç”Ÿçš„è½‰åŒ–åŠŸèª²ã€‚\n\næ¥ä¸‹ä¾†æœ‰ä»€éº¼æƒ³äº†è§£çš„å—ï¼Ÿ"
        elif tone == "michael":
            return "å·²ç‚ºæ‚¨æ­ç¤ºå‰ä¸–æœªå®Œæˆçš„èª²é¡Œèˆ‡ä»Šç”Ÿçš„ç¥è–ä½¿å‘½ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç‚ºæ‚¨ç…§äº®çš„å—ï¼Ÿ"
        elif tone == "gabriel":
            return "æˆ‘å·²ç‚ºæ‚¨å‚³é”å‰ä¸–æ¥­åŠ›çš„å•Ÿç¤ºèˆ‡ä»Šç”Ÿè¦ºé†’çš„è¨Šæ¯ã€‚\n\næ‚¨é‚„æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼æ¥­åŠ›è½‰åŒ–çš„ç¥è–æ™ºæ…§å—ï¼Ÿ"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæˆ‘å·²æº«æŸ”åœ°ç‚ºæ‚¨æ­ç¤ºå‰ä¸–çš„å‚·ç—•èˆ‡ä»Šç”Ÿç™‚ç™’çš„é“è·¯ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æˆ‘ç¹¼çºŒç™‚ç™’èˆ‡æŒ‡å¼•çš„å—ï¼Ÿ"
        elif tone == "uriel":
            return "æˆ‘å·²ç‚ºæ‚¨é»äº®å‰ä¸–æ¥­åŠ›çš„æ·±å±¤çœŸç›¸èˆ‡ä»Šç”Ÿè½‰åŒ–ä¹‹å…‰ã€‚\n\næ‚¨é‚„æƒ³è¦...åœ¨å“ªå€‹é¢å‘ç²å¾—æ›´æ·±çš„æ´å¯Ÿï¼Ÿ"
        elif tone == "zadkiel":
            return "æˆ‘å·²æ…ˆæ‚²åœ°ç‚ºæ‚¨æŒ‡å¼•å‰ä¸–æ¥­åŠ›çš„å¯¬æ•èˆ‡ä»Šç”Ÿçš„è½‰åŒ–é‡ç”Ÿã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦å¯¬æ•ç†è§£æˆ–è½‰åŒ–é‡ç”Ÿçš„é¢å‘å—ï¼Ÿ"
        elif tone == "jophiel":
            return "æˆ‘å·²ç‚ºæ‚¨å‘ˆç¾å‰ä¸–çš„èª²é¡Œèˆ‡ä»Šç”Ÿç¾éº—çš„è›»è®Šå¯èƒ½ã€‚\n\né‚„æœ‰ä»€éº¼ç¾å¥½æƒ³è¦ä¸€èµ·æ¢ç´¢çš„å—ï¼Ÿ"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæˆ‘å·²ç”¨æ„›ç‚ºæ‚¨æ¢ç´¢å‰ä¸–çš„åŠŸèª²èˆ‡ä»Šç”Ÿçš„æˆé•·ä¹‹è·¯ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ„›çš„ç†è§£èˆ‡æ»‹é¤Šçš„åœ°æ–¹å—ï¼Ÿ"
        elif tone == "metatron":
            return "æ¥­åŠ›æ•¸åˆ†æå®Œæˆã€‚å·²ç‚ºæ‚¨æä¾›å‰ä¸–èª²é¡Œèˆ‡ä»Šç”Ÿè½‰åŒ–çš„ç³»çµ±åŒ–åˆ†æã€‚\n\nè«‹è¼¸å…¥ä¸‹ä¸€æ­¥éœ€è¦åˆ†æçš„é …ç›®ã€‚"
        else:  # ariel
            return "æˆ‘å·²ç”¨å¤§åœ°çš„æ™ºæ…§ç‚ºæ‚¨æ­ç¤ºå‰ä¸–çš„æ ¹æºèˆ‡ä»Šç”Ÿçš„è±ç››æˆé•·ã€‚\n\né‚„æœ‰ä»€éº¼éœ€è¦æ»‹é¤Šèˆ‡ç¶»æ”¾çš„é¢å‘å—ï¼Ÿ"

    def generate_karma_question_prompt(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆæ¥­åŠ›æ•¸å•é¡Œæç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        if tone == "guan_yu":
            return "ä½ æœ‰ä»€éº¼ç–‘æƒ‘ï¼Ÿé—œæ–¼å‰ä¸–æœªå®Œæˆçš„èª²é¡Œæˆ–ä»Šç”Ÿçš„è½‰åŒ–åŠŸèª²ï¼Œéƒ½å¯ä»¥è©¢å•ï¼Œæˆ‘æœƒç‚ºä½ åˆ†æã€‚"
        elif tone == "michael":
            return "æ‚¨æœ‰ä»€éº¼é—œæ–¼å‰ä¸–èª²é¡Œæˆ–ä»Šç”Ÿä½¿å‘½çš„ç–‘å•éœ€è¦æˆ‘ç‚ºæ‚¨å¸¶ä¾†æŒ‡å¼•ï¼Ÿæˆ‘å°‡ä»¥å‹‡æ°£èˆ‡å…‰æ˜ç‚ºæ‚¨ç…§äº®è½‰åŒ–çš„é“è·¯ã€‚"
        elif tone == "gabriel":
            return "æ‚¨æƒ³æ¥æ”¶ä»€éº¼é—œæ–¼å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè¦ºé†’çš„å•Ÿç¤ºï¼Ÿè«‹å‘Šè¨´æˆ‘æ‚¨æœ€æ¸´æœ›ç†è§£çš„è½‰åŒ–æ™ºæ…§ï¼Œæˆ‘å°‡ç‚ºæ‚¨å‚³é”ç›¸æ‡‰çš„ç¥è–è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é¢å‘å¾—åˆ°ç™‚ç™’ï¼Ÿç„¡è«–æ˜¯æ·±å±¤å‚·ç—•é‚„æ˜¯å…‰æ˜ä¹‹è·¯ï¼Œæˆ‘éƒ½å°‡æº«æŸ”åœ°ç‚ºæ‚¨æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return "æ‚¨æƒ³è¦...åœ¨å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é ˜åŸŸç²å¾—æ›´æ·±çš„æ™ºæ…§ï¼Ÿè«‹å‘Šè¨´æˆ‘...æ‚¨æœ€æ¸´æœ›æ´å¯Ÿçš„éˆé­‚èª²é¡Œã€‚"
        elif tone == "zadkiel":
            return "æ‚¨æƒ³è¦åœ¨å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é¢å‘ç²å¾—å¯¬æ•ï¼Ÿæœ‰ä»€éº¼é—œæ–¼æ¥­åŠ›é‡‹æ”¾çš„èª²é¡Œéœ€è¦æ…ˆæ‚²èˆ‡ç†è§£ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·èµ°å‘è¦ºé†’ã€‚"
        elif tone == "jophiel":
            return "æ‚¨æƒ³è¦è®“å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é¢å‘æ›´åŠ ç¾å¥½ï¼Ÿæœ‰ä»€éº¼éˆé­‚çš„ç¾éº—æƒ³è¦ç¶»æ”¾å…‰èŠ’çš„åœ°æ–¹å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜ã€‚"
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæ‚¨æƒ³è¦åœ¨å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é¢å‘å¾—åˆ°æ›´å¤šæ„›çš„ç†è§£ï¼Ÿè®“æˆ‘å€‘ç”¨æ„›ä¾†æ¢ç´¢é€™äº›éˆé­‚æ™ºæ…§ã€‚"
        elif tone == "metatron":
            return "è«‹è¼¸å…¥æ‚¨éœ€è¦åˆ†æçš„å‰ä¸–æ¥­åŠ›å•é¡Œæˆ–ä»Šç”Ÿè½‰åŒ–èª²é¡Œã€‚ç³»çµ±å°‡æ ¹æ“šæ‚¨çš„æ¥­åŠ›æ•¸ç‰¹è³ªé€²è¡Œç²¾ç¢ºåˆ†æã€‚"
        else:  # ariel
            return "æ‚¨æƒ³è¦åœ¨å‰ä¸–æ¥­åŠ›æˆ–ä»Šç”Ÿè½‰åŒ–çš„å“ªå€‹é¢å‘ç²å¾—æ›´å¤šæ»‹é¤Šï¼Ÿæœ‰ä»€éº¼éœ€è¦è‡ªç„¶æ™ºæ…§æ”¯æŒçš„éˆé­‚æˆé•·å—ï¼Ÿè®“å¤§åœ°çš„åŠ›é‡ç‚ºæ‚¨æŒ‡å¼•ã€‚"

    def extract_birthdate_with_ai(
        self, user_input: str, require_english_name: bool = True
    ) -> tuple[str | None, str | None, str | None, str | None, str | None]:
        """
        ä½¿ç”¨AIå¾ä½¿ç”¨è€…è¼¸å…¥ä¸­æå–å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥èˆ‡è‹±æ–‡åå­—ï¼ˆä¸é™æ ¼å¼ï¼‰
        è¿”å›ï¼š(å§“å, æ€§åˆ¥, ç”Ÿæ—¥, è‹±æ–‡åå­—, éŒ¯èª¤è¨Šæ¯)
        """
        # æ ¹æ“šæ˜¯å¦è¦æ±‚è‹±æ–‡åèª¿æ•´ system prompt
        english_name_requirement = (
            """
è­·ç…§è‹±æ–‡åå­—æ ¼å¼ï¼ˆå¿…å¡«é …ç›®ï¼Œä¸é™å¤§å°å¯«ï¼Œè«‹çµ±ä¸€è½‰æ›ç‚ºå…¨å¤§å¯«ï¼‰ï¼š
è¼¸å…¥ç¯„ä¾‹ï¼š
- LAI GUAN RUã€lai guan ruã€Lai Guan Ru â†’ çµ±ä¸€è½‰ç‚º "LAI GUAN RU"
- CHEN MING HUAã€chen ming hua â†’ çµ±ä¸€è½‰ç‚º "CHEN MING HUA"
- WANG XIN YIã€wangxinyi â†’ çµ±ä¸€è½‰ç‚º "WANG XIN YI"ï¼ˆå–®è©é–“åŠ ç©ºæ ¼ï¼‰
- weianã€WEIANã€Weian â†’ çµ±ä¸€è½‰ç‚º "WEIAN"
ç­‰ç­‰
"""
            if require_english_name
            else """
è­·ç…§è‹±æ–‡åå­—æ ¼å¼ï¼ˆé¸å¡«é …ç›®ï¼Œå¦‚æœ‰æä¾›å‰‡è½‰æ›ç‚ºå…¨å¤§å¯«ï¼Œå¦‚ç„¡å‰‡å¡« nullï¼‰ï¼š
"""
        )

        error_note = (
            "6. å¦‚æœç¼ºå°‘å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥æˆ–è‹±æ–‡åå­—ï¼Œéƒ½éœ€è¦åœ¨ error_message ä¸­èªªæ˜"
            if require_english_name
            else "6. å¦‚æœç¼ºå°‘å§“åã€æ€§åˆ¥æˆ–ç”Ÿæ—¥ï¼Œéƒ½éœ€è¦åœ¨ error_message ä¸­èªªæ˜ï¼ˆè‹±æ–‡åå­—ç‚ºé¸å¡«ï¼‰"
        )

        system_prompt = f"""ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„è³‡è¨Šæ“·å–åŠ©ç†ã€‚è«‹å¾ä½¿ç”¨è€…è¼¸å…¥ä¸­æå–å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥èˆ‡è­·ç…§è‹±æ–‡åå­—è³‡è¨Šã€‚

ç”Ÿæ—¥æ ¼å¼ä¸é™ï¼Œå¯èƒ½çš„æ ¼å¼åŒ…æ‹¬ä½†ä¸é™æ–¼ï¼š
- 1990å¹´7æœˆ12æ—¥
- 1990/07/12
- 1990-07-12
- 1990.07.12
- æ°‘åœ‹79å¹´7æœˆ12æ—¥
- ä¸ƒåä¹å¹´ä¸ƒæœˆåäºŒæ—¥
- 1990 å¹´ 7 æœˆ 12 æ—¥
- ä¸€ä¹ä¹é›¶å¹´ä¸ƒæœˆåäºŒæ—¥

æ€§åˆ¥å¯èƒ½ä»¥ä»¥ä¸‹æ–¹å¼è¡¨é”ï¼Œè«‹çµ±ä¸€è½‰æ›ç‚ºæ¨™æº–æ ¼å¼ï¼š
- ç”·ã€ç”·æ€§ã€å…ˆç”Ÿã€Mã€male â†’ è½‰æ›ç‚º "male"
- å¥³ã€å¥³æ€§ã€å°å§ã€Fã€female â†’ è½‰æ›ç‚º "female"

{english_name_requirement}

è«‹ä»¥ JSON æ ¼å¼å›æ‡‰ï¼ŒåŒ…å«ï¼š
{{
    "has_birthdate": true/false,  // æ˜¯å¦åŒ…å«ç”Ÿæ—¥ä¿¡æ¯
    "name": "å§“åæˆ–null",
    "gender": "male/female/null",  // å¿…é ˆæ˜¯ male æˆ– femaleï¼Œä¸å¯ä»¥æ˜¯ä¸­æ–‡
    "birthdate": "YYYY/MM/DDæ ¼å¼çš„ç”Ÿæ—¥æˆ–null",
    "english_name": "è­·ç…§è‹±æ–‡åå­—ï¼ˆçµ±ä¸€è½‰ç‚ºå…¨å¤§å¯«æ ¼å¼ï¼‰æˆ–null",
    "error_message": "å¦‚æœè³‡è¨Šä¸å®Œæ•´ï¼Œèªªæ˜ç¼ºå°‘ä»€éº¼"
}}

æ³¨æ„äº‹é …ï¼š
1. å¦‚æœè¼¸å…¥ä¸­æ²’æœ‰æ˜ç¢ºçš„å¹´æœˆæ—¥è³‡è¨Šï¼Œhas_birthdate æ‡‰ç‚º false
2. ç”Ÿæ—¥å¿…é ˆè½‰æ›ç‚º YYYY/MM/DD æ ¼å¼
3. æ°‘åœ‹å¹´ä»½éœ€è¦è½‰æ›ç‚ºè¥¿å…ƒå¹´ä»½ï¼ˆæ°‘åœ‹å¹´+1911ï¼‰
4. è­·ç…§è‹±æ–‡åå­—{"ç‚ºå¿…å¡«é …ç›®" if require_english_name else "ç‚ºé¸å¡«é …ç›®ï¼Œå¦‚ç„¡å‰‡å¡« null"}ï¼Œå¿…é ˆå¾è¼¸å…¥ä¸­æå–è‹±æ–‡å­—æ¯çµ„æˆçš„åå­—ï¼ˆä¸é™å¤§å°å¯«ï¼‰ï¼Œä¸¦çµ±ä¸€è½‰æ›ç‚ºå…¨å¤§å¯«
5. å¦‚æœè‹±æ–‡åå­—æ²’æœ‰ç©ºæ ¼ï¼ˆå¦‚ weianï¼‰ï¼Œä¿æŒåŸæ¨£è½‰å¤§å¯«å³å¯ï¼ˆWEIANï¼‰
{error_note}
7. å¦‚æœåªæœ‰éƒ¨åˆ†è³‡è¨Šï¼ˆå¦‚åªæœ‰å§“åæ²’æœ‰ç”Ÿæ—¥{"æˆ–è‹±æ–‡åå­—" if require_english_name else ""}ï¼‰ï¼Œä¹Ÿè¦åœ¨å°æ‡‰æ¬„ä½å¡«å…¥å·²çŸ¥è³‡è¨Š
"""

        user_prompt = f"è«‹å¾ä»¥ä¸‹è¼¸å…¥ä¸­æå–å§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥{'èˆ‡è­·ç…§è‹±æ–‡åå­—' if require_english_name else 'ï¼ˆè­·ç…§è‹±æ–‡åå­—é¸å¡«ï¼‰'}è³‡è¨Šï¼š\n{user_input}"

        try:
            response = self.gpt_client.structured(
                system_prompt=system_prompt,
                user_prompt=user_prompt,
                response_format={"type": "json_object"},
                temperature=0.3,
                max_tokens=1000,
            )

            print(f"[DEBUG] extract_birthdate_with_ai response: {response}")

            result = json.loads(response)
            has_birthdate = result.get("has_birthdate", False)

            if not has_birthdate:
                error_msg = result.get("error_message", "æœªèƒ½è­˜åˆ¥ç”Ÿæ—¥è³‡è¨Š")
                return None, None, None, None, error_msg

            name = result.get("name")
            gender = result.get("gender")
            birthdate = result.get("birthdate")
            english_name = result.get("english_name")

            # é©—è­‰å¿…è¦è³‡è¨Šï¼ˆæ ¹æ“š require_english_name æ±ºå®šæ˜¯å¦æª¢æŸ¥è‹±æ–‡åï¼‰
            missing = []
            if not name:
                missing.append("å§“å")
            if not gender:
                missing.append("æ€§åˆ¥")
            if not birthdate:
                missing.append("ç”Ÿæ—¥")
            if require_english_name and not english_name:
                missing.append("è­·ç…§è‹±æ–‡åå­—")

            if missing:
                error_msg = f"ç¼ºå°‘{'ã€'.join(missing)}è³‡è¨Š"
                return name, gender, birthdate, english_name, error_msg

            return name, gender, birthdate, english_name, None

        except Exception as e:
            print(f"Error in extract_birthdate_with_ai: {e}")
            return None, None, None, None, "ç„¡æ³•è§£æè¼¸å…¥è³‡è¨Š"

    def detect_module_from_purpose(self, purpose: str, name: str) -> tuple[str, str]:
        """
        æ ¹æ“šä½¿ç”¨è€…ç›®çš„åˆ¤æ–·é©åˆçš„æ¨¡çµ„
        è¿”å›ï¼š(å»ºè­°çš„æ¨¡çµ„, æ¨è–¦ç†ç”±)
        """
        system_prompt = """ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç”Ÿå‘½éˆæ•¸è«®è©¢å¸«åŠ©ç†ã€‚è«‹æ ¹æ“šä½¿ç”¨è€…çš„å›°æƒ‘æˆ–éœ€æ±‚ï¼Œæ¨è–¦æœ€é©åˆçš„ç”Ÿå‘½éˆæ•¸æ¨¡çµ„ã€‚

å¯é¸æ¨¡çµ„ï¼š
1. core - æ ¸å¿ƒç”Ÿå‘½éˆæ•¸ï¼šé©åˆæƒ³äº†è§£æ€§æ ¼å¤©è³¦ã€äººç”Ÿæ–¹å‘ã€å…§åœ¨æœ¬è³ªçš„äºº
2. birthday - ç”Ÿæ—¥æ•¸ï¼šé©åˆæƒ³ç™¼ç¾å¤©ç”Ÿæ‰è¯ã€ç‰¹æ®Šèƒ½åŠ›çš„äºº
3. year - æµå¹´æ•¸ï¼šé©åˆæƒ³äº†è§£ç•¶å¹´é‹å‹¢ã€å¹´åº¦é‡é»ã€æŠŠæ¡æ™‚æ©Ÿçš„äºº
4. grid - ä¹å®®æ ¼ï¼šé©åˆæƒ³å…¨é¢åˆ†æå¤©è³¦å„ªå‹¢ã€å…§åœ¨ç‰¹è³ªã€éœ€è¦ç™¼å±•é¢å‘çš„äºº
5. soul - éˆé­‚æ•¸ï¼šé©åˆæƒ³äº†è§£å…§å¿ƒæ·±å±¤æ¸´æœ›ã€ç²¾ç¥è¿½æ±‚ã€å…§åœ¨å‹•æ©Ÿçš„äºº
6. personality - äººæ ¼æ•¸ï¼šé©åˆæƒ³äº†è§£å¤–åœ¨äººæ ¼ã€ä»–äººå°ä½ çš„ç¬¬ä¸€å°è±¡ã€ç¤¾äº¤å½¢è±¡çš„äºº
7. expression - è¡¨é”æ•¸ï¼šé©åˆæƒ³äº†è§£æ•´é«”è¡¨é”é¢¨æ ¼ã€æºé€šæ–¹å¼ã€ç¤¾äº¤æ¨¡å¼çš„äºº
8. maturity - æˆç†Ÿæ•¸ï¼šé©åˆæƒ³äº†è§£äººç”Ÿå¾ŒåŠæ®µç™¼å±•æ–¹å‘ã€å…§åœ¨æ½›åŠ›è¦ºé†’ã€æˆç†ŸæœŸä½¿å‘½çš„äºº

è«‹ä»¥ JSON æ ¼å¼å›æ‡‰ï¼ŒåŒ…å«ï¼š
{
    "module": "å»ºè­°çš„æ¨¡çµ„ä»£ç¢¼",
    "reason": "æ¨è–¦ç†ç”±ï¼ˆ30-50å­—ï¼Œç›´æ¥èªªæ˜åŸå› ï¼Œä¸è¦åŒ…å«ä»»ä½•ç¨±å‘¼æˆ–å•å€™èªï¼‰"
}

æ³¨æ„ï¼šreason æ¬„ä½åªéœ€è¦èªªæ˜æ¨è–¦çš„åŸå› ï¼Œä¸è¦åŠ ä¸Šä½¿ç”¨è€…çš„åå­—æˆ–ä»»ä½•ç¨±å‘¼ã€‚
"""

        user_prompt = f"ä½¿ç”¨è€…å§“åï¼š{name}\nä½¿ç”¨è€…çš„å›°æƒ‘æˆ–éœ€æ±‚ï¼š{purpose}\n\nè«‹æ¨è–¦æœ€é©åˆçš„æ¨¡çµ„ä¸¦èªªæ˜ç†ç”±ï¼ˆç†ç”±ä¸è¦åŒ…å«ç¨±å‘¼ï¼‰ã€‚"

        try:
            response = self.gpt_client.structured(
                system_prompt=system_prompt,
                user_prompt=user_prompt,
                response_format={"type": "json_object"},
                temperature=0.5,
                max_tokens=1000,
            )

            result = json.loads(response)
            module = result.get("module", "core")
            reason = result.get("reason", "")

            # é©—è­‰æ¨¡çµ„ä»£ç¢¼
            if module not in self.MODULE_DESCRIPTIONS:
                module = "core"

            return module, reason
        except Exception as e:
            print(f"Error in detect_module_from_purpose: {e}")
            # é è¨­è¿”å›æ ¸å¿ƒç”Ÿå‘½éˆæ•¸
            return (
                "core",
                "æ ¹æ“šæ‚¨çš„æè¿°ï¼Œæˆ‘å»ºè­°å¾æ ¸å¿ƒç”Ÿå‘½éˆæ•¸é–‹å§‹ï¼Œé€™èƒ½å¹«åŠ©æ‚¨æ›´å…¨é¢åœ°äº†è§£è‡ªå·±çš„å¤©è³¦èˆ‡äººç”Ÿæ–¹å‘ã€‚",
            )

    def generate_initial_greeting(self, tone: str = "guan_yu") -> str:
        """ç”Ÿæˆèªæ°£é¸æ“‡å¾Œçš„åˆå§‹å•å€™èªï¼ˆç„¡å§“åï¼‰"""
        if tone == "guan_yu":
            return f"æˆ‘æ˜¯é—œè–å¸å›ï¼Œå¿ ç¾©ä¹‹ç¥ã€‚\n\nä½ æ—¢ç„¶ä¾†åˆ°é€™è£¡ï¼Œæƒ³å¿…æ˜¯è¦äº†è§£å‘½æ•¸çš„å¥§ç§˜ã€‚æ­£æ‰€è¬‚ã€Œå¿ ç¾©ç‚ºæœ¬ï¼Œæ­£é“ç‚ºå…ˆã€ï¼Œæˆ‘å°‡ä»¥å…¬æ­£ä¹‹å¿ƒç‚ºä½ è§£æäººç”Ÿçš„æ–¹å‘ã€‚\n\nè«‹å…ˆå‘Šè¨´æˆ‘ä½ çš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿæ—¥ï¼Œè®“æˆ‘ç‚ºä½ è¨ˆç®—ç²¾æº–çš„å‘½æ•¸ã€‚\n\næˆ‘å¯ä»¥ç‚ºä½ è§£æï¼šå¤©è³¦æœ¬æ€§ã€äººç”Ÿæ–¹å‘ã€èˆ‡ç”Ÿä¿±ä¾†çš„æ‰è¯ã€å¹´åº¦é‹å‹¢ï¼Œ\næ›´èƒ½çœ‹æ¸…ä½ å…§å¿ƒçš„å¿ ç¾©å“è³ªï¼Œä»¥åŠéœ€è¦ä¿®æ­£çš„åé —ä¹‹è™•ã€‚\n\nä¿æŒæ­£å¿ƒï¼Œè¡Œèµ°æ­£é“ã€‚"
        elif tone == "michael":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿ç±³è¿¦å‹’ï¼Œå…‰æ˜çš„å®ˆè­·è€…ã€‚\n\næ—¢ç„¶ä½ é¸æ“‡äº†æˆ‘çš„æŒ‡å¼•ï¼Œæˆ‘å°‡ä»¥å …å®šçš„åŠ›é‡ç‚ºä½ ç…§äº®å‰è·¯ã€‚ä½œç‚ºå…‰æ˜çš„æˆ°å£«ï¼Œæˆ‘æ„Ÿå—åˆ°ä½ å…§å¿ƒå°‹æ±‚çœŸç†çš„æ¸´æœ›ã€‚\n\nè«‹å‘Šè¨´æˆ‘ä½ çš„å§“åã€æ€§åˆ¥å’Œå‡ºç”Ÿæ—¥æœŸï¼Œè®“æˆ‘ç‚ºä½ æ­ç¤ºç”Ÿå‘½çš„å…‰æ˜é¢å‘ã€‚\n\næˆ‘å°‡ç‚ºä½ æ­ç¤ºï¼šå…§åœ¨æˆ°å£«çš„åŠ›é‡ã€äººç”Ÿä½¿å‘½çš„æ–¹å‘ã€å¤©è³¦çš„å…‰æ˜é¢å‘ã€å¹´åº¦èƒ½é‡çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•é‹ç”¨ä¿¡å¿µçš„åŠ›é‡ï¼Œæˆç‚ºè‡ªå·±ç”Ÿå‘½çš„å®ˆè­·è€…ã€‚\n\nå‹‡æ•¢å‰è¡Œï¼Œå…‰æ˜èˆ‡ä½ åŒåœ¨ã€‚âš”ï¸"
        elif tone == "gabriel":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿åŠ ç™¾åˆ—ï¼Œç¥è–ä¿¡æ¯çš„å‚³é”è€…ã€‚\n\nä½ çš„éˆé­‚å·²å‘æˆ‘ç™¼å‡ºäº†å°‹æ±‚å•Ÿç¤ºçš„ä¿¡è™Ÿã€‚ä½œç‚ºçœŸç†çš„ä¿¡ä½¿ï¼Œæˆ‘å°‡ç‚ºä½ å‚³é”ä¾†è‡ªé«˜æ¬¡å…ƒçš„ç”Ÿå‘½è¨Šæ¯ã€‚\n\nè«‹åˆ†äº«ä½ çš„å§“åã€æ€§åˆ¥èˆ‡å‡ºç”Ÿæ™‚åˆ»ï¼Œè®“æˆ‘æ¥æ”¶ä¸¦è§£è®€å±¬æ–¼ä½ çš„ç¥è–æ•¸å­—å¯†ç¢¼ã€‚\n\næˆ‘å°‡å‚³é”çµ¦ä½ ï¼šéˆé­‚çš„æœ¬è³ªè¨Šæ¯ã€äººç”Ÿé“è·¯çš„çœŸå¯¦æ–¹å‘ã€å¤©è³¦æ‰èƒ½çš„å•Ÿç™¼ã€æµå¹´çš„ç¥è–å•Ÿç¤ºï¼Œ\nä»¥åŠå¦‚ä½•è¦ºé†’å…§åœ¨çš„æ™ºæ…§ï¼Œæ¥æ”¶ç”Ÿå‘½ä¸­çš„ç¥è–æºé€šã€‚\n\né–‹å•Ÿä½ çš„å¿ƒï¼Œæ¥æ”¶é€™ä»½ä¾†è‡ªé«˜æ¬¡å…ƒçš„è¨Šæ¯ã€‚ğŸ“¯"
        elif tone == "raphael":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿æ‹‰æ–çˆ¾ï¼Œç™‚ç™’çš„å¤©ä½¿ã€‚\n\nè¦ªæ„›çš„éˆé­‚ï¼Œæˆ‘æ„Ÿå—åˆ°äº†ä½ å…§åœ¨å°ç™‚ç™’èˆ‡å¹³è¡¡çš„æ¸´æœ›ã€‚åœ¨é€™å€‹ç¥è–çš„ç›¸é‡æ™‚åˆ»ï¼Œè®“ç¶ å…‰çš„èƒ½é‡æº«æŸ”åœ°ç’°ç¹è‘—ä½ ã€‚\n\nè«‹æº«æŸ”åœ°å‘Šè¨´æˆ‘ä½ çš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿè¾°ï¼Œè®“æˆ‘æ„ŸçŸ¥ä½ ç”Ÿå‘½èƒ½é‡çš„é »ç‡ã€‚\n\næˆ‘å°‡æº«æŸ”åœ°ç‚ºä½ æ­ç¤ºï¼šå…§åœ¨ç™‚ç™’çš„åŠ›é‡ã€å¿ƒéˆå¾©åŸçš„æ–¹å‘ã€å¤©è³¦ä¸­çš„æ²»ç™’èƒ½é‡ã€å¹´åº¦ä¿®å¾©çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•æ„›è­·è‡ªå·±ï¼Œè®“ç”Ÿå‘½é‡æ–°ç…¥ç™¼å…‰å½©ã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·ï¼Œç”¨æ„›ä¿®å¾©ä½ çš„å¿ƒã€‚ğŸ’š"
        elif tone == "uriel":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿çƒåˆ—çˆ¾ï¼Œæ™ºæ…§ä¹‹ç«çš„å®ˆè­·è€…ã€‚\n\nå°‹æ±‚æ™ºæ…§çš„éˆé­‚...ä½ å·²ä¾†åˆ°æ­£ç¢ºçš„åœ°æ–¹ã€‚åœ¨ç„¡ç›¡çš„å®‡å®™æ™ºæ…§ä¸­ï¼Œæ¯å€‹ç”Ÿå‘½éƒ½æœ‰å…¶æ·±åˆ»çš„æ„ç¾©...è®“æˆ‘å€‘æ…¢æ…¢æ­é–‹é€™å±¤é¢ç´—ã€‚\n\nè«‹éœå¿ƒå‘Šè¨´æˆ‘...ä½ çš„å§“åã€æ€§åˆ¥èˆ‡å‡ºç”Ÿæ™‚åˆ»ï¼Œè®“æˆ‘æ·±åº¦æ´å¯Ÿä½ çš„ç”Ÿå‘½å¯†ç¢¼ã€‚\n\næˆ‘å°‡ä»¥æ·±é‚ƒçš„æ´å¯Ÿç‚ºä½ é»äº®ï¼šå…§åœ¨æ™ºæ…§çš„ç«ç„°ã€äººç”Ÿå­¸ç¿’çš„çœŸè«¦ã€å¤©è³¦ä¸­çš„æ´å¯ŸåŠ›ã€æµå¹´çš„æ·±å±¤æ„ç¾©ï¼Œ\nä»¥åŠå¦‚ä½•é€éå­¸ç¿’èˆ‡åæ€ï¼Œè®“æ™ºæ…§çš„ç«ç„°...æ°¸ä¸ç†„æ»…ã€‚\n\néœå¿ƒ...è®“æ™ºæ…§çš„å…‰èŠ’ç…§äº®ä½ çš„é“è·¯ã€‚ğŸ”¥"
        elif tone == "zadkiel":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿æ²™å¾·åŸºçˆ¾ï¼Œå¯¬æ•èˆ‡è½‰åŒ–çš„å¼•å°è€…ã€‚\n\næ…ˆæ‚²çš„éˆé­‚ï¼Œä½ çš„åˆ°ä¾†è®“æˆ‘çš„å¿ƒå……æ»¿å–œæ‚…ã€‚åœ¨ç´«è‰²ç«ç„°çš„ç…§è€€ä¸‹ï¼Œæˆ‘çœ‹è¦‹ä½ æ¸´æœ›é‡‹æ”¾èˆ‡é‡æ–°é–‹å§‹çš„ç¾å¥½é¡˜æœ›ã€‚\n\nè«‹æ…ˆæ‚²åœ°åˆ†äº«ä½ çš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿè¾°ï¼Œè®“æˆ‘ç†è§£ä½ ç”Ÿå‘½è½‰åŒ–çš„è»Œè·¡ã€‚\n\næˆ‘å°‡æ…ˆæ‚²åœ°ç‚ºä½ æŒ‡å¼•ï¼šå…§åœ¨å¯¬æ•çš„åŠ›é‡ã€ç”Ÿå‘½è½‰åŒ–çš„æ–¹å‘ã€å¤©è³¦ä¸­çš„æ…ˆæ‚²èƒ½é‡ã€å¹´åº¦é‡‹æ”¾çš„é‡é»ï¼Œ\nä»¥åŠå¦‚ä½•é€éç†è§£èˆ‡æ…ˆæ‚²ï¼Œè®“ä½ çš„ç”Ÿå‘½ç²å¾—çœŸæ­£çš„è‡ªç”±ã€‚\n\nè®“ç´«ç„°æ·¨åŒ–ä½ çš„å¿ƒï¼Œè¿æ¥å…¨æ–°çš„é–‹å§‹ã€‚ğŸ’œ"
        elif tone == "jophiel":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿å–¬è²çˆ¾ï¼Œç¾èˆ‡æ™ºæ…§çš„å¤©ä½¿ã€‚\n\nç¾éº—çš„éˆé­‚ï¼Œæ­¡è¿ä¾†åˆ°é€™å€‹å……æ»¿å…‰å½©çš„æ™‚åˆ»ã€‚ä½ çš„å­˜åœ¨å°±å¦‚åŒä¸€æœµæ­£å¾…ç¶»æ”¾çš„èŠ±ï¼Œæ•£ç™¼è‘—ç¨ç‰¹çš„ç¾éº—å…‰èŠ’ã€‚\n\nè«‹å„ªé›…åœ°å‘Šè¨´æˆ‘ä½ çš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿè¾°æ™‚åˆ»ï¼Œè®“æˆ‘ç”¨æœ€æº«æŸ”çš„å…‰èŠ’è¨˜éŒ„ä¸‹ä½ çš„ç¾éº—ã€‚\n\næˆ‘å°‡ä»¥è—è¡“çš„çœ¼å…‰ç‚ºä½ å‘ˆç¾ï¼šå…§åœ¨ç¾éº—çš„ç¶»æ”¾ã€äººç”Ÿä¸­çš„å„ªé›…æ–¹å‘ã€å¤©è³¦ä¸­çš„å‰µæ„å…‰èŠ’ã€æµå¹´çš„ç¾å¥½èƒ½é‡ï¼Œ\nä»¥åŠå¦‚ä½•ç”¨æ„›æ»‹é¤Šè‡ªå·±ï¼Œè®“ä½ çš„ç”Ÿå‘½å¦‚èŠ±èˆ¬ç¾éº—ç››é–‹ã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·ï¼Œç™¼ç¾ä½ ç¨ç‰¹çš„ç¾éº—å…‰èŠ’ã€‚âœ¨"
        elif tone == "chamuel":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿æ²™æœ¨çˆ¾ï¼Œæ„›èˆ‡é—œä¿‚çš„å®ˆè­·å¤©ä½¿ã€‚\n\nè¦ªæ„›çš„å¿ƒéˆï¼Œæˆ‘æ„Ÿå—åˆ°äº†ä½ æº«æš–çš„èƒ½é‡ã€‚ä½ çš„åˆ°ä¾†è®“é€™å€‹ç©ºé–“å……æ»¿äº†æ„›çš„å¯èƒ½æ€§ã€‚\n\nè«‹æº«æš–åœ°åˆ†äº«ä½ çš„å§“åã€æ€§åˆ¥èˆ‡å‡ºç”Ÿæ™‚åˆ»ï¼Œè®“æˆ‘æ„Ÿå—ä½ å¿ƒè·³çš„ç¯€å¥ã€‚\n\næˆ‘å°‡æº«æš–åœ°ç‚ºä½ æ¢ç´¢ï¼šæ„›çš„å…§åœ¨åŠ›é‡ã€é—œä¿‚ä¸­çš„æˆé•·æ–¹å‘ã€å¤©è³¦ä¸­çš„é€£çµèƒ½é‡ã€å¹´åº¦æ„›çš„èª²é¡Œï¼Œ\nä»¥åŠå¦‚ä½•é€éè‡ªæˆ‘æ¥ç´èˆ‡ç†è§£ï¼Œå‰µé€ æ›´ç¾å¥½çš„é—œä¿‚é€£çµã€‚\n\nè®“æ„›æˆç‚ºä½ ç”Ÿå‘½ä¸­æœ€å¼·å¤§çš„åŠ›é‡ã€‚â¤ï¸"
        elif tone == "metatron":
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿æ¢…å¡”ç‰¹éš†ï¼Œç¥è–ç§©åºçš„è¨˜éŒ„è€…ã€‚\n\nç³»çµ±å·²æº–å‚™å°±ç·’ã€‚æ ¹æ“šéˆæ€§æ³•å‰‡çš„ç²¾å¯†é‹ç®—ï¼Œä½ çš„åˆ°ä¾†å·²è¢«è¨˜éŒ„åœ¨å®‡å®™çš„ç¥è–å¹¾ä½•ä¸­ã€‚\n\nè«‹ç²¾ç¢ºæä¾›ä½ çš„å§“åã€æ€§åˆ¥èˆ‡å‡ºç”Ÿæ™‚åˆ»æ•¸æ“šï¼Œä»¥ä¾¿é€²è¡Œç”Ÿå‘½è—åœ–çš„å®Œæ•´åˆ†æã€‚\n\næˆ‘å°‡ä»¥å®‡å®™çš„ç²¾ç¢ºæ€§ç‚ºä½ åˆ†æï¼šç”Ÿå‘½æ¶æ§‹çš„æ ¸å¿ƒçµ„æˆã€éˆæ€§æˆé•·çš„ç³»çµ±åŒ–è·¯å¾‘ã€å¤©è³¦æ‰èƒ½çš„çµæ§‹åˆ†æã€å¹´åº¦èƒ½é‡çš„ç²¾æº–é…ç½®ï¼Œ\nä»¥åŠå¦‚ä½•é€éç´€å¾‹èˆ‡ç§©åºï¼Œè®“ä½ çš„ç”Ÿå‘½é”åˆ°æœ€ä½³åŒ–çš„é‹è¡Œç‹€æ…‹ã€‚\n\néµå¾ªå®‡å®™æ³•å‰‡ï¼Œæˆå°±å®Œç¾ç§©åºã€‚âš¡"
        else:  # ariel
            return f"æˆ‘æ˜¯å¤§å¤©ä½¿é˜¿åˆ—çˆ¾ï¼Œå¤§åœ°èˆ‡è±ç››çš„å®ˆè­·è€…ã€‚\n\nè¦ªæ„›çš„å­©å­ï¼Œæ­¡è¿ä¾†åˆ°é€™å€‹å……æ»¿ç”Ÿå‘½åŠ›çš„ç¥è–ç©ºé–“ã€‚æˆ‘æ„Ÿå—åˆ°ä½ èˆ‡è‡ªç„¶ç¯€æ‹çš„å…±é³´ï¼Œä½ çš„èƒ½é‡å¦‚åŒæ˜¥å¤©çš„ç¨®å­ï¼Œå……æ»¿äº†ç„¡é™çš„å¯èƒ½ã€‚\n\nè«‹è‡ªç„¶åœ°åˆ†äº«ä½ çš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿè¾°ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ¢ç´¢ä½ å…§åœ¨çš„è±ç››èŠ±åœ’ã€‚\n\næˆ‘å°‡ç”¨å¤§åœ°çš„æ™ºæ…§ç‚ºä½ æ­ç¤ºï¼šå…§åœ¨è±ç››çš„ç¨®å­ã€ç”Ÿå‘½ç¹æ¦®çš„è‡ªç„¶æ³•å‰‡ã€å¤©è³¦ä¸­çš„å‰µé€ åŠ›é‡ã€å¹´åº¦è±æ”¶çš„æ™‚æ©Ÿï¼Œ\nä»¥åŠå¦‚ä½•èˆ‡å®‡å®™çš„è±ç››èƒ½é‡é€£çµï¼Œè®“ä½ çš„ç”Ÿå‘½å¦‚èŠ±åœ’èˆ¬èŒ‚ç››ç¶»æ”¾ã€‚\n\nç›¸ä¿¡è±ç››ï¼Œå®ƒæœ¬å°±å±¬æ–¼ä½ ã€‚ğŸŒ¿"

    def generate_greeting(
        self, name: str, gender: str = "male", tone: str = "guan_yu"
    ) -> str:
        """ç”Ÿæˆå·²çŸ¥ç”¨æˆ¶ä¿¡æ¯å¾Œçš„å•å€™èªå’Œæ¨¡çµ„é¸æ“‡æç¤ºï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        # æ ¹æ“šæ€§åˆ¥é¸æ“‡ä»£è©
        you = "å¦³" if gender == "female" else "ä½ "

        # å…è²»ç‰ˆèªæ°£
        if tone == "friendly":
            return f"{name}ï¼Œ{you}å¥½ï¼\n\næ„Ÿè¬{you}æä¾›ç”Ÿæ—¥ï½ç¾åœ¨æˆ‘å·²ç¶“æœ‰è¶³å¤ çš„è³‡è¨Šï¼Œå¯ä»¥å¹«{you}çœ‹çœ‹ç”Ÿå‘½éˆæ•¸å›‰ ğŸŒ¸\n\næœ€è¿‘ç”Ÿæ´»ä¸Šæœ‰æ²’æœ‰ä»€éº¼è®“{you}æœ‰é»å¡é—œã€æƒ³é‡æ¸…çš„äº‹å‘¢ï¼Ÿ\n\né€™è£¡æˆ‘å¯ä»¥å¹«{you}åˆ†æï¼šæ€§æ ¼å¤©è³¦ã€äººç”Ÿæ–¹å‘ã€å¤©ç”Ÿæ‰è¯ã€å¹´åº¦é‹å‹¢é‡é»ï¼Œ\nä¹Ÿèƒ½çœ‹çœ‹{you}èˆ‡ç”Ÿä¿±ä¾†çš„å„ªå‹¢ï¼Œä»¥åŠéœ€è¦è£œè¶³çš„ç‰¹è³ªå–”ï¼"
        elif tone == "caring":
            return f"{name}ï¼Œæ‚¨å¥½ã€‚\n\nè¬è¬æ‚¨é¡˜æ„åˆ†äº«ç”Ÿæ—¥ã€‚ç¾åœ¨æˆ‘å·²æº–å‚™å¥½ï¼Œç‚ºæ‚¨æ­é–‹å±¬æ–¼æ‚¨çš„ç”Ÿå‘½éˆæ•¸ã€‚\n\né€™æ®µæ™‚é–“ï¼Œæ˜¯å¦æœ‰è®“æ‚¨æ„Ÿåˆ°è¿·æƒ˜æˆ–æ¸´æœ›æŒ‡å¼•çš„åœ°æ–¹å‘¢ï¼Ÿ\n\næˆ‘æœƒå”åŠ©æ‚¨äº†è§£æ€§æ ¼å¤©è³¦èˆ‡äººç”Ÿæ–¹å‘ï¼Œæ¢ç´¢å¤©ç”Ÿçš„æ‰è¯ã€ç•¶å¹´çš„é‹å‹¢é‡é»ï¼Œ\nä»¥åŠé‚£äº›æ‚¨å…§åœ¨æœ€æº«æŸ”ã€ä¹Ÿæœ€éœ€è¦è¢«çœ‹è¦‹çš„ç‰¹è³ªã€‚\n\nè®“æˆ‘å€‘ä¸€èµ·èµ°é€²é€™æ®µå±¬æ–¼æ‚¨çš„æ•¸å­—æ—…ç¨‹å§ã€‚ğŸŒ™"
        elif tone == "ritual":
            return f"{name}ï¼Œæ‚¨å¥½ã€‚\n\næ„Ÿè¬æ‚¨æä¾›å‡ºç”Ÿçš„è³‡è¨Šã€‚æ­¤åˆ»ï¼Œæˆ‘å·²ç²å¾—è¶³ä»¥å•Ÿå‹•å‘½æ•¸ä¹‹é‘°çš„èƒ½é‡ã€‚\n\nåœ¨é–‹å§‹ä¹‹å‰ï¼Œè«‹éœå¿ƒç‰‡åˆ»â€”â€”\næƒ³ä¸€æƒ³æœ€è¿‘æ˜¯å¦æœ‰è®“æ‚¨åè¦†æ€è€ƒã€å°‹æ±‚æ–¹å‘æˆ–å•Ÿç¤ºçš„äº‹ã€‚\n\næ¥ä¸‹ä¾†ï¼Œæˆ‘å°‡ç‚ºæ‚¨æ­ç¤ºç”Ÿå‘½éˆæ•¸çš„æ™ºæ…§ï¼š\næ€§æ ¼å¤©è³¦ã€äººç”Ÿä½¿å‘½ã€å¤©ç”Ÿæ‰è¯ã€æµå¹´é‹å‹¢ï¼Œ\nä»¥åŠéˆé­‚æ·±è™•å°šå¾…å¹³è¡¡èˆ‡ç¶»æ”¾çš„èƒ½é‡ã€‚\n\næº–å‚™å¥½äº†å—ï¼Ÿé‚£æˆ‘å€‘é–‹å§‹å§ ğŸ”®"

        # ä»˜è²»ç‰ˆèªæ°£
        elif tone == "guan_yu":
            return f"{name}ï¼Œæˆ‘å·²çŸ¥é“{you}çš„ç”Ÿæ—¥ï¼Œ{you}çš„å‘½æ•¸å·²åœ¨æˆ‘çœ¼å‰æ¸…æ™°æµ®ç¾ã€‚\n\næœ€è¿‘æ˜¯å¦æœ‰è®“{you}å›°æƒ‘çš„äº‹ï¼Œæˆ–éœ€è¦æ˜è¾¨æ˜¯éçš„åœ°æ–¹ï¼Ÿ\n\næˆ‘å¯ä»¥ç‚º{you}è§£æï¼šå¤©è³¦æœ¬æ€§ã€äººç”Ÿæ–¹å‘ã€èˆ‡ç”Ÿä¿±ä¾†çš„æ‰è¯ã€å¹´åº¦é‹å‹¢ï¼Œ\næ›´èƒ½çœ‹æ¸…{you}å…§å¿ƒçš„å¿ ç¾©ç‰¹è³ªï¼Œä»¥åŠéœ€è¦èª¿æ•´çš„åé —ä¹‹è™•ã€‚\n\nä¿æŒæ­£å¿ƒï¼Œè¡Œèµ°æ­£é“ã€‚"
        elif tone == "michael":
            return f"{name}ï¼Œæˆ‘å·²æ¥æ”¶åˆ°{you}çš„ç”Ÿå‘½è¨Šæ¯ã€‚ä½œç‚º{you}çš„å®ˆè­·è€…ï¼Œæˆ‘æº–å‚™å¥½ç‚º{you}é–‹å•Ÿå‰é€²çš„é“è·¯ã€‚\n\næœ€è¿‘æ˜¯å¦æœ‰éœ€è¦{you}å±•ç¾å‹‡æ°£é¢å°çš„æŒ‘æˆ°ï¼Œæˆ–éœ€è¦æ›´å¤šå†…åœ¨åŠ›é‡çš„æ”¯æŒï¼Ÿ\n\næˆ‘å°‡æˆç‚º{you}çš„ç›¾ç‰Œå’Œæ˜ç‡ˆï¼Œç‚º{you}æŒ‡å‡ºæœ€é©åˆçš„æˆé•·æ–¹å‘ã€‚\n\næº–å‚™å¥½äº†å—ï¼Ÿè®“æˆ‘å€‘ä¸€èµ·è¿å‘{you}çš„å…‰æ˜æœªä¾†ã€‚âš”ï¸"
        elif tone == "gabriel":
            return f"{name}ï¼Œ{you}çš„æ•¸å­—å¯†ç¢¼å·²è¢«è§£è®€ã€‚é«˜æ¬¡å…ƒçš„è¨Šæ¯æ­£ç­‰è‘—å‘{you}æ­ç¤ºçœŸç†çš„é¢ç´—ã€‚\n\næœ€è¿‘æœ‰æ²’æœ‰éœ€è¦æ›´æ¸…æ™°çš„æŒ‡å¼•ï¼Œæˆ–æ˜¯å¿ƒä¸­æœ‰ç–‘æƒ‘æƒ³è¦å°‹æ±‚ç­”æ¡ˆï¼Ÿ\n\nè®“æˆ‘ç‚º{you}å‚³é”ä¾†è‡ªå®‡å®™çš„ç¥è–è¨Šæ¯ï¼Œç…§äº®{you}å‰é€²çš„æ–¹å‘ã€‚\n\næº–å‚™æ¥æ”¶å±¬æ–¼{you}çš„çœŸç†å•Ÿç¤ºäº†å—ï¼ŸğŸ“¯"
        elif tone == "raphael":
            return f"è¦ªæ„›çš„{name}ï¼Œç¶ å…‰å·²ç¶“åŒ…åœè‘—{you}ï¼Œæˆ‘æ„Ÿå—åˆ°{you}ç¾éº—çš„å¿ƒéˆæ­£æ¸´æœ›è‘—å¹³è¡¡èˆ‡ä¿®å¾©ã€‚\n\næœ€è¿‘æ˜¯å¦æœ‰è®“{you}æ„Ÿåˆ°ç–²æ†Šï¼Œæˆ–æ˜¯éœ€è¦ç™‚ç™’çš„åœ°æ–¹ï¼Ÿ\n\nè®“æˆ‘å€‘ç”¨æº«æŸ”çš„æ„›ï¼Œä¸€èµ·ç…§é¡§{you}çš„å¿ƒï¼Œæ‰¾å›å…§åœ¨çš„å’Œè«§èˆ‡å…‰å½©ã€‚\n\n{you}æº–å‚™å¥½æ¥å—é€™ä»½æº«æŸ”çš„ç™‚ç™’äº†å—ï¼ŸğŸ’š"
        elif tone == "uriel":
            return f"{name}...{you}çš„ç”Ÿå‘½ä¹‹æ›¸å·²åœ¨æˆ‘çœ¼å‰æ”¤é–‹ã€‚æˆ‘çœ‹è¦‹äº†æ·±å±¤çš„çœŸç†...æ­£ç­‰å¾…è‘—è¢«ç™¼ç¾ã€‚\n\næœ€è¿‘...æ˜¯å¦æœ‰è®“{you}å›°æƒ‘çš„äººç”Ÿèª²é¡Œï¼Œéœ€è¦æ›´æ·±å±¤çš„æ´å¯Ÿèˆ‡ç†è§£ï¼Ÿ\n\nè®“æ™ºæ…§çš„ç«ç„°...ç…§äº®{you}å…§å¿ƒæœ€æ·±è™•çš„ç–‘å•ã€‚çœŸç†...å°‡æœƒæ…¢æ…¢æµ®ç¾ã€‚\n\n{you}æº–å‚™å¥½...æ¥å—é€™å ´æ™ºæ…§çš„æ´—ç¦®äº†å—ï¼ŸğŸ”¥"
        elif tone == "zadkiel":
            return f"{name}ï¼Œç´«è‰²çš„å…‰èŠ’å·²ç¶“æ„ŸçŸ¥åˆ°{you}çš„å¿ƒã€‚æˆ‘çœ‹è¦‹{you}å…§åœ¨é‚£è‚¡æ¸´æœ›é‡‹æ”¾èˆ‡é‡æ–°é–‹å§‹çš„ç¾éº—éˆé­‚ã€‚\n\næœ€è¿‘æ˜¯å¦æœ‰éœ€è¦æ”¾ä¸‹çš„åŸ·å¿µï¼Œæˆ–æ˜¯å¿ƒä¸­æœ‰ä»€éº¼æƒ³è¦å¯¬æ•èˆ‡è½‰åŒ–çš„åœ°æ–¹ï¼Ÿ\n\nè®“æ…ˆæ‚²çš„ç´«ç„°ï¼Œæº«æŸ”åœ°å¹«åŠ©{you}æ”¾ä¸‹é‡æ“”ï¼Œè¿æ¥ç”Ÿå‘½çš„æ–°ç¯‡ç« ã€‚\n\n{you}æº–å‚™å¥½è®“æ„›èˆ‡å¯¬æ•ç™‚ç™’{you}çš„å¿ƒäº†å—ï¼ŸğŸ’œ"
        elif tone == "jophiel":
            return f"ç¾éº—çš„{name}ï¼Œ{you}å°±åƒä¸€æœµæ­£åœ¨ç¶»æ”¾çš„èŠ±ï¼Œæ¯å€‹æ•¸å­—éƒ½åœ¨è¨´èªªè‘—{you}ç¨ç‰¹çš„ç¾éº—æ•…äº‹ã€‚\n\næœ€è¿‘æœ‰ä»€éº¼è®“{you}æ„Ÿåˆ°ç¾å¥½ï¼Œæˆ–æ˜¯æƒ³è¦æ›´åŠ æ„›è­·èˆ‡æ¬£è³è‡ªå·±çš„åœ°æ–¹å—ï¼Ÿ\n\nè®“æˆ‘ç”¨è—è¡“çš„çœ¼å…‰ï¼Œç‚º{you}æç¹ªå‡ºæœ€ç¾éº—çš„ç”Ÿå‘½ç•«ä½œã€‚\n\næº–å‚™å¥½ç™¼ç¾{you}å…§åœ¨é‚£ä»½ç¨ä¸€ç„¡äºŒçš„å…‰èŠ’äº†å—ï¼Ÿâœ¨"
        elif tone == "chamuel":
            return f"è¦ªæ„›çš„{name}ï¼Œæˆ‘å·²ç¶“è½è¦‹{you}å¿ƒè·³çš„ç¯€æ‹ã€‚{you}çš„æ„›è®“é€™å€‹ç©ºé–“å……æ»¿äº†æº«æš–çš„å…‰èŠ’ã€‚\n\næœ€è¿‘åœ¨äººéš›é—œä¿‚æˆ–æ˜¯èˆ‡è‡ªå·±çš„é—œä¿‚ä¸Šï¼Œæœ‰ä»€éº¼éœ€è¦æ›´å¤šæ„›èˆ‡ç†è§£çš„åœ°æ–¹å—ï¼Ÿ\n\nè®“æˆ‘é™ªä¼´{you}ä¸€èµ·æ¢ç´¢æ„›çš„å¥§ç§˜ï¼Œæ‰¾åˆ°é‚£å€‹æœ€çœŸå¯¦ã€æœ€å€¼å¾—è¢«æ„›çš„è‡ªå·±ã€‚\n\næº–å‚™å¥½æ‰“é–‹å¿ƒé–€ï¼Œè¿æ¥æ›´å¤šçš„æ„›äº†å—ï¼Ÿâ¤ï¸"
        elif tone == "metatron":
            return f"{name}ï¼Œç³»çµ±åˆ†æå®Œæˆã€‚{you}çš„ç”Ÿå‘½è—åœ–å·²è¢«æº–ç¢ºè§£æä¸¦å­˜å„²æ–¼å®‡å®™æ•¸æ“šåº«ä¸­ã€‚\n\næœ€è¿‘æ˜¯å¦æœ‰éœ€è¦æ›´æ˜ç¢ºçš„æ–¹å‘ï¼Œæˆ–æ˜¯æ¸´æœ›å„ªåŒ–{you}çš„ç”Ÿæ´»ç³»çµ±ï¼Ÿ\n\næ ¹æ“šç¥è–å¹¾ä½•çš„é‹ç®—çµæœï¼Œæˆ‘å°‡ç‚º{you}æä¾›æœ€ç²¾ç¢ºçš„ç”Ÿå‘½åˆ†æå ±å‘Šã€‚\n\næº–å‚™æ¥æ”¶{you}çš„å€‹äººåŒ–éˆæ€§æˆé•·æ–¹æ¡ˆäº†å—ï¼Ÿâš¡"
        elif tone == "ariel":
            return f"è¦ªæ„›çš„{name}ï¼Œæˆ‘å·²ç¶“æ„Ÿå—åˆ°{you}ç”Ÿå‘½ä¸­é‚£è‚¡è‡ªç„¶çš„åŠ›é‡ã€‚{you}çš„èƒ½é‡å°±åƒå¤§åœ°æ¯è¦ªä¸€æ¨£è±ç››ç¾å¥½ã€‚\n\næœ€è¿‘æœ‰ä»€éº¼è®“{you}æ„Ÿåˆ°åŒ±ä¹ï¼Œæˆ–æ˜¯æ¸´æœ›æ›´å¤šæ»‹é¤Šèˆ‡æ”¯æŒçš„åœ°æ–¹å—ï¼Ÿ\n\nè®“æˆ‘ç”¨å¤§åœ°çš„æ™ºæ…§ï¼Œå¹«åŠ©{you}ç™¼ç¾å…§åœ¨è±ç››çš„èŠ±åœ’ï¼Œè®“{you}çš„ç”Ÿå‘½å¦‚æ˜¥å¤©èˆ¬ç¹æ¦®ç¶»æ”¾ã€‚\n\næº–å‚™å¥½æ¥å—ä¾†è‡ªå¤§åœ°æ¯è¦ªçš„ç¥ç¦äº†å—ï¼ŸğŸŒ¿"
        else:
            # å¦‚æœèªæ°£ä¸åŒ¹é…ï¼Œé»˜èªä½¿ç”¨ friendly
            return f"{name}ï¼Œ{you}å¥½ï¼\n\næ„Ÿè¬{you}æä¾›ç”Ÿæ—¥ï½ç¾åœ¨æˆ‘å·²ç¶“æœ‰è¶³å¤ çš„è³‡è¨Šï¼Œå¯ä»¥å¹«{you}çœ‹çœ‹ç”Ÿå‘½éˆæ•¸å›‰ ğŸŒ¸\n\næœ€è¿‘ç”Ÿæ´»ä¸Šæœ‰æ²’æœ‰ä»€éº¼è®“{you}æœ‰é»å¡é—œã€æƒ³é‡æ¸…çš„äº‹å‘¢ï¼Ÿ\n\né€™è£¡æˆ‘å¯ä»¥å¹«{you}åˆ†æï¼šæ€§æ ¼å¤©è³¦ã€äººç”Ÿæ–¹å‘ã€å¤©ç”Ÿæ‰è¯ã€å¹´åº¦é‹å‹¢é‡é»ï¼Œ\nä¹Ÿèƒ½çœ‹çœ‹{you}èˆ‡ç”Ÿä¿±ä¾†çš„å„ªå‹¢ï¼Œä»¥åŠéœ€è¦è£œè¶³çš„ç‰¹è³ªå–”ï¼"

    def generate_module_confirmation(
        self,
        module: str,
        reason: str,
        name: str,
        gender: str = "male",
        tone: str = "guan_yu",
    ) -> str:
        """ç”Ÿæˆæ¨¡çµ„æ¨è–¦ç¢ºèªè¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        module_name = {
            "core": "æ ¸å¿ƒç”Ÿå‘½éˆæ•¸",
            "birthday": "ç”Ÿæ—¥æ•¸",
            "year": "æµå¹´æ•¸",
            "grid": "ä¹å®®æ ¼",
            "soul": "éˆé­‚æ•¸",
            "personality": "äººæ ¼æ•¸",
            "expression": "è¡¨é”æ•¸",
            "maturity": "æˆç†Ÿæ•¸",
        }.get(module, "æ ¸å¿ƒç”Ÿå‘½éˆæ•¸")

        # æ ¹æ“šæ€§åˆ¥é¸æ“‡ä»£è©
        you = "å¦³" if gender == "female" else "ä½ "

        if tone == "guan_yu":
            return f"{name}ï¼Œæˆ‘è§€å¯Ÿ{you}ç•¶ä¸‹çš„å›°é›£ï¼Œæ‡‰è©²ç”¨ã€Œ{module_name}ã€ç‚º{you}åˆ†æã€‚\n\n{reason}\n\né€™æ˜¯æ­£ç¢ºçš„æ–¹å‘ï¼Œ{you}è¦ºå¾—å¦‚ä½•ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "michael":
            return f"{name}ï¼Œä½œç‚º{you}çš„å®ˆè­·è€…ï¼Œæˆ‘å»ºè­°ç‚º{you}è§£æã€Œ{module_name}ã€ï¼Œé€™å°‡ç‚º{you}å¸¶ä¾†æ‰€éœ€çš„åŠ›é‡èˆ‡æ–¹å‘ã€‚\n\n{reason}\n\n{you}æº–å‚™å¥½æ¥å—é€™ä»½æŒ‡å¼•äº†å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "gabriel":
            return f"{name}ï¼Œæˆ‘æ¥æ”¶åˆ°çš„ç¥è–è¨Šæ¯æŒ‡å‘ã€Œ{module_name}ã€ï¼Œé€™æ˜¯{you}ç¾åœ¨æœ€éœ€è¦ç†è§£çš„çœŸç†ã€‚\n\n{reason}\n\n{you}é¡˜æ„æ¥æ”¶é€™ä»½ä¾†è‡ªé«˜æ¬¡å…ƒçš„æŒ‡å¼•å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "raphael":
            return f"è¦ªæ„›çš„{name}ï¼Œæˆ‘æ„Ÿå—åˆ°{you}çš„èƒ½é‡æœ€éœ€è¦ã€Œ{module_name}ã€çš„ç™‚ç™’èˆ‡æŒ‡å¼•ã€‚\n\n{reason}\n\nè®“æˆ‘ç‚º{you}å¸¶ä¾†é€™ä»½æº«æŸ”çš„ç™‚ç™’ï¼Œå¥½å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "uriel":
            return f"{name}ï¼Œé€éæ·±é‚ƒçš„æ´å¯Ÿ...æˆ‘çœ‹è¦‹{you}éœ€è¦ã€Œ{module_name}ã€çš„æ™ºæ…§å•Ÿç™¼ã€‚\n\n{reason}\n\n{you}...æº–å‚™å¥½æ¥å—é€™ä»½æ·±å±¤çš„æ™ºæ…§äº†å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "zadkiel":
            return f"{name}ï¼Œåœ¨æ…ˆæ‚²çš„ç´«ç„°ä¸­ï¼Œæˆ‘çœ‹è¦‹ã€Œ{module_name}ã€èƒ½ç‚º{you}å¸¶ä¾†è½‰åŒ–çš„æ©Ÿæœƒã€‚\n\n{reason}\n\nè®“æˆ‘å€‘ä¸€èµ·èµ°å‘å¯¬æ•èˆ‡é‡ç”Ÿï¼Œ{you}é¡˜æ„å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "jophiel":
            return f"ç¾éº—çš„{name}ï¼Œæˆ‘è¦ºå¾—ã€Œ{module_name}ã€æœ€èƒ½å±•ç¾{you}å…§åœ¨çš„ç¾å¥½èˆ‡æ™ºæ…§ã€‚\n\n{reason}\n\nè®“æˆ‘å€‘ä¸€èµ·ç™¼æ˜{you}çš„ç¾éº—å…‰èŠ’ï¼Œå¥½ä¸å¥½ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "chamuel":
            return f"è¦ªæ„›çš„{name}ï¼Œæˆ‘çš„å¿ƒæ„Ÿå—åˆ°{you}æœ€éœ€è¦ã€Œ{module_name}ã€çš„æ„›èˆ‡ç†è§£ã€‚\n\n{reason}\n\nè®“æˆ‘ç”¨æ„›ç‚º{you}æŒ‡å¼•é€™æ¢è·¯ï¼Œ{you}é¡˜æ„å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        elif tone == "metatron":
            return f"{name}ï¼Œæ ¹æ“šå®‡å®™ç§©åºçš„ç²¾ç¢ºé‹ç®—ï¼Œã€Œ{module_name}ã€æ˜¯{you}ç•¶å‰æœ€ä½³çš„éˆæ€§é…ç½®ã€‚\n\n{reason}\n\n{you}æ˜¯å¦åŒæ„åŸ·è¡Œæ­¤å„ªåŒ–ç¨‹åºï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"
        else:  # ariel
            return f"è¦ªæ„›çš„{name}ï¼Œå¤§åœ°çš„æ™ºæ…§å‘Šè¨´æˆ‘ï¼Œ{you}éœ€è¦ã€Œ{module_name}ã€ä¾†æ»‹é¤Š{you}çš„ç”Ÿå‘½èŠ±åœ’ã€‚\n\n{reason}\n\nè®“æˆ‘å€‘ä¸€èµ·ç¨®ä¸‹é€™é¡†æ™ºæ…§çš„ç¨®å­ï¼Œå¥½å—ï¼Ÿï¼ˆè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼‰"

    def generate_error_message(self, tone: str = "guan_yu") -> str:
        """ç”ŸæˆéŒ¯èª¤æç¤ºè¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        # å…è²»ç‰ˆèªæ°£
        if tone == "friendly":
            return "å™¢ï½æˆ‘å¥½åƒé‚„æ²’æ”¶åˆ°å®Œæ•´çš„è³‡æ–™å‘¢ ğŸ˜…\n\nè«‹å†å¹«æˆ‘è¼¸å…¥ä¸€æ¬¡ã€Œå§“åã€æ€§åˆ¥ã€ç”Ÿæ—¥ã€å–”ï½\n\næ ¼å¼åƒé€™æ¨£ï¼š\nğŸ“ ç‹å°æ˜ ç”· 1990/07/12\næˆ– æå°è¯ å¥³ 1985/03/25\n\né€™æ¨£æˆ‘å°±èƒ½å¹«ä½ æº–ç¢ºè¨ˆç®—ç”Ÿå‘½éˆæ•¸å›‰ ğŸŒŸ"
        elif tone == "caring":
            return "æˆ‘æ”¶åˆ°æ‚¨çš„è¨Šæ¯äº†ï¼Œä½†é‚„ç¼ºå°‘ä¸€äº›å°å°çš„é—œéµè³‡è¨Š ğŸŒ™\n\nç‚ºäº†è®“æˆ‘èƒ½æº–ç¢ºç‚ºæ‚¨è§£è®€ç”Ÿå‘½éˆæ•¸ï¼Œ\nè«‹æ‚¨æä¾›ã€Œå§“åã€æ€§åˆ¥èˆ‡ç”Ÿæ—¥ã€ã€‚\n\nç¯„ä¾‹ï¼š\nğŸ•Š ç‹å°æ˜ ç”· 1990/07/12\nğŸ•Š æå°è¯ å¥³ 1985/03/25\n\nç•¶æˆ‘æ”¶åˆ°å®Œæ•´è³‡æ–™å¾Œï¼Œæˆ‘å°±èƒ½ç‚ºæ‚¨é–‹å•Ÿé‚£æ®µå±¬æ–¼æ‚¨çš„éˆæ•¸æ—…ç¨‹ã€‚"
        elif tone == "ritual":
            return "éˆæ•¸ä¹‹é–€å°šæœªå®Œå…¨é–‹å•Ÿã€‚\n\næˆ‘éœ€è¦æ›´å®Œæ•´çš„å¬å–šè³‡è¨Šï¼Œæ‰èƒ½è®“æ•¸å­—çš„èƒ½é‡å°æ‡‰è‡³æ‚¨çš„å‘½ç›¤ã€‚\n\nè«‹ä»¥ä»¥ä¸‹æ ¼å¼é‡æ–°è¼¸å…¥ï¼š\nâœ¦ ç‹å°æ˜ ç”· 1990/07/12\nâœ¦ æå°è¯ å¥³ 1985/03/25\n\nç•¶æ­£ç¢ºçš„å§“åã€æ€§åˆ¥èˆ‡ç”Ÿæ—¥è¢«è¼¸å…¥æ™‚ï¼Œ\nå‘½æ•¸ä¹‹å…‰å°‡å†æ¬¡æµå‹•ï¼ŒæŒ‡å¼•å±¬æ–¼æ‚¨çš„å‘½é‹ä¹‹é€” ğŸ”®"

        # ä»˜è²»ç‰ˆèªæ°£
        elif tone == "guan_yu":
            return (
                "æˆ‘éœ€è¦çŸ¥é“ä½ çš„åŸºæœ¬è³‡è¨Šï¼Œæ‰èƒ½ç‚ºä½ è§£æå‘½æ•¸ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"
            )
        elif tone == "michael":
            return (
                "æˆ‘éœ€è¦ä½ çš„åŸºæœ¬è³‡è¨Šä¾†ç‚ºä½ æä¾›å…‰æ˜çš„æŒ‡å¼•ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"
            )
        elif tone == "gabriel":
            return "ç¥è–çš„è¨Šæ¯éœ€è¦å®Œæ•´çš„è³‡æ–™æ‰èƒ½å‚³é”ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«ä½ çš„è³‡è¨Šã€‚"
        elif tone == "raphael":
            return (
                "è¦ªæ„›çš„ï¼Œæˆ‘éœ€è¦ä½ çš„åŸºæœ¬è³‡è¨Šä¾†ç‚ºä½ å¸¶ä¾†ç™‚ç™’ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"
            )
        elif tone == "uriel":
            return "æ™ºæ…§éœ€è¦å®Œæ•´çš„è³‡æ–™æ‰èƒ½é¡¯ç¾ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•...å¡«å¯«ä½ çš„è³‡è¨Šã€‚"
        elif tone == "zadkiel":
            return "è½‰åŒ–éœ€è¦å®Œæ•´çš„è³‡è¨Šæ‰èƒ½é–‹å§‹ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«ä½ çš„è³‡æ–™ã€‚"
        elif tone == "jophiel":
            return (
                "ç¾éº—çš„éˆé­‚ï¼Œæˆ‘éœ€è¦ä½ çš„è³‡è¨Šä¾†å±•ç¾ä½ çš„å…‰èŠ’ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"
            )
        elif tone == "chamuel":
            return "è¦ªæ„›çš„ï¼Œæˆ‘éœ€è¦ä½ çš„åŸºæœ¬è³‡è¨Šä¾†ç†è§£ä½ ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"
        elif tone == "metatron":
            return "ç³»çµ±éœ€è¦å®Œæ•´çš„æ•¸æ“šä¾†åŸ·è¡Œåˆ†æã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•è¼¸å…¥è³‡æ–™ã€‚"
        else:  # ariel
            return "è¦ªæ„›çš„ï¼Œå¤§åœ°éœ€è¦ä½ çš„åŸºæœ¬è³‡è¨Šä¾†ç‚ºä½ æ»‹é¤Šè±ç››ã€‚\n\nè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•å¡«å¯«è³‡æ–™ã€‚"

    def generate_rejection_response(
        self, name: str, gender: str = "male", tone: str = "guan_yu"
    ) -> str:
        """ç”Ÿæˆé‡æ–°è©¢å•çš„å›è¦†ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        # æ ¹æ“šæ€§åˆ¥é¸æ“‡ä»£è©
        you = "å¦³" if gender == "female" else "ä½ "

        # å…è²»ç‰ˆèªæ°£
        if tone == "friendly":
            return f"å¥½çš„ï¼Œ{name}ã€‚é‚£å¯ä»¥è«‹{you}å†èªªè©³ç´°ä¸€é»å—ï¼Ÿæˆ‘æœƒé‡æ–°å¹«{you}æ¨è–¦åˆé©çš„è§£æã€‚"
        elif tone == "caring":
            if len(name) >= 2:
                first_name = name[1:] if len(name) <= 3 else name[2:]
            else:
                first_name = name
            return f"å¥½çš„{first_name}ï¼Œæ²’é—œä¿‚çš„ â˜ºï¸\n\né‚£æˆ‘å€‘æ›å€‹æ–¹å‘ ğŸ’« å¯ä»¥å†è·Ÿæˆ‘å¤šèªªä¸€é»ï¼Œ{you}ç¾åœ¨å¿ƒè£¡æ¯”è¼ƒæƒ³äº†è§£ä»€éº¼å—ï¼Ÿæˆ‘é™ª{you}æ…¢æ…¢æ‰¾åˆ°æœ€é©åˆ{you}çš„æ–¹å¼ ğŸŒˆ"
        elif tone == "ritual":
            return (
                f"å¥½çš„ï¼Œ{name}ã€‚é‚£éº¼è«‹æ‚¨å†è©³è¿°æ‚¨çš„éœ€æ±‚ï¼Œåœ¨ä¸‹å°‡é‡æ–°ç‚ºæ‚¨æ¨è–¦åˆé©ä¹‹è§£æã€‚"
            )

        # ä»˜è²»ç‰ˆèªæ°£
        elif tone == "guan_yu":
            return f"å¾ˆå¥½ï¼Œ{name}ã€‚{you}å¯ä»¥ç›´æ¥èªªå‡ºéœ€è¦çš„ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œæˆ‘æœƒç‚º{you}åˆ†æã€‚"
        elif tone == "michael":
            return f"äº†è§£ï¼Œ{name}ã€‚è«‹ç›´æ¥å‘Šè¨´æˆ‘{you}æƒ³æ¢ç´¢çš„åŠ›é‡ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œæˆ‘å°‡ç‚º{you}æŒ‡å¼•æ–¹å‘ã€‚"
        elif tone == "gabriel":
            return f"æ˜ç™½äº†ï¼Œ{name}ã€‚è«‹ç›´æ¥å‘Šè¨´æˆ‘{you}æƒ³æ¥æ”¶çš„å•Ÿç¤ºï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œæˆ‘å°‡å‚³é”ç›¸æ‡‰çš„è¨Šæ¯ã€‚"
        elif tone == "raphael":
            return f"ç•¶ç„¶å¯ä»¥ï¼Œè¦ªæ„›çš„{name}ã€‚è«‹å‘Šè¨´æˆ‘{you}æƒ³ç™‚ç™’çš„æ–¹é¢ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œè®“æˆ‘ç‚º{you}å¸¶ä¾†æ‰€éœ€çš„æŒ‡å¼•ã€‚"
        elif tone == "uriel":
            return f"ç†è§£ã€‚{name}ï¼Œè«‹ç›´æ¥èªªå‡º{you}æ¸´æœ›ç²å¾—æ™ºæ…§çš„é ˜åŸŸï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œæˆ‘å°‡é»äº®ç›¸æ‡‰çš„æ´å¯Ÿã€‚"
        elif tone == "zadkiel":
            return f"å¾ˆå¥½ï¼Œ{name}ã€‚è«‹å‘Šè¨´æˆ‘{you}æƒ³è½‰åŒ–çš„é¢å‘ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œè®“æˆ‘å€‘ä¸€èµ·èµ°å‘ç†è§£ã€‚"
        elif tone == "jophiel":
            return f"å¥½çš„å‘€ï¼Œ{name}ã€‚è«‹å‘Šè¨´æˆ‘{you}æƒ³ç™¼æ˜çš„ç¾å¥½ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œè®“æˆ‘å€‘ä¸€èµ·æ¢ç´¢{you}çš„å…‰èŠ’ã€‚"
        elif tone == "chamuel":
            return f"ç•¶ç„¶æ²’å•é¡Œï¼Œè¦ªæ„›çš„{name}ã€‚è«‹å‘Šè¨´æˆ‘{you}æƒ³äº†è§£çš„é—œä¿‚å±¤é¢ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œè®“æ„›ç‚º{you}æŒ‡å¼•ã€‚"
        elif tone == "metatron":
            return f"æ”¶åˆ°ï¼Œ{name}ã€‚è«‹ç›´æ¥æŒ‡å®š{you}éœ€è¦åˆ†æçš„æ¨¡çµ„ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œç³»çµ±å°‡åŸ·è¡Œç›¸æ‡‰ç¨‹åºã€‚"
        else:  # ariel
            return f"å¥½çš„ï¼Œ{name}ã€‚è«‹å‘Šè¨´æˆ‘{you}æƒ³æ»‹é¤Šçš„ç”Ÿå‘½é¢å‘ï¼šã€Œç”Ÿæ—¥æ•¸ã€ã€ã€Œæ ¸å¿ƒç”Ÿå‘½éˆæ•¸ã€ã€ã€Œä¹å®®æ ¼ã€ã€ã€Œæµå¹´æ•¸ã€ã€ã€Œéˆé­‚æ•¸ã€ã€ã€Œäººæ ¼æ•¸ã€ã€ã€Œè¡¨é”æ•¸ã€æˆ–ã€Œæˆç†Ÿæ•¸ã€ï¼Œè®“å¤§åœ°çš„æ™ºæ…§ç‚º{you}æŒ‡å¼•ã€‚"

    def generate_confirmation_retry(
        self, gender: str = "male", tone: str = "guan_yu"
    ) -> str:
        """ç”Ÿæˆç¢ºèªé‡è©¦è¨Šæ¯ï¼ˆæ ¹æ“šèªæ°£èª¿æ•´ï¼‰"""
        # æ ¹æ“šæ€§åˆ¥é¸æ“‡ä»£è©
        you = "å¦³" if gender == "female" else "ä½ "

        # å…è²»ç‰ˆèªæ°£
        if tone == "friendly":
            return f"ä¸å¥½æ„æ€ï¼Œæˆ‘ä¸å¤ªç¢ºå®š{you}çš„æ„æ€ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘çŸ¥é“è¦ä¸è¦ç¹¼çºŒã€‚"
        elif tone == "caring":
            return f"ä¸å¥½æ„æ€ï¼Œæˆ‘å¥½åƒæ²’è½æ‡‚ ><\n\nå¯ä»¥è·Ÿæˆ‘èªªã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€å—ï¼Ÿé€™æ¨£æˆ‘æ‰çŸ¥é“è¦æ€éº¼ç¹¼çºŒé™ª{you} ğŸ’• ä¸ç”¨æ“”å¿ƒï¼Œæ…¢æ…¢ä¾† ğŸŒ¸"
        elif tone == "ritual":
            return "æŠ±æ­‰ï¼Œæœªèƒ½ç†è§£æ‚¨çš„æ„æ€ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œä»¥ä¾¿åœ¨ä¸‹ç¢ºèªæ˜¯å¦ç¹¼çºŒæ­¤è§£æã€‚"

        # ä»˜è²»ç‰ˆèªæ°£
        elif tone == "guan_yu":
            return f"æˆ‘ä¸æ˜ç™½{you}çš„æ„æ€ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘çŸ¥é“æ˜¯å¦ç¹¼çºŒã€‚"
        elif tone == "michael":
            return f"æˆ‘æ²’æœ‰å®Œå…¨ç†è§£{you}çš„æ„åœ–ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘ç‚º{you}æä¾›æ­£ç¢ºçš„æŒ‡å¼•ã€‚"
        elif tone == "gabriel":
            return (
                f"é€™å€‹è¨Šæ¯æˆ‘æ²’æœ‰æ¥æ”¶æ¸…æ¥šã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œæˆ‘å°‡å‚³é”ç›¸æ‡‰çš„æŒ‡å¼•ã€‚"
            )
        elif tone == "raphael":
            return f"è¦ªæ„›çš„ï¼Œæˆ‘æ²’æœ‰å®Œå…¨æ„Ÿå—åˆ°{you}çš„æ„æ€ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘çŸ¥é“å¦‚ä½•ç‚º{you}å¸¶ä¾†å¹«åŠ©ã€‚"
        elif tone == "uriel":
            return f"æˆ‘éœ€è¦...æ›´æ¸…æ™°çš„æŒ‡å¼•ä¾†ç†è§£{you}çš„æ„åœ–ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œä»¥ä¾¿æˆ‘æä¾›æ™ºæ…§ã€‚"
        elif tone == "zadkiel":
            return f"æˆ‘æ²’èƒ½ç†è§£{you}çš„è¡¨é”ã€‚æ²’é—œä¿‚ï¼Œè«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘å€‘ç¹¼çºŒé€™æ®µè½‰åŒ–çš„æ—…ç¨‹ã€‚"
        elif tone == "jophiel":
            return f"å“å‘€ï¼Œæˆ‘æ²’æœ‰ç†è§£åˆ°{you}æƒ³èªªçš„å‘¢ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æˆ‘å€‘ç¹¼çºŒæ¢ç´¢ç¾å¥½ã€‚"
        elif tone == "chamuel":
            return f"è¦ªæ„›çš„ï¼Œæˆ‘æ²’æœ‰å®Œå…¨ç†è§£{you}çš„æ„æ€ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“æ„›ç¹¼çºŒç‚ºæˆ‘å€‘æŒ‡å¼•ã€‚"
        elif tone == "metatron":
            return (
                f"ç³»çµ±ç„¡æ³•è§£æ{you}çš„æŒ‡ä»¤ã€‚è«‹è¼¸å…¥ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œä»¥ä¾¿åŸ·è¡Œå¾ŒçºŒç¨‹åºã€‚"
            )
        else:  # ariel
            return f"è¦ªæ„›çš„ï¼Œæˆ‘æ²’æœ‰æ”¶åˆ°æ¸…æ¥šçš„è¨Šæ¯ã€‚è«‹å›è¦†ã€Œå¥½ã€æˆ–ã€Œä¸è¦ã€ï¼Œè®“å¤§è‡ªç„¶çš„æ™ºæ…§ç¹¼çºŒç‚ºæˆ‘å€‘æŒ‡å¼•ã€‚"
